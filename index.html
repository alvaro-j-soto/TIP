<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TIP Research Prototypes â€” TeamSense</title>
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- React 18.2 from cdnjs (verified available) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <!-- react-is: required peer dep for Recharts UMD -->
  <script src="https://cdn.jsdelivr.net/npm/react-is@18.2.0/umd/react-is.production.min.js"></script>
  <!-- Recharts 3.2.1 from cdnjs (confirmed available on cdnjs.com/libraries/recharts) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/3.2.1/Recharts.min.js"></script>
  <!-- Babel standalone for JSX transpilation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Urbanist', system-ui, sans-serif; background: #F5FAF8; }
    #proto-nav {
      position: sticky; top: 0; z-index: 100;
      background: #1a2b28; padding: 0 32px;
      display: flex; align-items: center; gap: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    #proto-nav .nav-brand {
      font-size: 13px; font-weight: 700; color: #6DAEA2;
      letter-spacing: 1px; margin-right: 32px; padding: 14px 0;
    }
    #proto-nav button {
      background: none; border: none; color: rgba(255,255,255,0.6);
      font-family: 'Urbanist', system-ui, sans-serif;
      font-size: 14px; font-weight: 600; padding: 14px 20px;
      cursor: pointer; border-bottom: 3px solid transparent;
      transition: all 0.15s;
    }
    #proto-nav button:hover { color: white; }
    #proto-nav button.active { color: white; border-bottom-color: #F6B725; }
  </style>
</head>
<body>
  <div id="root"><div style="padding:40px;font-family:system-ui;color:#666">Loading prototypes...</div></div>

  <script>
    // Pre-flight check: verify all CDN libraries loaded
    window.addEventListener('DOMContentLoaded', function() {
      var checks = [
        { name: 'React (cdnjs)', ok: typeof React !== 'undefined' },
        { name: 'ReactDOM (cdnjs)', ok: typeof ReactDOM !== 'undefined' },
        { name: 'react-is (jsdelivr)', ok: typeof ReactIs !== 'undefined' },
        { name: 'Recharts (jsdelivr)', ok: typeof Recharts !== 'undefined' },
      ];
      var missing = checks.filter(function(c) { return !c.ok; }).map(function(c) { return c.name; });
      if (missing.length > 0) {
        document.getElementById('root').innerHTML =
          '<div style="padding:40px;font-family:system-ui;color:red">' +
          '<h2>CDN Load Error</h2>' +
          '<p>Failed to load: <strong>' + missing.join(', ') + '</strong></p>' +
          '<p>Loaded OK: ' + checks.filter(function(c){return c.ok;}).map(function(c){return c.name;}).join(', ') + '</p>' +
          '<p style="margin-top:12px;color:#666">Try refreshing, or check browser console (F12) for blocked network requests.</p></div>';
      }
    });
  </script>

  <script type="text/babel">
    const { useState } = React;
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
            LineChart, Line, Legend, Cell, Area, AreaChart, ReferenceLine, PieChart, Pie,
            ComposedChart } = Recharts;

    /* ============================================================
       PROTOTYPE 1: CONTENT INSIGHTS DASHBOARD
       ============================================================ */
    const topicData = [
      { topic: "Attendance Points & Balances", questions: 378, trend: "+15%", quality: 52, gap: true, priority: 1 },
      { topic: "Call-Offs / PTO / Leave", questions: 302, trend: "+28%", quality: 62, gap: true, priority: 2 },
      { topic: "Schedules / Hours", questions: 244, trend: "+5%", quality: 78, gap: false, priority: null },
      { topic: "Pay & Perks", questions: 195, trend: "-3%", quality: 88, gap: false, priority: null },
      { topic: "Timekeeping & Punch Corrections", questions: 168, trend: "+12%", quality: 71, gap: false, priority: null },
      { topic: "Attendance Policy Clarifications", questions: 134, trend: "+8%", quality: 45, gap: true, priority: 3 },
      { topic: "Helpdesk / Workday / ARC Navigation", questions: 112, trend: "+41%", quality: 34, gap: true, priority: 4 },
      { topic: "Human Help Escalations", questions: 84, trend: "-5%", quality: 100, gap: false, priority: null },
      { topic: "Other / Off Topic", questions: 66, trend: "-12%", quality: 100, gap: false, priority: null },
    ];

    // Overview tab: weekly volume with 4-week rolling average
    const weeklyVolumeData = [
      { week:"Sep 1", q:262 },{ week:"Sep 8", q:278 },{ week:"Sep 15", q:290 },{ week:"Sep 22", q:304 },
      { week:"Oct 6", q:295 },{ week:"Oct 13", q:308 },{ week:"Oct 20", q:312 },{ week:"Oct 27", q:309 },
      { week:"Nov 3", q:322 },{ week:"Nov 10", q:338 },{ week:"Nov 17", q:345 },{ week:"Nov 24", q:348 },
      { week:"Dec 1", q:310 },{ week:"Dec 8", q:285 },{ week:"Dec 15", q:278 },{ week:"Dec 22", q:296 },
      { week:"Jan 5", q:342 },{ week:"Jan 12", q:358 },{ week:"Jan 19", q:368 },{ week:"Jan 26", q:375 },
      { week:"Feb 2", q:392 },{ week:"Feb 9", q:408 },{ week:"Feb 16", q:425 },{ week:"Feb 22", q:458 },
    ].map((d, i, arr) => {
      const window = arr.slice(Math.max(0, i - 3), i + 1);
      const avg = Math.round(window.reduce((s, x) => s + x.q, 0) / window.length);
      return { ...d, avg };
    });

    // Monthly volume for chart + reporting
    const monthlyVolumeData = [
      { month:"Sep", q:1134, avgDay:38, change:null },
      { month:"Oct", q:1224, avgDay:39, change:"+8%" },
      { month:"Nov", q:1353, avgDay:45, change:"+11%" },
      { month:"Dec", q:1169, avgDay:38, change:"-14%" },
      { month:"Jan", q:1443, avgDay:47, change:"+23%" },
      { month:"Feb", q:1683, avgDay:56, change:"+17%" },
    ];


    // Overview tab: pie chart data â€” derived from topicData
    const pieColors = ["#263D39","#6DAEA2","#F6B725","#E8825A","#3b82f6","#8b5cf6","#ec4899","#64748b","#d1d5db"];
    const pieCategoryData = topicData.map((d,i) => ({ name: d.topic.length > 20 ? d.topic.substring(0,18)+"..." : d.topic, fullName: d.topic, value: d.questions, color: pieColors[i] }));

    // Category Detail tab: topic breakdown by division
    const divisionCategoryData = [
      { division: "Aurora, CO", "Attendance": 178, "Call-Offs / PTO": 82, "Schedules": 68, "Pay & Perks": 72, "Timekeeping": 58, "Policy": 92, "Helpdesk": 42, "Other": 32 },
      { division: "Newark, NJ", "Attendance": 85, "Call-Offs / PTO": 142, "Schedules": 118, "Pay & Perks": 38, "Timekeeping": 48, "Policy": 22, "Helpdesk": 18, "Other": 16 },
      { division: "Irving, TX", "Attendance": 115, "Call-Offs / PTO": 78, "Schedules": 58, "Pay & Perks": 65, "Timekeeping": 52, "Policy": 38, "Helpdesk": 118, "Other": 48 },
    ];
    const divCatKeys = ["Attendance","Call-Offs / PTO","Schedules","Pay & Perks","Timekeeping","Policy","Helpdesk","Other"];
    const divCatColors = ["#263D39","#6DAEA2","#F6B725","#E8825A","#3b82f6","#8b5cf6","#ec4899","#d1d5db"];

    // Content Gaps tab: resolution quality % over time
    const qualityTrendData = [
      { month: "Sep", quality: 64 },
      { month: "Oct", quality: 66 },
      { month: "Nov", quality: 65 },
      { month: "Dec", quality: 68 },
      { month: "Jan", quality: 70 },
      { month: "Feb", quality: 72 },
    ];

    const QualityBadge = ({ score }) => {
      if (score === null) return <span style={{ fontSize:13, color:"#9ca3af" }}>N/A</span>;
      const color = score >= 80 ? "#16a34a" : score >= 60 ? "#F6B725" : "#BF4B08";
      const bg = score >= 80 ? "#f0fdf4" : score >= 60 ? "#fefce8" : "#fff7ed";
      const label = score >= 80 ? "Strong" : score >= 60 ? "Fair" : "Needs Work";
      return (
        <span style={{ display:"inline-flex", alignItems:"center", gap:6, padding:"2px 10px", borderRadius:12, backgroundColor:bg, color, fontSize:13, fontWeight:600 }}>
          <span style={{ width:8, height:8, borderRadius:"50%", backgroundColor:color }} />
          {score}% â€” {label}
        </span>
      );
    };

    const TrendBadge = ({ trend }) => {
      const isUp = trend.startsWith("+");
      return <span style={{ color:"#6b7280", fontSize:13, fontWeight:500 }}>{isUp ? "â†‘" : "â†“"} {trend}</span>;
    };

    // Module-scope data shared between ContentInsights and ContentImpact
    const gaps = topicData.filter(d => d.gap).sort((a, b) => a.priority - b.priority);

    const recentQuestions = {
      "Attendance Points & Balances": [
        {text:"How many attendance points do I have?", site:"Aurora, CO"},
        {text:"When do my points expire?", site:"Newark, NJ"},
        {text:"How many points before I get a warning?", site:"Irving, TX"},
      ],
      "Call-Offs / PTO / Leave": [
        {text:"How do I call off for my shift tomorrow?", site:"Aurora, CO"},
        {text:"How many PTO days do I have left this year?", site:"Newark, NJ"},
        {text:"Can I roll over my PTO to next year?", site:"Irving, TX"},
      ],
      "Attendance Policy Clarifications": [
        {text:"What happens at 6 attendance points?", site:"Aurora, CO"},
        {text:"Does FMLA affect my attendance points?", site:"Newark, NJ"},
        {text:"Can my manager make exceptions to the policy?", site:"Irving, TX"},
      ],
      "Helpdesk / Workday / ARC Navigation": [
        {text:"How do I find my pay stub in Workday?", site:"Aurora, CO"},
        {text:"Where do I go to change my direct deposit?", site:"Irving, TX"},
        {text:"How do I swap shifts in ARC?", site:"Newark, NJ"},
      ],
    };

    const gapStatuses = {
      "Attendance Points & Balances": {label:"In Progress", bg:"#eff6ff", color:"#1d4ed8", icon:"ðŸ”„"},
      "Call-Offs / PTO / Leave": {label:"Acknowledged", bg:"#fefce8", color:"#92400e", icon:"ðŸ‘"},
      "Attendance Policy Clarifications": {label:"New", bg:"#fef2f2", color:"#991b1b", icon:"ðŸ†•"},
      "Helpdesk / Workday / ARC Navigation": {label:"New", bg:"#fef2f2", color:"#991b1b", icon:"ðŸ†•"}
    };

    const gapAges = {
      "Attendance Points & Balances": "12 days",
      "Call-Offs / PTO / Leave": "45 days",
      "Attendance Policy Clarifications": "28 days",
      "Helpdesk / Workday / ARC Navigation": "14 days"
    };

    const gapDetails = {
      "Attendance Points & Balances": "Employees frequently ask about current point balances, how points are calculated, and expiration timelines. Employee Assistant cannot pull live points data â€” routes most questions to HR. Points/Balance tool exists but doesn't cover policy questions.",
      "Call-Offs / PTO / Leave": "High volume around PTO accrual rates, rollover policies, and call-off procedures. Content exists but doesn't cover site-specific rules. Employees at each site have different blackout periods and accrual rates.",
      "Attendance Policy Clarifications": "Questions about attendance thresholds, progressive discipline steps, and how exceptions work. Current content is generic â€” doesn't reflect site-specific policy nuances or recent policy updates.",
      "Helpdesk / Workday / ARC Navigation": "Sharp increase tied to new system rollouts. Employees asking how to navigate Workday for pay stubs, ARC for scheduling, and general IT helpdesk routing. Employee Assistant has outdated or missing content for these workflows.",
    };

    const recDetails = {
      "Attendance Points & Balances": { text: "Add FAQ content explaining points calculation, expiration timelines, and threshold consequences. Note: Live balance lookup requires the Points/Balance tool â€” ensure tool coverage is complete for policy-adjacent questions.", impact: "Could resolve ~181 questions/month that currently go to HR." },
      "Call-Offs / PTO / Leave": { text: "Update Employee Assistant knowledge base with site-specific call-off procedures, PTO accrual rules, and leave policies for each site. Current content is generic â€” employees need site-specific answers.", impact: "Could resolve ~115 questions/month during non-peak periods." },
      "Attendance Policy Clarifications": { text: "Add content covering progressive discipline steps, exception processes, and recent policy updates. Cross-reference with Attendance Points content to avoid duplication.", impact: "Could resolve ~74 questions/month. Also reduces confusion that leads to escalations." },
      "Helpdesk / Workday / ARC Navigation": { text: "Create step-by-step guides for common Workday tasks (pay stubs, tax forms) and ARC scheduling workflows. Partner with IT for helpdesk routing content.", impact: "Could resolve ~74 questions/month. Fast-growing topic â€” content gap will widen without action." },
    };

    // Expanded sample questions by category for Tab 1
    const sampleQuestionsByCategory = {
      "Attendance Points & Balances": [
        {q:"How many attendance points do I have?", freq:"~85/mo", site:"All", type:"tool-backed"},
        {q:"When do my points expire?", freq:"~64/mo", site:"All", type:"content-backed"},
        {q:"How many points before I get a warning?", freq:"~38/mo", site:"All", type:"content-backed"},
        {q:"Am I close to a written warning?", freq:"~28/mo", site:"All", type:"tool-backed"},
        {q:"How are attendance points calculated?", freq:"~22/mo", site:"Aurora, CO", type:"content-backed"},
      ],
      "Call-Offs / PTO / Leave": [
        {q:"How do I call off for my shift tomorrow?", freq:"~72/mo", site:"All", type:"content-backed"},
        {q:"Can I roll over my PTO to next year?", freq:"~48/mo", site:"Newark, NJ", type:"content-backed"},
        {q:"How many PTO days do I have left?", freq:"~45/mo", site:"All", type:"tool-backed"},
        {q:"What's the bereavement leave policy?", freq:"~18/mo", site:"All", type:"content-backed"},
        {q:"Does calling off count against my PTO?", freq:"~15/mo", site:"Irving, TX", type:"content-backed"},
      ],
      "Schedules / Hours": [
        {q:"What time does my shift start?", freq:"~41/mo", site:"All", type:"tool-backed"},
        {q:"How do I swap shifts in ARC?", freq:"~35/mo", site:"All", type:"content-backed"},
        {q:"Can I change my availability?", freq:"~24/mo", site:"Aurora, CO", type:"content-backed"},
      ],
      "Pay & Perks": [
        {q:"When is payday?", freq:"~32/mo", site:"All", type:"content-backed"},
        {q:"How do I find my pay stub in Workday?", freq:"~28/mo", site:"Irving, TX", type:"content-backed"},
        {q:"What's the employee discount?", freq:"~19/mo", site:"All", type:"content-backed"},
      ],
      "Timekeeping & Punch Corrections": [
        {q:"I forgot to clock in â€” what do I do?", freq:"~31/mo", site:"All", type:"content-backed"},
        {q:"How do I submit a punch correction?", freq:"~26/mo", site:"All", type:"content-backed"},
        {q:"My hours look wrong on my timecard", freq:"~18/mo", site:"Newark, NJ", type:"fallback"},
      ],
      "Attendance Policy Clarifications": [
        {q:"What happens at 6 attendance points?", freq:"~24/mo", site:"Aurora, CO", type:"content-backed"},
        {q:"Does FMLA affect my attendance points?", freq:"~19/mo", site:"Newark, NJ", type:"fallback"},
        {q:"Can my manager make exceptions to the policy?", freq:"~14/mo", site:"Irving, TX", type:"fallback"},
      ],
      "Helpdesk / Workday / ARC Navigation": [
        {q:"How do I find my pay stub in Workday?", freq:"~51/mo", site:"Irving, TX", type:"fallback"},
        {q:"Where do I change my direct deposit?", freq:"~29/mo", site:"All", type:"fallback"},
        {q:"How do I swap shifts in ARC?", freq:"~35/mo", site:"Newark, NJ", type:"fallback"},
      ],
      "Human Help Escalations": [
        {q:"I need to talk to HR", freq:"~22/mo", site:"All", type:"routed"},
        {q:"Can I speak to a manager?", freq:"~18/mo", site:"All", type:"routed"},
        {q:"I want to file a complaint", freq:"~12/mo", site:"All", type:"routed"},
      ],
      "Other / Off Topic": [
        {q:"What's the weather like today?", freq:"~11/mo", site:"All", type:"routed"},
        {q:"Can you tell me a joke?", freq:"~8/mo", site:"All", type:"routed"},
        {q:"Hello / Hi / Hey", freq:"~34/mo", site:"All", type:"routed"},
      ],
    };

    const responseTypeBadge = (type) => {
      const styles = {
        "content-backed": { bg:"#f0fdf4", color:"#16a34a", label:"Answered (Policy)" },
        "tool-backed": { bg:"#eff6ff", color:"#1d4ed8", label:"Answered (Tool)" },
        "fallback": { bg:"#fff7ed", color:"#BF4B08", label:"Content Gap" },
        "routed": { bg:"#f9fafb", color:"#6b7280", label:"Redirected" },
      };
      const s = styles[type] || styles["fallback"];
      return <span style={{ backgroundColor:s.bg, color:s.color, padding:"2px 8px", borderRadius:4, fontSize:10, fontWeight:600, display:"inline-block", minWidth:120, textAlign:"center" }}>{s.label}</span>;
    };

    function ContentInsights({ showNotes }) {
      const [activeTab, setActiveTab] = useState("overview");
      const [volumeView, setVolumeView] = useState("monthly");

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>Content Insights</div>
              <div style={{ fontSize:13, color:"rgba(255,255,255,0.6)", marginTop:4 }}>Understand who's using Employee Assistant, what they're asking, and where content needs improvement</div>
            </div>
            <div style={{ display:"flex", gap:8 }}>
              {["All Sites","Aurora, CO","Newark, NJ","Irving, TX"].map(s => (
                <button key={s} style={{ padding:"6px 14px", borderRadius:6, border:"1px solid rgba(255,255,255,0.3)", backgroundColor: s==="All Sites"?"rgba(255,255,255,0.2)":"transparent", color:"white", cursor:"pointer", fontSize:13, fontWeight:500 }}>{s}</button>
              ))}
            </div>
          </div>

          <div style={{ backgroundColor:"white", padding:"12px 32px", borderBottom:"1px solid #e5e7eb", display:"flex", gap:12, alignItems:"center", flexWrap:"wrap" }}>
            <span style={{ fontSize:13, color:"#6b7280", fontWeight:500 }}>Filters:</span>
            {["Last 30 Days","All Shifts","All Departments","All Languages"].map(f => (
              <button key={f} style={{ padding:"5px 12px", borderRadius:6, border:"1px solid #d1d5db", backgroundColor:"white", fontSize:13, cursor:"pointer", color:"#374151" }}>{f} â–¾</button>
            ))}
            <div style={{ flex:1 }} />
            <button style={{ padding:"6px 16px", borderRadius:6, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:13, fontWeight:600, cursor:"pointer" }}>Export Report</button>
          </div>

          {/* Top-level Metric Cards â€” always visible */}
          <div style={{ padding:"24px 32px 0" }}>
            <div style={{ display:"grid", gridTemplateColumns:"repeat(4, 1fr)", gap:16, marginBottom:0 }}>
              {[
                { label:"Total Questions", value:"1,683", sub:"Last 30 days", accent:false },
                { label:"Avg Resolution Quality", value:"72%", sub:"â†‘ 3% from last month", accent:false },
                { label:"Content Gaps Found", value:"4", sub:"Topics needing attention", accent:true },
                { label:"Top Gap Topic", value:"Attendance Points", sub:"52% quality Â· 378 questions/mo", accent:true },
              ].map((c,i) => (
                <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:20, border: c.accent?"2px solid #F6B725":"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:4, fontWeight:500 }}>{c.label}</div>
                  <div style={{ fontSize:28, fontWeight:700, color:"#263D39" }}>{c.value}</div>
                  <div style={{ fontSize:12, color:"#6DAEA2", marginTop:4, fontWeight:500 }}>{c.sub}</div>
                </div>
              ))}
            </div>
          </div>

          {/* Tab Bar â€” below metrics */}
          <div style={{ padding:"16px 32px 0", display:"flex", gap:4, borderBottom:"1px solid #e5e7eb" }}>
            {[{id:"overview",label:"Overview"},{id:"questions",label:"Questions by Topic"},{id:"gaps",label:"Resolving Content Gaps"}].map(tab => (
              <button key={tab.id} onClick={() => setActiveTab(tab.id)} style={{ padding:"10px 20px", border:"none", cursor:"pointer", fontSize:14, fontWeight:600, backgroundColor:"transparent", color: activeTab===tab.id?"#263D39":"#6b7280", borderBottom: activeTab===tab.id?"3px solid #F6B725":"3px solid transparent", marginBottom:-1 }}>
                {tab.label}
              </button>
            ))}
          </div>

          {/* ===== TAB 1: OVERVIEW ===== */}
          {activeTab === "overview" && (
            <div style={{ padding:"24px 32px" }}>

              {/* What Employees Are Asking About â€” bar chart + table */}
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24, marginBottom:24 }}>
                <div style={{ marginBottom:16 }}>
                  <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>What Employees Are Asking About</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>Ranked by question volume â€” last 30 days</div>
                </div>
                <div style={{ height: topicData.length * 26 + 20, marginBottom:12 }}>
                  <ResponsiveContainer width="100%" height="100%">
                    <BarChart data={[...topicData].sort((a,b) => b.questions - a.questions)} layout="vertical" barCategoryGap="15%" margin={{ left:10, right:20, top:0, bottom:0 }}>
                      <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                      <XAxis type="number" tick={{ fontSize:10 }} hide />
                      <YAxis type="category" dataKey="topic" tick={{ fontSize:10 }} width={190} axisLine={false} tickLine={false} />
                      <Tooltip formatter={(val) => [val.toLocaleString() + " questions"]} />
                      <Bar dataKey="questions" radius={[0,3,3,0]}>
                        {[...topicData].sort((a,b) => b.questions - a.questions).map((d,i) => (
                          <Cell key={i} fill={d.gap ? "#BF4B08" : "#6DAEA2"} />
                        ))}
                      </Bar>
                    </BarChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ display:"flex", gap:16, fontSize:12, marginBottom:20 }}>
                  <span style={{ display:"flex", alignItems:"center", gap:5 }}><span style={{ width:12, height:12, borderRadius:2, backgroundColor:"#BF4B08", display:"inline-block" }} /> Content gap</span>
                  <span style={{ display:"flex", alignItems:"center", gap:5 }}><span style={{ width:12, height:12, borderRadius:2, backgroundColor:"#6DAEA2", display:"inline-block" }} /> Healthy</span>
                </div>
                <table style={{ width:"100%", borderCollapse:"collapse", fontSize:13 }}>
                  <thead>
                    <tr style={{ borderBottom:"2px solid #e5e7eb" }}>
                      {["TOPIC","QUESTIONS","% OF TOTAL","RESOLUTION QUALITY"].map(h => (
                        <th key={h} style={{ padding:"8px 10px", textAlign:"left", fontWeight:600, color:"#6b7280", fontSize:11, letterSpacing:"0.5px" }}>{h}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {[...topicData].sort((a,b) => b.questions - a.questions).map((d,i) => {
                      const totalQ = topicData.reduce((s,t) => s + t.questions, 0);
                      return (
                      <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                        <td style={{ padding:"10px 10px", color:"#374151" }}>{d.topic}</td>
                        <td style={{ padding:"10px 10px", fontWeight:600, color:"#263D39" }}>{d.questions.toLocaleString()}</td>
                        <td style={{ padding:"10px 10px", color:"#6b7280" }}>{Math.round(d.questions / totalQ * 100)}%</td>
                        <td style={{ padding:"10px 10px" }}><QualityBadge score={d.quality} /></td>
                      </tr>
                    ); })}
                  </tbody>
                </table>
              </div>

              {/* Question Volume â€” toggleable monthly/weekly */}
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24, marginBottom:24 }}>
                <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:20 }}>
                  <div>
                    <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>Question Volume</div>
                    <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>{volumeView === "monthly" ? "Monthly totals â€” last 6 months" : "Weekly totals â€” last 6 months, with 4-week rolling average"}</div>
                  </div>
                  <div style={{ display:"flex", borderRadius:8, border:"1px solid #e5e7eb", overflow:"hidden" }}>
                    {["monthly","weekly"].map(v => (
                      <button key={v} onClick={() => setVolumeView(v)} style={{ padding:"6px 14px", fontSize:12, fontWeight:600, border:"none", cursor:"pointer", backgroundColor: volumeView===v ? "#263D39" : "white", color: volumeView===v ? "white" : "#6b7280" }}>
                        {v === "monthly" ? "Monthly" : "Weekly"}
                      </button>
                    ))}
                  </div>
                </div>

                {volumeView === "monthly" ? (
                  <div style={{ height:240 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={monthlyVolumeData}>
                        <defs>
                          <linearGradient id="monthVolGrad" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#6DAEA2" stopOpacity={0.3} />
                            <stop offset="95%" stopColor="#6DAEA2" stopOpacity={0} />
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                        <XAxis dataKey="month" tick={{ fontSize:12 }} />
                        <YAxis tick={{ fontSize:12 }} />
                        <Tooltip content={({active, payload}) => {
                          if (!active || !payload?.length) return null;
                          const d = payload[0].payload;
                          return (
                            <div style={{ backgroundColor:"white", border:"1px solid #e5e7eb", borderRadius:8, padding:"8px 12px", fontSize:12 }}>
                              <div style={{ fontWeight:600 }}>{d.month}</div>
                              <div style={{ color:"#6DAEA2" }}>{d.q.toLocaleString()} questions</div>
                              <div style={{ color:"#6b7280" }}>{d.avgDay} avg/day</div>
                              {d.change && <div style={{ color: d.change.startsWith("+") ? "#16a34a" : "#BF4B08", fontWeight:600 }}>{d.change} vs prev month</div>}
                            </div>
                          );
                        }} />
                        <Area type="monotone" dataKey="q" stroke="#6DAEA2" strokeWidth={2} fill="url(#monthVolGrad)" dot={{ r:5, fill:"#6DAEA2", stroke:"white", strokeWidth:2 }} />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                ) : (
                  <div>
                    <div style={{ display:"flex", gap:16, marginBottom:12, fontSize:12 }}>
                      <span style={{ display:"flex", alignItems:"center", gap:5 }}><span style={{ width:12, height:4, backgroundColor:"#6DAEA2", display:"inline-block", borderRadius:2 }} /> Weekly total</span>
                      <span style={{ display:"flex", alignItems:"center", gap:5 }}><span style={{ width:12, height:2, backgroundColor:"#263D39", display:"inline-block", borderRadius:2 }} /> 4-week avg</span>
                    </div>
                    <div style={{ height:240 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <ComposedChart data={weeklyVolumeData} barCategoryGap="20%">
                          <CartesianGrid strokeDasharray="3 3" vertical={false} />
                          <XAxis dataKey="week" tick={{ fontSize:10 }} interval={3} />
                          <YAxis tick={{ fontSize:12 }} />
                          <Tooltip content={({active, payload}) => {
                            if (!active || !payload?.length) return null;
                            const d = payload[0].payload;
                            return (
                              <div style={{ backgroundColor:"white", border:"1px solid #e5e7eb", borderRadius:8, padding:"8px 12px", fontSize:12 }}>
                                <div style={{ fontWeight:600 }}>Week of {d.week}</div>
                                <div style={{ color:"#6DAEA2" }}>{d.q} questions</div>
                                <div style={{ color:"#263D39" }}>4-week avg: {d.avg}</div>
                              </div>
                            );
                          }} />
                          <Bar dataKey="q" fill="#6DAEA2" radius={[3,3,0,0]} />
                          <Line type="monotone" dataKey="avg" stroke="#263D39" strokeWidth={2} dot={false} />
                        </ComposedChart>
                      </ResponsiveContainer>
                    </div>
                  </div>
                )}
              </div>

              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:24, marginBottom:24 }}>
                {/* Site at a Glance */}
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24 }}>
                  <div style={{ marginBottom:16 }}>
                    <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Site at a Glance</div>
                    <div style={{ fontSize:13, color:"#6b7280" }}>Employee Assistant usage by site â€” last 30 days</div>
                  </div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:13 }}>
                    <thead>
                      <tr style={{ borderBottom:"2px solid #e5e7eb" }}>
                        {["SITE","HEADCOUNT","EMPLOYEES USING EA","REACH","QUESTIONS"].map(h => (
                          <th key={h} style={{ padding:"8px 10px", textAlign:"left", fontWeight:600, color:"#6b7280", fontSize:11, letterSpacing:"0.5px" }}>{h}</th>
                        ))}
                      </tr>
                    </thead>
                    <tbody>
                      {[
                        { div:"Aurora, CO", headcount:"1,850", users:418, adopt:"22.6%", q:624 },
                        { div:"Newark, NJ", headcount:"1,419", users:298, adopt:"21.0%", q:487 },
                        { div:"Irving, TX", headcount:"2,096", users:371, adopt:"17.7%", q:572 }
                      ].map((r,i) => (
                        <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                          <td style={{ padding:"10px", fontWeight:600, color:"#263D39" }}>{r.div}</td>
                          <td style={{ padding:"10px", color:"#6b7280" }}>{r.headcount}</td>
                          <td style={{ padding:"10px", color:"#374151" }}>{r.users.toLocaleString()}</td>
                          <td style={{ padding:"10px" }}>
                            <span style={{ backgroundColor: parseFloat(r.adopt) >= 20 ? "#f0fdf4" : "#fefce8", color: parseFloat(r.adopt) >= 20 ? "#16a34a" : "#92400e", padding:"2px 8px", borderRadius:4, fontWeight:600, fontSize:12 }}>{r.adopt}</span>
                          </td>
                          <td style={{ padding:"10px", color:"#374151" }}>{r.q.toLocaleString()}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>

                {/* Language Breakdown */}
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24 }}>
                  <div style={{ marginBottom:16 }}>
                    <div style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>Language Breakdown</div>
                    <div style={{ fontSize:13, color:"#6b7280" }}>Questions by language â€” last 30 days</div>
                  </div>
                  {[{lang:"English",pct:68,count:1144,color:"#263D39"},{lang:"Spanish",pct:24,count:404,color:"#6DAEA2"},{lang:"Haitian Creole",pct:5,count:84,color:"#F6B725"},{lang:"Other",pct:3,count:51,color:"#BF4B08"}].map(l => (
                    <div key={l.lang} style={{ display:"flex", alignItems:"center", gap:12, marginBottom:12 }}>
                      <div style={{ width:110, fontSize:13, fontWeight:500, color:"#263D39" }}>{l.lang}</div>
                      <div style={{ flex:1, height:24, backgroundColor:"#f3f4f6", borderRadius:4, overflow:"hidden" }}>
                        <div style={{ width:`${l.pct}%`, height:"100%", backgroundColor:l.color, borderRadius:4, display:"flex", alignItems:"center", paddingLeft:8 }}>
                          <span style={{ fontSize:11, fontWeight:600, color:"white" }}>{l.pct}%</span>
                        </div>
                      </div>
                      <div style={{ width:50, fontSize:12, color:"#6b7280", textAlign:"right" }}>{l.count.toLocaleString()}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          )}

          {/* ===== TAB 2: TOPIC DETAIL ===== */}
          {activeTab === "questions" && (
            <div style={{ padding:"24px 32px" }}>
              {/* Sample Questions by Category */}
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24 }}>
                <div style={{ marginBottom:20 }}>
                  <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>Sample Questions by Topic</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>Representative questions in each bucket â€” showing how the Employee Assistant groups employee questions</div>
                </div>
                {topicData.map((topic, ti) => {
                  const questions = sampleQuestionsByCategory[topic.topic];
                  if (!questions) return null;
                  return (
                    <div key={ti} style={{ marginBottom:20, border:"1px solid #e5e7eb", borderRadius:10, overflow:"hidden" }}>
                      <div style={{ backgroundColor:"#f9fafb", padding:"12px 16px", display:"flex", justifyContent:"space-between", alignItems:"center", borderBottom:"1px solid #e5e7eb" }}>
                        <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                          <span style={{ fontSize:14, fontWeight:700, color:"#263D39" }}>{topic.topic}</span>
                          <span style={{ fontSize:12, color:"#6b7280" }}>Â· {topic.questions} questions/mo</span>
                        </div>
                      </div>
                      <table style={{ width:"100%", borderCollapse:"collapse", fontSize:13 }}>
                        <thead>
                          <tr style={{ borderBottom:"1px solid #f3f4f6" }}>
                            {["QUESTION","FREQUENCY","SITE","STATUS"].map((h,i) => (
                              <th key={h} style={{ textAlign: i===1||i===3?"center":"left", padding:"8px 16px", color:"#6b7280", fontWeight:600, fontSize:11, width: i===0?"auto":i===1?"90px":i===2?"100px":"130px" }}>{h}</th>
                            ))}
                          </tr>
                        </thead>
                        <tbody>
                          {questions.map((q,qi) => (
                            <tr key={qi} style={{ borderBottom:"1px solid #f3f4f6" }}>
                              <td style={{ padding:"8px 16px", color:"#263D39" }}>"{q.q}"</td>
                              <td style={{ textAlign:"center", padding:"8px 16px", fontWeight:600, color:"#263D39", fontSize:12 }}>{q.freq}</td>
                              <td style={{ padding:"8px 16px", color:"#6DAEA2", fontSize:12 }}>{q.site}</td>
                              <td style={{ textAlign:"center", padding:"8px 16px" }}>{responseTypeBadge(q.type)}</td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  );
                })}
              </div>
            </div>
          )}

          {/* ===== TAB 3: CONTENT GAP DETAIL ===== */}
          {activeTab === "gaps" && (
            <div style={{ padding:"24px 32px" }}>
              {/* Gap Cards */}
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24, marginBottom:24 }}>
                <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:16 }}>
                  <div>
                    <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>Gap Details</div>
                    <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>Topics where employees ask frequently but the Employee Assistant can't answer well â€” prioritized by impact</div>
                  </div>
                </div>

                {gaps.map((gap, i) => {
                  const status = gapStatuses[gap.topic] || {label:"New",bg:"#fef2f2",color:"#991b1b",icon:"ðŸ†•"};
                  return (
                  <div key={i} style={{ border:"1px solid #e5e7eb", borderRadius:12, padding:20, marginBottom:16, borderLeft:`4px solid ${i===0?"#BF4B08":i===1?"#F6B725":"#6DAEA2"}` }}>
                    <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:12 }}>
                      <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                        <span style={{ width:28, height:28, borderRadius:"50%", backgroundColor: i===0?"#BF4B08":i===1?"#F6B725":"#6DAEA2", color:"white", display:"flex", alignItems:"center", justifyContent:"center", fontSize:14, fontWeight:700 }}>{i+1}</span>
                        <span style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>{gap.topic}</span>
                        <span style={{ backgroundColor:status.bg, color:status.color, borderRadius:4, padding:"2px 8px", fontSize:11, fontWeight:600 }}>{status.icon} {status.label}</span>
                        <span style={{ fontSize:12, color:"#9ca3af" }}>Â· {gapAges[gap.topic]} old</span>
                      </div>
                      <QualityBadge score={gap.quality} />
                    </div>

                    <div style={{ fontSize:13, color:"#6b7280", marginBottom:12 }}>{gap.questions.toLocaleString()} questions this month ({gap.trend} vs. last month) Â· ~{Math.round(gap.questions * (1 - gap.quality / 100))} employees/month not getting answers</div>

                    <div style={{ fontSize:13, color:"#263D39", backgroundColor:"#F5FAF8", padding:12, borderRadius:8, lineHeight:1.5, marginBottom:12 }}>{gapDetails[gap.topic]}</div>

                    {recentQuestions[gap.topic] && (
                      <div style={{ backgroundColor:"#f9fafb", borderRadius:8, padding:12, border:"1px solid #e5e7eb", marginBottom:12 }}>
                        <div style={{ fontSize:12, fontWeight:700, color:"#6b7280", marginBottom:8 }}>UNANSWERED / POORLY ANSWERED QUESTIONS</div>
                        {recentQuestions[gap.topic].map((q,qi) => (
                          <div key={qi} style={{ fontSize:12, color:"#374151", padding:"4px 0", display:"flex", justifyContent:"space-between" }}>
                            <span>"{q.text}"</span>
                            <span style={{ fontSize:11, color:"#6DAEA2", fontWeight:500, whiteSpace:"nowrap", marginLeft:12 }}>{q.site}</span>
                          </div>
                        ))}
                      </div>
                    )}

                    <div style={{ backgroundColor:"#F5FAF8", borderRadius:8, padding:14, fontSize:13, lineHeight:1.5, border:"1px solid #d1fae5" }}>
                      <div style={{ fontWeight:700, marginBottom:6, color:"#6DAEA2", fontSize:12 }}>RECOMMENDED ACTION</div>
                      <p style={{ margin:"0 0 6px", color:"#263D39" }}>{recDetails[gap.topic]?.text}</p>
                      <p style={{ margin:0, fontWeight:600, color:"#16a34a" }}>Expected impact: {recDetails[gap.topic]?.impact}</p>
                    </div>
                  </div>
                );
                })}
              </div>

              {/* Resolution Quality Trend */}
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24 }}>
                <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Resolution Quality Over Time</div>
                <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>Are we getting better at answering employee questions? â€” last 6 months</div>
                <div style={{ height:240 }}>
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={qualityTrendData}>
                      <defs><linearGradient id="qualityGrad" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#6DAEA2" stopOpacity={0.3} /><stop offset="95%" stopColor="#6DAEA2" stopOpacity={0} /></linearGradient></defs>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="month" tick={{ fontSize:12 }} />
                      <YAxis tick={{ fontSize:12 }} domain={[50, 85]} tickFormatter={v => `${v}%`} />
                      <Tooltip formatter={v => [`${v}%`, "Resolution Quality"]} />
                      <Area type="monotone" dataKey="quality" stroke="#6DAEA2" strokeWidth={2} fill="url(#qualityGrad)" name="Resolution Quality" dot={{ r:4, fill:"#6DAEA2" }} />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ marginTop:12, padding:12, backgroundColor:"#f0fdf4", borderRadius:8, fontSize:13, color:"#16a34a" }}>Trending up: +8 percentage points over 6 months (64% â†’ 72%). Resolving the 4 active gaps could push this above 80%.</div>
              </div>
            </div>
          )}

          <div style={{ textAlign:"center", padding:"16px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TeamSense Insights â€” Content Analytics Â· Research Prototype</div>
        </div>
      );
    }
    function ContentImpact() {
      const [sel, setSel] = useState(0);
      const cur = contentUpdates[sel];
      const st = statusColors[cur.status];

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>Content Improvement Impact</div>
            </div>
            <div style={{ backgroundColor:"rgba(255,255,255,0.15)", borderRadius:8, padding:"8px 16px", fontSize:13, fontWeight:500 }}>All Sites Â· Last 90 Days</div>
          </div>

          <div style={{ margin:"24px 32px 0", backgroundColor:"white", borderRadius:12, padding:20, display:"flex", gap:24, alignItems:"center", border:"1px solid #e5e7eb" }}>
            <div style={{ flex:1 }}>
              <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:2 }}>Content Updates This Quarter</div>
              <div style={{ fontSize:32, fontWeight:700, color:"#263D39" }}>2 <span style={{ fontSize:16, fontWeight:400, color:"#6b7280" }}>of 4 gaps addressed</span></div>
            </div>
            <div style={{ width:1, height:48, backgroundColor:"#e5e7eb" }} />
            <div style={{ flex:1 }}>
              <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:2 }}>Questions Reduced</div>
              <div style={{ fontSize:32, fontWeight:700, color:"#16a34a" }}>-361 <span style={{ fontSize:16, fontWeight:400, color:"#6b7280" }}>/month</span></div>
            </div>
            <div style={{ width:1, height:48, backgroundColor:"#e5e7eb" }} />
            <div style={{ flex:1 }}>
              <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:2 }}>HR Time Saved (est.)</div>
              <div style={{ fontSize:32, fontWeight:700, color:"#6DAEA2" }}>~18 hrs <span style={{ fontSize:16, fontWeight:400, color:"#6b7280" }}>/month</span></div>
            </div>
          </div>

          <div style={{ padding:"24px 32px 0", display:"flex", gap:12 }}>
            {contentUpdates.map((u, i) => (
              <button key={u.id} onClick={() => setSel(i)} style={{ flex:1, padding:16, borderRadius:12, cursor:"pointer", border: sel===i?"2px solid #263D39":"1px solid #e5e7eb", backgroundColor: sel===i?"white":"#f9fafb", textAlign:"left" }}>
                <div style={{ fontSize:14, fontWeight:700, color:"#263D39", marginBottom:4 }}>{u.topic}</div>
                <div style={{ fontSize:11, fontWeight:600, padding:"2px 8px", borderRadius:10, display:"inline-block", backgroundColor:statusColors[u.status].bg, color:statusColors[u.status].text, border:`1px solid ${statusColors[u.status].border}` }}>{statusColors[u.status].label}</div>
                {u.updatedDate && <div style={{ fontSize:11, color:"#9ca3af", marginTop:6 }}>Updated {u.updatedDate} by {u.updatedBy}</div>}
              </button>
            ))}
          </div>

          <div style={{ padding:"24px 32px" }}>
            <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
              <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20, padding:16, borderRadius:8, backgroundColor:st.bg, border:`1px solid ${st.border}` }}>
                <div>
                  <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>{cur.topic}</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>{cur.details}</div>
                </div>
                <div style={{ fontSize:14, fontWeight:700, color:st.text, backgroundColor:"white", padding:"6px 14px", borderRadius:8, border:`1px solid ${st.border}`, whiteSpace:"nowrap" }}>{st.label}</div>
              </div>

              <div style={{ display:"flex", gap:16, marginBottom:24 }}>
                <ImpactCard label="Questions / Month" before={cur.before.questions} after={cur.after?.questions ?? null} unit="" inverse={true} />
                <ImpactCard label="Resolution Quality" before={cur.before.quality} after={cur.after?.quality ?? null} unit="%" inverse={false} />
                <ImpactCard label="Fallback-to-HR Rate" before={cur.before.fallbackRate} after={cur.after?.fallbackRate ?? null} unit="%" inverse={true} />
              </div>

              <div>
                <div style={{ fontSize:14, fontWeight:700, color:"#263D39", marginBottom:4 }}>Weekly Trend</div>
                <div style={{ fontSize:12, color:"#6b7280", marginBottom:16 }}>{cur.updatedDate ? `Content updated on ${cur.updatedDate} (dashed line)` : "No content update â€” flat trend"}</div>
                <div style={{ height:220 }}>
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={cur.trendData}>
                      <defs><linearGradient id="qg" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#6DAEA2" stopOpacity={0.3} /><stop offset="95%" stopColor="#6DAEA2" stopOpacity={0} /></linearGradient></defs>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="week" tick={{ fontSize:11 }} />
                      <YAxis tick={{ fontSize:11 }} domain={[0, 100]} />
                      <Tooltip />
                      {cur.refLine && <ReferenceLine x={cur.refLine} stroke="#F6B725" strokeWidth={2} strokeDasharray="5 5" label={{ value:"Content Updated", position:"top", fontSize:11, fill:"#92400e" }} />}
                      <Area type="monotone" dataKey="quality" stroke="#6DAEA2" strokeWidth={2} fill="url(#qg)" name="Resolution Quality %" dot={{ r:3 }} />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {cur.status === "no_update" && (
                <div style={{ backgroundColor:"#fef2f2", border:"1px solid #fecaca", borderRadius:8, padding:16, marginTop:16 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#991b1b", marginBottom:4 }}>âš  This gap was identified 45 days ago</div>
                  <div style={{ fontSize:13, color:"#7f1d1d", lineHeight:1.5 }}>~298 employees per month are not getting the answers they need about Benefits & Insurance.</div>
                </div>
              )}
            </div>
          </div>
          <div style={{ textAlign:"center", padding:"8px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1.5 â€” Content Improvement Impact Â· TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       PROTOTYPE 3: UNIFIED DASHBOARD
       ============================================================ */
    const attendanceTrend = [
      { week:"Jan 6", calloffs:42, pto:28, ncns:8, tardy:15, eaQuestions:890 },
      { week:"Jan 13", calloffs:38, pto:31, ncns:6, tardy:12, eaQuestions:920 },
      { week:"Jan 20", calloffs:51, pto:45, ncns:11, tardy:18, eaQuestions:1150 },
      { week:"Jan 27", calloffs:44, pto:35, ncns:7, tardy:14, eaQuestions:980 },
      { week:"Feb 3", calloffs:39, pto:32, ncns:5, tardy:11, eaQuestions:940 },
      { week:"Feb 10", calloffs:47, pto:52, ncns:9, tardy:16, eaQuestions:1180 },
      { week:"Feb 17", calloffs:43, pto:38, ncns:7, tardy:13, eaQuestions:1020 },
    ];

    const dayOfWeek = [
      { day:"Mon", absences:68 },{ day:"Tue", absences:42 },{ day:"Wed", absences:35 },
      { day:"Thu", absences:38 },{ day:"Fri", absences:52 },{ day:"Sat", absences:24 },{ day:"Sun", absences:18 },
    ];

    const shiftBreakdown = [
      { shift:"1st Shift (6a-2p)", absences:89, absenceRate:"4.2%", eaUsage:1840, topTopic:"PTO Policy", pct:"28%" },
      { shift:"2nd Shift (2p-10p)", absences:112, absenceRate:"5.8%", eaUsage:1620, topTopic:"Shift Schedule", pct:"34%" },
      { shift:"3rd Shift (10p-6a)", absences:63, absenceRate:"6.1%", eaUsage:823, topTopic:"Safety Protocols", pct:"41%" },
    ];

    const correlationInsights = [
      { icon:"ðŸ”—", title:"PTO questions and PTO absences moving together", detail:"Week of Feb 10: PTO questions spiked 42% and PTO call-offs increased 49%. Employees may be researching policy before requesting time off.", action:"Review PTO content â€” are employees finding what they need, or calling off because they can't figure out the process?", confidence:"Strong correlation (r=0.84 over 8 weeks)" },
      { icon:"ðŸ“Š", title:"Monday EA usage predicts Monday absences", detail:"Monday morning EA questions (6am-8am) correlate with same-day call-off volume. When pre-shift EA questions exceed 60, call-offs that day are 35% higher than average.", action:"Potential leading indicator â€” could enable proactive staffing adjustments.", confidence:"Moderate correlation (r=0.71 over 12 weeks)" },
      { icon:"âš ï¸", title:"3rd shift safety questions â†’ no matching content", detail:"3rd shift employees ask about safety protocols 3.2x more than other shifts, but resolution quality for safety is only 34%. 3rd shift also has the highest absence rate (6.1%).", action:"Update safety content with 3rd-shift-specific procedures. Possible connection between content frustration and absenteeism.", confidence:"Exploratory â€” needs more data" },
    ];

    const roiMetrics = [
      { metric:"Absenteeism Rate", before:"5.8%", current:"4.9%", change:"-15.5%", dir:"improved" },
      { metric:"NCNS Rate", before:"1.4%", current:"0.8%", change:"-43%", dir:"improved" },
      { metric:"Avg Time to Notification", before:"47 min", current:"8 min", change:"-83%", dir:"improved" },
      { metric:"HR Questions via EA (self-served)", before:"0", current:"4,283/mo", change:"New", dir:"new" },
    ];

    function UnifiedDashboard() {
      const [sec, setSec] = useState("overview");

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>HelloFresh â€” Workforce Analytics</div>
            </div>
            <div style={{ display:"flex", gap:8 }}>
              {["All Sites","Aurora, CO","Newark, NJ","Irving, TX"].map(s => (
                <button key={s} style={{ padding:"6px 14px", borderRadius:6, border:"1px solid rgba(255,255,255,0.3)", backgroundColor: s==="All Sites"?"rgba(255,255,255,0.2)":"transparent", color:"white", cursor:"pointer", fontSize:13, fontWeight:500 }}>{s}</button>
              ))}
            </div>
          </div>

          <div style={{ backgroundColor:"white", padding:"12px 32px", borderBottom:"1px solid #e5e7eb", display:"flex", gap:12, alignItems:"center", flexWrap:"wrap" }}>
            <span style={{ fontSize:13, color:"#6b7280", fontWeight:500 }}>Filters:</span>
            {["Last 30 Days","All Shifts","All Managers","All Departments"].map(f => (
              <button key={f} style={{ padding:"5px 12px", borderRadius:6, border:"1px solid #d1d5db", backgroundColor:"white", fontSize:13, cursor:"pointer", color:"#374151" }}>{f} â–¾</button>
            ))}
            <div style={{ flex:1 }} />
            <button style={{ padding:"6px 16px", borderRadius:6, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:13, fontWeight:600, cursor:"pointer" }}>Export Report</button>
          </div>

          <div style={{ padding:"16px 32px 0", display:"flex", gap:4, borderBottom:"1px solid #e5e7eb" }}>
            {[{id:"overview",label:"Overview"},{id:"attendance",label:"Attendance"},{id:"connections",label:"Connected Insights"},{id:"roi",label:"ROI"}].map(tab => (
              <button key={tab.id} onClick={() => setSec(tab.id)} style={{ padding:"10px 20px", border:"none", cursor:"pointer", fontSize:14, fontWeight:600, backgroundColor:"transparent", color: sec===tab.id?"#263D39":"#6b7280", borderBottom: sec===tab.id?"3px solid #F6B725":"3px solid transparent", marginBottom:-1 }}>
                {tab.label}
                {tab.id==="connections" && <span style={{ marginLeft:6, backgroundColor:"#F6B725", color:"#263D39", borderRadius:10, padding:"1px 7px", fontSize:10, fontWeight:700 }}>NEW</span>}
              </button>
            ))}
          </div>

          <div style={{ padding:"24px 32px" }}>
            {sec === "overview" && (
              <div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(4, 1fr)", gap:16, marginBottom:24 }}>
                  {[
                    { label:"Total Absences", value:"264", sub:"Last 30 days", color:"#263D39" },
                    { label:"Absence Rate", value:"4.9%", sub:"â†“ 0.3% from last month", color:"#16a34a" },
                    { label:"EA Questions", value:"4,283", sub:"â†‘ 12% from last month", color:"#263D39" },
                    { label:"Content Gaps", value:"4", sub:"Topics need attention", color:"#BF4B08" },
                  ].map((m,i) => (
                    <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:20, border:"1px solid #e5e7eb" }}>
                      <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:4 }}>{m.label}</div>
                      <div style={{ fontSize:28, fontWeight:700, color:m.color }}>{m.value}</div>
                      <div style={{ fontSize:12, color:"#6DAEA2", marginTop:4, fontWeight:500 }}>{m.sub}</div>
                    </div>
                  ))}
                </div>

                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Attendance & EA Activity â€” Weekly</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>See how employee questions and absences move together</div>
                  <div style={{ height:280 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <LineChart data={attendanceTrend}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="week" tick={{ fontSize:11 }} />
                        <YAxis yAxisId="left" tick={{ fontSize:11 }} />
                        <YAxis yAxisId="right" orientation="right" tick={{ fontSize:11 }} />
                        <Tooltip />
                        <Legend />
                        <Line yAxisId="left" type="monotone" dataKey="calloffs" stroke="#BF4B08" strokeWidth={2} name="Call-offs" dot={{ r:3 }} />
                        <Line yAxisId="left" type="monotone" dataKey="pto" stroke="#F6B725" strokeWidth={2} name="PTO" dot={{ r:3 }} />
                        <Line yAxisId="left" type="monotone" dataKey="ncns" stroke="#991b1b" strokeWidth={2} name="NCNS" dot={{ r:3 }} />
                        <Line yAxisId="right" type="monotone" dataKey="eaQuestions" stroke="#6DAEA2" strokeWidth={2} strokeDasharray="5 5" name="EA Questions" dot={{ r:3 }} />
                      </LineChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>By Shift</div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>
                      {["SHIFT","ABSENCES","ABSENCE RATE","EA QUESTIONS","TOP EA TOPIC"].map(h => <th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:12 }}>{h}</th>)}
                    </tr></thead>
                    <tbody>
                      {shiftBreakdown.map((r,i) => (
                        <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                          <td style={{ padding:12, fontWeight:600, color:"#263D39" }}>{r.shift}</td>
                          <td style={{ padding:12 }}>{r.absences}</td>
                          <td style={{ padding:12 }}><span style={{ color: parseFloat(r.absenceRate)>5.5?"#BF4B08":"#263D39", fontWeight:600 }}>{r.absenceRate}</span></td>
                          <td style={{ padding:12 }}>{r.eaUsage.toLocaleString()}</td>
                          <td style={{ padding:12 }}><span style={{ color:"#6DAEA2", fontWeight:500 }}>{r.topTopic}</span> <span style={{ color:"#9ca3af", fontSize:12 }}>({r.pct})</span></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {sec === "attendance" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Absence Breakdown â€” Last 30 Days</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>By type, weekly</div>
                  <div style={{ height:280 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={attendanceTrend}>
                        <CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="week" tick={{ fontSize:11 }} /><YAxis tick={{ fontSize:11 }} /><Tooltip /><Legend />
                        <Bar dataKey="calloffs" stackId="a" fill="#BF4B08" name="Call-offs" />
                        <Bar dataKey="pto" stackId="a" fill="#F6B725" name="PTO" />
                        <Bar dataKey="ncns" stackId="a" fill="#991b1b" name="NCNS" />
                        <Bar dataKey="tardy" stackId="a" fill="#6DAEA2" name="Tardy" radius={[4,4,0,0]} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Day-of-Week Pattern</div>
                  <div style={{ height:220 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={dayOfWeek}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="day" tick={{ fontSize:12 }} /><YAxis tick={{ fontSize:12 }} /><Tooltip /><Bar dataKey="absences" fill="#263D39" radius={[4,4,0,0]} name="Absences" /></BarChart>
                    </ResponsiveContainer>
                  </div>
                  <div style={{ marginTop:12, padding:12, backgroundColor:"#fefce8", borderRadius:8, fontSize:13, color:"#92400e" }}>ðŸ’¡ <strong>Monday absences are 63% higher than mid-week average.</strong> Could indicate scheduling satisfaction issues.</div>
                </div>
              </div>
            )}

            {sec === "connections" && (
              <div>
                <div style={{ backgroundColor:"#fefce8", border:"1px solid #fde68a", borderRadius:12, padding:16, marginBottom:24, display:"flex", alignItems:"center", gap:12 }}>
                  <span style={{ fontSize:20 }}>âœ¨</span>
                  <div>
                    <div style={{ fontSize:14, fontWeight:700, color:"#92400e" }}>Connected Insights</div>
                    <div style={{ fontSize:13, color:"#92400e" }}>Patterns found by looking at EA and Attendance data together â€” things neither dataset shows alone.</div>
                  </div>
                </div>
                {correlationInsights.map((ins,i) => (
                  <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:16, borderLeft:`4px solid ${i===0?"#F6B725":i===1?"#6DAEA2":"#BF4B08"}` }}>
                    <div style={{ display:"flex", alignItems:"center", gap:8, marginBottom:8 }}>
                      <span style={{ fontSize:18 }}>{ins.icon}</span>
                      <span style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>{ins.title}</span>
                    </div>
                    <div style={{ fontSize:14, color:"#374151", lineHeight:1.6, marginBottom:12 }}>{ins.detail}</div>
                    <div style={{ backgroundColor:"#F5FAF8", borderRadius:8, padding:12, fontSize:13, lineHeight:1.5, marginBottom:8 }}>
                      <span style={{ fontWeight:700, color:"#6DAEA2" }}>ðŸ’¡ What this means: </span>
                      <span style={{ color:"#263D39" }}>{ins.action}</span>
                    </div>
                    <div style={{ fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>{ins.confidence}</div>
                  </div>
                ))}
              </div>
            )}

            {sec === "roi" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:18, fontWeight:700, color:"#263D39", marginBottom:4 }}>TeamSense ROI â€” HelloFresh</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:20 }}>Before TeamSense (baseline) vs. current</div>
                  <div style={{ display:"grid", gridTemplateColumns:"repeat(2, 1fr)", gap:16 }}>
                    {roiMetrics.map((m,i) => (
                      <div key={i} style={{ border:"1px solid #e5e7eb", borderRadius:12, padding:20, backgroundColor: m.dir==="new"?"#F5FAF8":"white" }}>
                        <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:8 }}>{m.metric}</div>
                        <div style={{ display:"flex", alignItems:"center", gap:12, marginBottom:4 }}>
                          {m.dir!=="new" && <><span style={{ fontSize:20, color:"#9ca3af", textDecoration:"line-through" }}>{m.before}</span><span style={{ color:"#6b7280" }}>â†’</span></>}
                          <span style={{ fontSize:28, fontWeight:700, color: m.dir==="new"?"#6DAEA2":"#16a34a" }}>{m.current}</span>
                        </div>
                        <div style={{ fontSize:13, fontWeight:600, color: m.dir==="new"?"#6DAEA2":"#16a34a" }}>{m.dir==="new"?"New capability":`${m.change} improvement`}</div>
                      </div>
                    ))}
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"2px solid #F6B725" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:8 }}>ðŸ“‹ Ready for Your Next QBR</div>
                  <div style={{ fontSize:14, color:"#374151", lineHeight:1.6, marginBottom:16 }}>Export a formatted report with these metrics alongside attendance trends and content insights. No CSM needed.</div>
                  <button style={{ padding:"10px 24px", borderRadius:8, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:14, fontWeight:700, cursor:"pointer" }}>Export QBR Report</button>
                </div>
              </div>
            )}
          </div>
          <div style={{ textAlign:"center", padding:"8px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1 â€” Unified Workforce Analytics Â· TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       PROTOTYPE 4: PRD-FAITHFUL ATTENDANCE ANALYTICS
       Capabilities #1, #3, #4, #5, #6, #7
       ============================================================ */
    const weeklyTrendP4 = [
      { week:"Dec 1", calloffs:38, pto:24, ncns:7, tardy:11 },
      { week:"Dec 8", calloffs:41, pto:22, ncns:5, tardy:13 },
      { week:"Dec 15", calloffs:35, pto:42, ncns:6, tardy:10 },
      { week:"Dec 22", calloffs:28, pto:58, ncns:4, tardy:8 },
      { week:"Dec 29", calloffs:32, pto:51, ncns:9, tardy:12 },
      { week:"Jan 5", calloffs:48, pto:26, ncns:11, tardy:16 },
      { week:"Jan 12", calloffs:42, pto:28, ncns:8, tardy:15 },
      { week:"Jan 19", calloffs:51, pto:45, ncns:11, tardy:18 },
      { week:"Jan 26", calloffs:44, pto:35, ncns:7, tardy:14 },
      { week:"Feb 2", calloffs:39, pto:32, ncns:5, tardy:11 },
      { week:"Feb 9", calloffs:47, pto:52, ncns:9, tardy:16 },
      { week:"Feb 16", calloffs:43, pto:38, ncns:7, tardy:13 },
    ];
    const dayOfWeekP4 = [
      { day:"Mon", absences:68 },{ day:"Tue", absences:42 },{ day:"Wed", absences:35 },
      { day:"Thu", absences:38 },{ day:"Fri", absences:52 },{ day:"Sat", absences:24 },{ day:"Sun", absences:18 },
    ];
    const shiftDataP4 = [
      { shift:"1st Shift (6aâ€“2p)", headcount:2120, absences:89, rate:"4.2%", ncns:12, calloffs:48, pto:29, trend:"â†“ 0.3%", color:"#6DAEA2" },
      { shift:"2nd Shift (2pâ€“10p)", headcount:1930, absences:112, rate:"5.8%", ncns:18, calloffs:61, pto:33, trend:"â†‘ 0.4%", color:"#F6B725" },
      { shift:"3rd Shift (10pâ€“6a)", headcount:1032, absences:63, rate:"6.1%", ncns:14, calloffs:35, pto:14, trend:"â†‘ 0.8%", color:"#BF4B08" },
    ];
    const managerDataP4 = [
      { name:"Maria Gonzalez", division:"Aurora, CO", shift:"1st", headcount:42, absences:6, rate:"3.1%", ncns:0, trend:"â†“", flag:null },
      { name:"James Mitchell", division:"Aurora, CO", shift:"2nd", headcount:38, absences:12, rate:"6.8%", ncns:3, trend:"â†‘", flag:"high_ncns" },
      { name:"Rosa Hernandez", division:"Newark, NJ", shift:"1st", headcount:45, absences:5, rate:"2.4%", ncns:0, trend:"â†“", flag:null },
      { name:"DeShawn Williams", division:"Newark, NJ", shift:"3rd", headcount:31, absences:9, rate:"6.2%", ncns:4, trend:"â†‘", flag:"high_ncns" },
      { name:"Tran Nguyen", division:"Irving, TX", shift:"2nd", headcount:40, absences:14, rate:"7.5%", ncns:5, trend:"â†‘", flag:"high_rate" },
      { name:"Sarah Chen", division:"Aurora, CO", shift:"1st", headcount:44, absences:4, rate:"2.0%", ncns:0, trend:"â†“", flag:null },
      { name:"Marcus Johnson", division:"Irving, TX", shift:"3rd", headcount:28, absences:8, rate:"6.1%", ncns:3, trend:"â†’", flag:"high_ncns" },
      { name:"Angela Davis", division:"Newark, NJ", shift:"2nd", headcount:36, absences:10, rate:"6.0%", ncns:2, trend:"â†‘", flag:null },
    ];
    const divCompP4 = [
      { division:"Aurora, CO", headcount:1820, rate:"4.5%", ncnsRate:"0.6%", avgNotify:"7 min", topDay:"Monday", change:"â†“ 0.4%" },
      { division:"Newark, NJ", headcount:1680, rate:"5.2%", ncnsRate:"1.1%", avgNotify:"9 min", topDay:"Monday", change:"â†‘ 0.2%" },
      { division:"Irving, TX", headcount:1582, rate:"5.6%", ncnsRate:"1.4%", avgNotify:"11 min", topDay:"Friday", change:"â†‘ 0.5%" },
    ];
    const absTypePie = [
      { name:"Call-offs", value:488, color:"#BF4B08" },
      { name:"PTO", value:453, color:"#F6B725" },
      { name:"NCNS", value:89, color:"#991b1b" },
      { name:"Tardy", value:157, color:"#6DAEA2" },
    ];
    const roiBaseP4 = [
      { metric:"Absenteeism Rate", before:"5.8%", current:"4.9%", change:"-15.5%", method:"First 30 days vs. most recent 30 days" },
      { metric:"NCNS Rate", before:"1.4%", current:"0.8%", change:"-42.9%", method:"First 30 days vs. most recent 30 days" },
      { metric:"Avg Time to Notification", before:"47 min", current:"8 min", change:"-83.0%", method:"Pre-TeamSense baseline vs. current" },
      { metric:"Monthly Trend", before:"Flat", current:"Declining", change:"Improving", method:"12-week linear trend" },
    ];
    const monthlyTrendP4 = [
      { month:"Sep", rate:5.8 },{ month:"Oct", rate:5.5 },{ month:"Nov", rate:5.3 },
      { month:"Dec", rate:5.1 },{ month:"Jan", rate:5.0 },{ month:"Feb", rate:4.9 },
    ];

    function AttendanceAnalytics() {
      const [tab4, setTab4] = useState("overview");
      const [selDiv, setSelDiv] = useState("All Sites");
      const [selShift, setSelShift] = useState("All Shifts");
      const [selMgr, setSelMgr] = useState("All Managers");
      const [dateRng, setDateRng] = useState("Last 30 Days");
      const [showExport, setShowExport] = useState(false);

      const divs = ["All Sites","Aurora, CO","Newark, NJ","Irving, TX"];
      const shfts = ["All Shifts","1st Shift","2nd Shift","3rd Shift"];
      const mgrs = ["All Managers",...managerDataP4.map(m=>m.name)];
      const dates = ["Last 7 Days","Last 30 Days","Last 90 Days","Custom Range"];

      const filtMgrs = managerDataP4.filter(m => {
        if (selDiv !== "All Sites" && m.division !== selDiv) return false;
        if (selShift !== "All Shifts" && !m.shift.startsWith(selShift.charAt(0))) return false;
        return true;
      });

      const selStyle = (active) => ({
        padding:"5px 12px", borderRadius:6, fontSize:13, cursor:"pointer", color:"#374151",
        fontFamily:"'Urbanist', system-ui, sans-serif",
        border: active ? "2px solid #6DAEA2" : "1px solid #d1d5db",
        backgroundColor: active ? "#f0fdf4" : "white",
      });

      const p4tabs = [{id:"overview",label:"Overview"},{id:"patterns",label:"Patterns & Breakdown"},{id:"managers",label:"Manager View"},{id:"divisions",label:"Division Comparison"},{id:"roi",label:"ROI Baseline"}];

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          {/* Header */}
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>Attendance Analytics</div>
            </div>
            <div style={{ display:"flex", alignItems:"center", gap:12 }}>
              <div style={{ backgroundColor:"rgba(255,255,255,0.1)", borderRadius:8, padding:"6px 12px", fontSize:12 }}>
                <span style={{ color:"#6DAEA2", fontWeight:700 }}>â—</span> Last updated: 12 min ago
              </div>
              <div style={{ backgroundColor:"rgba(109,174,162,0.2)", border:"1px solid rgba(109,174,162,0.4)", borderRadius:8, padding:"6px 12px", fontSize:12, color:"#6DAEA2", fontWeight:600 }}>Near Real-Time</div>
            </div>
          </div>

          {/* TEDS Filter Bar */}
          <div style={{ backgroundColor:"white", padding:"12px 32px", borderBottom:"1px solid #e5e7eb", display:"flex", gap:10, alignItems:"center", flexWrap:"wrap" }}>
            <span style={{ fontSize:13, color:"#6b7280", fontWeight:600 }}>TEDS Filters:</span>
            <select value={selDiv} onChange={e=>setSelDiv(e.target.value)} style={selStyle(selDiv!=="All Sites")}>{divs.map(d=><option key={d}>{d}</option>)}</select>
            <select value={selShift} onChange={e=>setSelShift(e.target.value)} style={selStyle(selShift!=="All Shifts")}>{shfts.map(s=><option key={s}>{s}</option>)}</select>
            <select value={selMgr} onChange={e=>setSelMgr(e.target.value)} style={selStyle(selMgr!=="All Managers")}>{mgrs.map(m=><option key={m}>{m}</option>)}</select>
            <select value={dateRng} onChange={e=>setDateRng(e.target.value)} style={selStyle(false)}>{dates.map(d=><option key={d}>{d}</option>)}</select>
            <button style={{ padding:"5px 12px", borderRadius:6, border:"1px solid #d1d5db", backgroundColor:"white", fontSize:13, cursor:"pointer", color:"#374151" }}>Status Type â–¾</button>
            <div style={{ flex:1 }} />
            {(selDiv!=="All Sites"||selShift!=="All Shifts"||selMgr!=="All Managers") && (
              <button onClick={()=>{setSelDiv("All Sites");setSelShift("All Shifts");setSelMgr("All Managers");}} style={{ padding:"5px 12px", borderRadius:6, border:"none", backgroundColor:"#fef2f2", color:"#991b1b", fontSize:12, cursor:"pointer", fontWeight:600 }}>âœ• Clear Filters</button>
            )}
            <button onClick={()=>setShowExport(true)} style={{ padding:"6px 16px", borderRadius:6, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:13, fontWeight:600, cursor:"pointer" }}>Export Report</button>
          </div>

          {/* Tabs */}
          <div style={{ padding:"16px 32px 0", display:"flex", gap:4, borderBottom:"1px solid #e5e7eb" }}>
            {p4tabs.map(t=>(
              <button key={t.id} onClick={()=>setTab4(t.id)} style={{ padding:"10px 20px", border:"none", cursor:"pointer", fontSize:14, fontWeight:600, backgroundColor:"transparent", color:tab4===t.id?"#263D39":"#6b7280", borderBottom:tab4===t.id?"3px solid #F6B725":"3px solid transparent", marginBottom:-1 }}>{t.label}</button>
            ))}
          </div>

          <div style={{ padding:"24px 32px" }}>
            {/* OVERVIEW */}
            {tab4==="overview" && (
              <div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(5, 1fr)", gap:16, marginBottom:24 }}>
                  {[
                    {label:"Total Absences",value:"1,187",sub:"Last 30 days",color:"#263D39"},
                    {label:"Absence Rate",value:"4.9%",sub:"â†“ 0.3% from last month",color:"#16a34a"},
                    {label:"NCNS Rate",value:"0.8%",sub:"â†“ 0.2% from last month",color:"#16a34a"},
                    {label:"Avg Notification",value:"8 min",sub:"Target: <15 min",color:"#263D39"},
                    {label:"Peak Day",value:"Monday",sub:"63% above avg",color:"#BF4B08"},
                  ].map((c,i)=>(
                    <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:16, border:"1px solid #e5e7eb" }}>
                      <div style={{ fontSize:12, color:"#6b7280", marginBottom:4, fontWeight:500 }}>{c.label}</div>
                      <div style={{ fontSize:26, fontWeight:700, color:c.color }}>{c.value}</div>
                      <div style={{ fontSize:11, color:"#6DAEA2", marginTop:4, fontWeight:500 }}>{c.sub}</div>
                    </div>
                  ))}
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:16 }}>
                    <div><div style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>Absence Trend â€” Weekly</div><div style={{ fontSize:13, color:"#6b7280" }}>By type Â· last 12 weeks</div></div>
                    <div style={{ fontSize:12, color:"#9ca3af" }}>Data refreshes every ~1 hour</div>
                  </div>
                  <div style={{ height:300 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={weeklyTrendP4}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="week" tick={{fontSize:11}} /><YAxis tick={{fontSize:11}} /><Tooltip /><Legend />
                        <Bar dataKey="calloffs" stackId="a" fill="#BF4B08" name="Call-offs" /><Bar dataKey="pto" stackId="a" fill="#F6B725" name="PTO" /><Bar dataKey="ncns" stackId="a" fill="#991b1b" name="NCNS" /><Bar dataKey="tardy" stackId="a" fill="#6DAEA2" name="Tardy" radius={[4,4,0,0]} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Absence Rate â€” Monthly Trend</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>6-month view Â· used for ROI baseline</div>
                  <div style={{ height:200 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <LineChart data={monthlyTrendP4}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="month" tick={{fontSize:12}} /><YAxis tick={{fontSize:12}} domain={[4,6.5]} tickFormatter={v=>`${v}%`} /><Tooltip formatter={v=>[`${v}%`,"Absence Rate"]} /><Line type="monotone" dataKey="rate" stroke="#263D39" strokeWidth={2} dot={{r:4,fill:"#263D39"}} /></LineChart>
                    </ResponsiveContainer>
                  </div>
                  <div style={{ marginTop:12, padding:12, backgroundColor:"#f0fdf4", borderRadius:8, fontSize:13, color:"#16a34a", fontWeight:500 }}>Trending down: -0.9 percentage points over 6 months (5.8% â†’ 4.9%)</div>
                </div>
              </div>
            )}

            {/* PATTERNS */}
            {tab4==="patterns" && (
              <div>
                <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:24, marginBottom:24 }}>
                  <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                    <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Day-of-Week Pattern</div>
                    <div style={{ height:240 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={dayOfWeekP4}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="day" tick={{fontSize:12}} /><YAxis tick={{fontSize:12}} /><Tooltip /><Bar dataKey="absences" name="Absences" radius={[4,4,0,0]}>{dayOfWeekP4.map((e,i)=><Cell key={i} fill={e.day==="Mon"?"#BF4B08":e.day==="Fri"?"#F6B725":"#263D39"} />)}</Bar></BarChart>
                      </ResponsiveContainer>
                    </div>
                    <div style={{ marginTop:12, padding:12, backgroundColor:"#fefce8", borderRadius:8, fontSize:13, color:"#92400e" }}><strong>Monday absences are 63% above mid-week average.</strong> Friday is 28% above.</div>
                  </div>
                  <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                    <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Absence Type Distribution</div>
                    <div style={{ height:240 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart><Pie data={absTypePie} cx="50%" cy="50%" outerRadius={90} dataKey="value" label={({name,percent})=>`${name} ${(percent*100).toFixed(0)}%`} labelLine={{stroke:"#9ca3af"}}>{absTypePie.map((e,i)=><Cell key={i} fill={e.color} />)}</Pie><Tooltip /></PieChart>
                      </ResponsiveContainer>
                    </div>
                    <div style={{ display:"flex", gap:16, justifyContent:"center", marginTop:8 }}>{absTypePie.map(t=>(<span key={t.name} style={{ display:"flex", alignItems:"center", gap:4, fontSize:12 }}><span style={{ width:10, height:10, borderRadius:2, backgroundColor:t.color }} />{t.name}: {t.value}</span>))}</div>
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Shift Breakdown</div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>{["SHIFT","HEADCOUNT","ABSENCES","RATE","NCNS","CALL-OFFS","PTO","vs LAST MONTH"].map(h=><th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:12 }}>{h}</th>)}</tr></thead>
                    <tbody>{shiftDataP4.map((r,i)=>(
                      <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                        <td style={{ padding:12, fontWeight:600, color:"#263D39" }}><span style={{ display:"inline-block", width:8, height:8, borderRadius:"50%", backgroundColor:r.color, marginRight:8 }} />{r.shift}</td>
                        <td style={{ padding:12 }}>{r.headcount.toLocaleString()}</td>
                        <td style={{ padding:12, fontWeight:600 }}>{r.absences}</td>
                        <td style={{ padding:12 }}><span style={{ color:parseFloat(r.rate)>5.5?"#BF4B08":parseFloat(r.rate)>4.5?"#92400e":"#16a34a", fontWeight:700 }}>{r.rate}</span></td>
                        <td style={{ padding:12, color:r.ncns>15?"#991b1b":"#374151", fontWeight:r.ncns>15?700:400 }}>{r.ncns}</td>
                        <td style={{ padding:12 }}>{r.calloffs}</td><td style={{ padding:12 }}>{r.pto}</td>
                        <td style={{ padding:12, fontWeight:600, color:r.trend.includes("â†‘")?"#BF4B08":r.trend.includes("â†“")?"#16a34a":"#6b7280" }}>{r.trend}</td>
                      </tr>
                    ))}</tbody>
                  </table>
                  <div style={{ marginTop:16, padding:12, backgroundColor:"#fff7ed", borderRadius:8, fontSize:13, color:"#92400e" }}><strong>3rd shift has the highest absence rate (6.1%)</strong> and the steepest increase (+0.8% vs last month).</div>
                </div>
              </div>
            )}

            {/* MANAGERS */}
            {tab4==="managers" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20 }}>
                    <div><div style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>Manager-Level Attendance</div><div style={{ fontSize:13, color:"#6b7280" }}>TEDS-powered drill-down Â· {filtMgrs.length} managers shown</div></div>
                    <div style={{ fontSize:12, color:"#6b7280", backgroundColor:"#F5FAF8", padding:"6px 12px", borderRadius:6 }}>Sorted by absence rate (highest first)</div>
                  </div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>{["MANAGER","DIVISION","SHIFT","HEADCOUNT","ABSENCES","RATE","NCNS","TREND","FLAGS"].map(h=><th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:11 }}>{h}</th>)}</tr></thead>
                    <tbody>
                      {[...filtMgrs].sort((a,b)=>parseFloat(b.rate)-parseFloat(a.rate)).map((m,i)=>(
                        <tr key={i} style={{ borderBottom:"1px solid #f3f4f6", backgroundColor:m.flag?"#fff7ed":"transparent" }}>
                          <td style={{ padding:12, fontWeight:600, color:"#263D39" }}>{m.name}</td>
                          <td style={{ padding:12, color:"#6b7280", fontSize:13 }}>{m.division}</td>
                          <td style={{ padding:12, fontSize:13 }}>{m.shift}</td>
                          <td style={{ padding:12 }}>{m.headcount}</td>
                          <td style={{ padding:12, fontWeight:600 }}>{m.absences}</td>
                          <td style={{ padding:12 }}><span style={{ display:"inline-block", padding:"2px 10px", borderRadius:12, fontWeight:700, fontSize:13, backgroundColor:parseFloat(m.rate)>6?"#fef2f2":parseFloat(m.rate)>4.5?"#fefce8":"#f0fdf4", color:parseFloat(m.rate)>6?"#991b1b":parseFloat(m.rate)>4.5?"#92400e":"#16a34a" }}>{m.rate}</span></td>
                          <td style={{ padding:12, color:m.ncns>2?"#991b1b":"#374151", fontWeight:m.ncns>2?700:400 }}>{m.ncns}</td>
                          <td style={{ padding:12, fontSize:16, color:m.trend==="â†‘"?"#BF4B08":m.trend==="â†“"?"#16a34a":"#6b7280" }}>{m.trend}</td>
                          <td style={{ padding:12 }}>
                            {m.flag==="high_ncns" && <span style={{ backgroundColor:"#fef2f2", color:"#991b1b", padding:"2px 8px", borderRadius:4, fontSize:11, fontWeight:600 }}>High NCNS</span>}
                            {m.flag==="high_rate" && <span style={{ backgroundColor:"#fff7ed", color:"#BF4B08", padding:"2px 8px", borderRadius:4, fontSize:11, fontWeight:600 }}>High Rate</span>}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  {filtMgrs.filter(m=>m.flag).length > 0 && (
                    <div style={{ marginTop:20, padding:16, backgroundColor:"#fefce8", border:"1px solid #fde68a", borderRadius:8 }}>
                      <div style={{ fontSize:14, fontWeight:700, color:"#92400e", marginBottom:4 }}>Flagged Managers</div>
                      <div style={{ fontSize:13, color:"#92400e", lineHeight:1.6 }}>
                        {filtMgrs.filter(m=>m.flag==="high_ncns").length > 0 && <div>{filtMgrs.filter(m=>m.flag==="high_ncns").length} manager(s) have elevated NCNS rates â€” may indicate notification issues or engagement concerns.</div>}
                        {filtMgrs.filter(m=>m.flag==="high_rate").length > 0 && <div>{filtMgrs.filter(m=>m.flag==="high_rate").length} manager(s) have absence rates above 7% â€” significantly above 4.9% average.</div>}
                      </div>
                    </div>
                  )}
                </div>
                <div style={{ marginTop:16, padding:12, backgroundColor:"#f9fafb", border:"1px solid #e5e7eb", borderRadius:8, fontSize:12, color:"#6b7280", display:"flex", alignItems:"center", gap:8 }}>
                  <span style={{ fontSize:14 }}>â„¹ï¸</span>
                  <span><strong>TEDS coverage:</strong> Manager data available for 87% of employees. 13% mapped to division only.</span>
                </div>
              </div>
            )}

            {/* DIVISIONS */}
            {tab4==="divisions" && (
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Division Comparison</div>
                <div style={{ fontSize:13, color:"#6b7280", marginBottom:20 }}>Cross-site performance Â· last 30 days</div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(3, 1fr)", gap:20 }}>
                  {divCompP4.map((d,i)=>(
                    <div key={i} style={{ border:"1px solid #e5e7eb", borderRadius:12, padding:20, borderTop:`4px solid ${i===0?"#6DAEA2":i===1?"#F6B725":"#BF4B08"}` }}>
                      <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>{d.division}</div>
                      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:12 }}>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>Headcount</div><div style={{ fontSize:20, fontWeight:700, color:"#263D39" }}>{d.headcount.toLocaleString()}</div></div>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>Absence Rate</div><div style={{ fontSize:20, fontWeight:700, color:parseFloat(d.rate)>5.3?"#BF4B08":"#263D39" }}>{d.rate}</div><div style={{ fontSize:11, fontWeight:600, color:d.change.includes("â†“")?"#16a34a":"#BF4B08" }}>{d.change} vs last month</div></div>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>NCNS Rate</div><div style={{ fontSize:20, fontWeight:700, color:parseFloat(d.ncnsRate)>1?"#991b1b":"#263D39" }}>{d.ncnsRate}</div></div>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>Avg Notification</div><div style={{ fontSize:20, fontWeight:700, color:"#263D39" }}>{d.avgNotify}</div></div>
                      </div>
                      <div style={{ marginTop:12, padding:8, backgroundColor:"#F5FAF8", borderRadius:6, fontSize:12, color:"#6b7280" }}>Peak day: <strong>{d.topDay}</strong></div>
                    </div>
                  ))}
                </div>
                <div style={{ marginTop:20, padding:16, backgroundColor:"#fefce8", border:"1px solid #fde68a", borderRadius:8 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#92400e", marginBottom:4 }}>Cross-Division Insights</div>
                  <div style={{ fontSize:13, color:"#92400e", lineHeight:1.6 }}><strong>Irving, TX</strong> has the highest absence and NCNS rates, both trending up. Aurora is trending down. All sites peak on Monday.</div>
                </div>
              </div>
            )}

            {/* ROI */}
            {tab4==="roi" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20 }}>
                    <div><div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>ROI Baseline â€” HelloFresh</div><div style={{ fontSize:13, color:"#6b7280" }}>Auto-calculated Â· 287 days of data</div></div>
                    <div style={{ backgroundColor:"#f0fdf4", border:"1px solid #bbf7d0", borderRadius:8, padding:"6px 12px", fontSize:12, color:"#16a34a", fontWeight:600 }}>âœ“ 90+ days â€” ROI active</div>
                  </div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>{["METRIC","BASELINE (FIRST 30 DAYS)","CURRENT (LAST 30 DAYS)","CHANGE","METHODOLOGY"].map(h=><th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:11 }}>{h}</th>)}</tr></thead>
                    <tbody>{roiBaseP4.map((r,i)=>(
                      <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                        <td style={{ padding:12, fontWeight:600, color:"#263D39" }}>{r.metric}</td>
                        <td style={{ padding:12, color:"#9ca3af" }}>{r.before}</td>
                        <td style={{ padding:12, fontWeight:700, color:"#263D39" }}>{r.current}</td>
                        <td style={{ padding:12 }}><span style={{ display:"inline-block", padding:"2px 10px", borderRadius:12, fontWeight:700, fontSize:13, backgroundColor:"#f0fdf4", color:"#16a34a" }}>{r.change}</span></td>
                        <td style={{ padding:12, fontSize:12, color:"#9ca3af" }}>{r.method}</td>
                      </tr>
                    ))}</tbody>
                  </table>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:20, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#263D39", marginBottom:8 }}>Methodology</div>
                  <div style={{ fontSize:13, color:"#6b7280", lineHeight:1.6 }}>ROI baseline compares your <strong>first 30 days</strong> on TeamSense to your <strong>most recent 30 days</strong>. We show the data and trend â€” you draw the conclusions. These are descriptive, not predictive.</div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"2px solid #F6B725" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:8 }}>Ready for Your QBR</div>
                  <div style={{ fontSize:14, color:"#374151", lineHeight:1.6, marginBottom:16 }}>Export a formatted report with ROI metrics, attendance trends, and content insights. Includes TeamSense branding and all active filters. No CSM needed.</div>
                  <div style={{ display:"flex", gap:12 }}>
                    <button style={{ padding:"10px 24px", borderRadius:8, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:14, fontWeight:700, cursor:"pointer" }}>Export Formatted Report (PDF)</button>
                    <button style={{ padding:"10px 24px", borderRadius:8, border:"1px solid #d1d5db", backgroundColor:"white", color:"#263D39", fontSize:14, fontWeight:600, cursor:"pointer" }}>Export Raw Data (CSV)</button>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Export Modal */}
          {showExport && (
            <div style={{ position:"fixed", inset:0, backgroundColor:"rgba(0,0,0,0.5)", display:"flex", alignItems:"center", justifyContent:"center", zIndex:1000 }} onClick={()=>setShowExport(false)}>
              <div style={{ backgroundColor:"white", borderRadius:16, padding:32, maxWidth:520, width:"90%" }} onClick={e=>e.stopPropagation()}>
                <div style={{ fontSize:18, fontWeight:700, color:"#263D39", marginBottom:16 }}>Export Report</div>
                <div style={{ fontSize:13, color:"#6b7280", marginBottom:20, lineHeight:1.5 }}>Includes all visible metrics, respecting your active TEDS filters.</div>
                <div style={{ backgroundColor:"#F5FAF8", borderRadius:8, padding:16, marginBottom:20 }}>
                  <div style={{ fontSize:12, fontWeight:600, color:"#6b7280", marginBottom:8 }}>EXPORT INCLUDES:</div>
                  <div style={{ fontSize:13, color:"#263D39", lineHeight:1.8 }}>âœ“ Attendance trends (weekly, by type)<br/>âœ“ Day-of-week and shift patterns<br/>âœ“ Manager-level breakdown<br/>âœ“ Division comparison<br/>âœ“ ROI baseline metrics<br/>âœ“ Filters: {selDiv}, {selShift}, {dateRng}</div>
                </div>
                <div style={{ display:"flex", gap:12 }}>
                  <button style={{ flex:1, padding:"12px 20px", borderRadius:8, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:14, fontWeight:700, cursor:"pointer" }}>Download PDF</button>
                  <button style={{ flex:1, padding:"12px 20px", borderRadius:8, border:"1px solid #d1d5db", backgroundColor:"white", color:"#263D39", fontSize:14, fontWeight:600, cursor:"pointer" }}>Download CSV</button>
                </div>
                <button onClick={()=>setShowExport(false)} style={{ width:"100%", marginTop:12, padding:8, border:"none", backgroundColor:"transparent", color:"#6b7280", fontSize:13, cursor:"pointer" }}>Cancel</button>
              </div>
            </div>
          )}

          {/* Legacy Notice â€” Capability #7 */}
          <div style={{ margin:"0 32px 16px", padding:12, backgroundColor:"#f9fafb", border:"1px solid #e5e7eb", borderRadius:8, fontSize:12, color:"#6b7280", display:"flex", alignItems:"center", gap:8 }}>
            <span style={{ fontSize:14 }}>â„¹ï¸</span>
            <span>Your existing Attendance Insights (7 cards) is still available under <strong>Reports â†’ Attendance Insights</strong>. This new view adds TEDS filtering, content insights, and ROI metrics.</span>
          </div>
          <div style={{ textAlign:"center", padding:"8px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1 â€” Attendance Analytics (PRD-Faithful) Â· TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       APP SHELL â€” Tab Switcher
       ============================================================ */
    function App() {
      const [active, setActive] = useState("content-insights");
      const protos = [
        { id:"content-insights", label:"Content Insights", version:"v1" },
        { id:"content-impact", label:"Content Impact", version:"v1.5" },
        { id:"unified", label:"Unified Dashboard", version:"v1" },
        { id:"attendance", label:"Attendance Analytics", version:"PRD" },
      ];

      return (
        <div>
          <div id="proto-nav">
            <div className="nav-brand">TIP PROTOTYPES</div>
            {protos.map(p => (
              <button key={p.id} className={active===p.id?"active":""} onClick={() => setActive(p.id)}>
                {p.label}
              </button>
            ))}
          </div>
          {active === "content-insights" && <ContentInsights />}
          {active === "content-impact" && <ContentImpact />}
          {active === "unified" && <UnifiedDashboard />}
          {active === "attendance" && <AttendanceAnalytics />}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
