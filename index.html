<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shift Start Confirmation & Coverage â€” MVP Prototype</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Inter',system-ui,sans-serif; background:#f0f2f5; }
    .chat-scroll::-webkit-scrollbar { width:4px; }
    .chat-scroll::-webkit-scrollbar-thumb { background:#ccc; border-radius:4px; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
    @keyframes dotPulse { 0%,80%,100%{opacity:.3} 40%{opacity:1} }
    .animate-fade { animation:fadeIn .35s ease-out; }
    .dot-1 { animation:dotPulse 1.4s infinite; animation-delay:0s; }
    .dot-2 { animation:dotPulse 1.4s infinite; animation-delay:.2s; }
    .dot-3 { animation:dotPulse 1.4s infinite; animation-delay:.4s; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ===== BRAND =====
    const B = {
      teal: '#0D4F4F',
      tealLight: '#1a8a8a',
      offWhite: '#F0F5F4',
      orange: '#E87C3E',
    };

    // ============================================================
    // CONVERSATION SCENES â€” Pure SMS, natural language
    // Each scene: agent messages + optional suggested replies
    // Suggested replies are just hints â€” the real product uses
    // free-form natural language. We use them here because this
    // is a clickable prototype, not a real LLM.
    // ============================================================
    const SCENES = {
      start: {
        messages: [
          {
            from: 'agent',
            text: "Hi Sal. Line A as of 6:05 AM â€” 14 clocked in, looking good. A few things that need your eyes:\n\nMaria Garcia â€” no punch, no call-off. She's been reliable â€” only 1 late arrival in the last 90 days. This is unusual for her.\n\nKevin Park â€” scheduled but hasn't punched in yet. He was late twice last month.\n\nEveryone else checked out â€” 14 confirmed via badge data.\n\nLet me know about Maria and Kevin when you can.",
            time: '6:05 AM',
            delay: 2500,
          },
        ],
        replies: [
          { label: "Maria is NCNS, she didn't call anyone. Kevin just texted me, he's running late.", next: 'batch-confirm' },
          { label: "Maria called me directly â€” she's sick today, excused.", next: 'maria-excused' },
          { label: "Haven't heard from either. Give them 15 more minutes.", next: 'defer' },
        ],
      },

      // ---- BATCH CONFIRM (most common path) ----
      'batch-confirm': {
        messages: [
          {
            from: 'agent',
            text: "Got it.\n\nâ€¢ Maria Garcia â€” NCNS confirmed. No call, points will apply (3 pts, she's now at 4 total).\nâ€¢ Kevin Park â€” late arrival, sounds like it's not his fault. Marking as late, excused â€” no points.\n\nMaria's position on Line A needs coverage. How do you want to handle it â€” moving someone on-site, or should I text the available list?",
            time: '6:06 AM',
            delay: 2200,
          },
        ],
        replies: [
          { label: "I'll put Rodriguez on her station.", next: 'onsite-rebalance' },
          { label: "Yeah, text the list and see who can come in.", next: 'external-outreach' },
          { label: "We're fine â€” line can handle it with one fewer.", next: 'absorbed' },
        ],
        context: {
          title: 'Consequence Validation',
          body: "Notice what just happened: The system already detected Maria had no punch and no call-off. Sal didn't confirm an attendance fact â€” she validated the CLASSIFICATION (NCNS) and its CONSEQUENCE (points apply). For Kevin, she reclassified the system's 'missed punch' detection to 'late, excused' â€” overriding the consequence. This is consequence validation, not attendance confirmation.",
          tier: "Both responses create Tier 1 (supervisor-confirmed) records â€” the highest quality data. Sal's batch reply was parsed as two distinct classification decisions.",
          coverage: "The three coverage paths reflect UXR data: 12 of 16 manufacturing companies rebalance on-site before reaching out externally. On-site rebalancing is the primary path, not an afterthought.",
        },
      },

      // ---- ON-SITE REBALANCING ----
      'onsite-rebalance': {
        messages: [
          {
            from: 'agent',
            text: "Got it â€” logging Rodriguez covering for Maria on Line A. On-site rebalance recorded.\n\nThat's everyone accounted for. Kevin should be in soon. I'll let you know if anything changes.\n\nHave a good shift, Sal.",
            time: '6:07 AM',
            delay: 1800,
          },
        ],
        replies: [
          { label: "How many call-offs have we had this week?", next: 'followup-calloffs' },
          { label: "Is Maria usually reliable?", next: 'followup-maria' },
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'On-Site Rebalancing (Primary Path)',
          body: "Sal said 'I'll put Rodriguez on her station' â€” the agent understood the intent and logged it as structured data: absent employee (Maria), covering employee (Rodriguez), coverage type (on-site-rebalance), supervisor (Sal), line, shift, timestamp.",
          tier: "This creates a Tier 1 confirmation + coverage record. Today, this kind of on-site rebalancing is INVISIBLE to every system â€” no one records that Rodriguez moved stations. The MVP makes it visible.",
          coverage: "Coverage type: on-site-rebalance. TEDS now has a record of how Sal solved coverage. Over time, this data reveals patterns: which supervisors rebalance vs. request external help, which positions are easy to cover internally, what the typical adapt-vs-backfill ratio is per line.",
        },
      },

      // ---- EXTERNAL OUTREACH ----
      'external-outreach': {
        messages: [
          {
            from: 'agent',
            text: "Sending texts to the available list now. I'll let you know who responds.",
            time: '6:07 AM',
            delay: 1200,
          },
          {
            from: 'agent',
            text: "Update â€” Lisa Chen replied she can cover. Still waiting on Jose Martinez and Tom Davis.\n\nWant me to confirm Lisa for Line A?",
            time: '6:12 AM',
            delay: 3000,
          },
        ],
        replies: [
          { label: "Yeah, put Lisa on it. Thanks.", next: 'lisa-confirmed' },
          { label: "Wait for Jose too â€” he's faster on that line.", next: 'wait-jose' },
        ],
        context: {
          title: 'External Outreach (Secondary Path)',
          body: "Sal said 'text the list' â€” the agent sent SMS to a pre-configured available-for-coverage list. The agent monitors responses and reports back conversationally. Sal doesn't need to check a dashboard or switch apps.",
          tier: "The outreach, responses, and final assignment are all logged: who was asked, who responded, who accepted, time-to-coverage. Coverage type: external-outreach.",
          coverage: "This creates the dataset for Stage 2 recommendations. When the system eventually learns to RANK candidates, it will use this history: Lisa's acceptance rate, response time, supervisor preference patterns.",
        },
      },

      'lisa-confirmed': {
        messages: [
          {
            from: 'agent',
            text: "Done â€” Lisa confirmed for Line A. I let her know to head over.\n\nEveryone's accounted for. Have a good shift, Sal.",
            time: '6:13 AM',
            delay: 1500,
          },
        ],
        replies: [
          { label: "Did Kevin ever clock in?", next: 'followup-kevin' },
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'Coverage Secured',
          body: "Full coverage chain recorded: Maria absent > Sal requested external outreach > 3 people texted > Lisa accepted in 5 min > Sal confirmed. Time-to-coverage: 6 minutes.",
          tier: "Tier 1 confirmation + external-outreach coverage. Every step is a data point for Stage 2.",
          coverage: "TEDS now stores: coverage type (external-outreach), candidates contacted (3), accepted (Lisa), time-to-coverage (6 min), supervisor confirmation. This is the seed data for automated backfill.",
        },
      },

      'wait-jose': {
        messages: [
          {
            from: 'agent',
            text: "Got it, holding on Lisa. I'll let you know when Jose responds.",
            time: '6:13 AM',
            delay: 1200,
          },
          {
            from: 'agent',
            text: "Jose just replied â€” he can be there by 6:30. Want me to confirm Jose instead of Lisa?",
            time: '6:16 AM',
            delay: 3000,
          },
        ],
        replies: [
          { label: "Yeah, go with Jose.", next: 'jose-confirmed' },
          { label: "Actually Lisa is fine, she's already closer.", next: 'lisa-confirmed' },
        ],
        context: {
          title: 'Supervisor Preference Override',
          body: "Sal chose to wait for Jose because 'he's faster on that line.' This is exactly the supervisor judgment that Stage 2 recommendations need to learn from â€” not just who's available, but who the supervisor prefers for a given position and why.",
          tier: "The wait decision + final selection are both logged. Stage 2 will learn: Sal prefers Jose for Line A positions, even when Lisa responds first.",
          coverage: "This interaction reveals a signal that no system currently captures: positional preference. Sal knows Jose is better for this particular station. Future recommendations should rank Jose higher for Line A coverage.",
        },
      },

      'jose-confirmed': {
        messages: [
          {
            from: 'agent',
            text: "Jose confirmed for Line A, arriving by 6:30. I let Lisa know she's not needed today.\n\nEveryone's accounted for. Have a good shift, Sal.",
            time: '6:17 AM',
            delay: 1500,
          },
        ],
        replies: [
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'Coverage Secured (Jose)',
          body: "Coverage chain: Maria absent > external outreach > Lisa available first > Sal waited for Jose > Jose confirmed. Sal's preference for Jose over Lisa is captured as a signal.",
          tier: "Tier 1 + external-outreach. Time-to-coverage: 10 minutes (longer because Sal chose to wait).",
          coverage: "The system now knows: (1) Lisa responds faster, (2) Sal prefers Jose for Line A. Stage 2 can use both signals.",
        },
      },

      // ---- ABSORBED (no coverage needed) ----
      'absorbed': {
        messages: [
          {
            from: 'agent',
            text: "Got it â€” logging Maria's absence as managed without additional coverage. Line A running one short.\n\nKevin should be in soon. I'll let you know if anything changes. Have a good shift, Sal.",
            time: '6:07 AM',
            delay: 1800,
          },
        ],
        replies: [
          { label: "How many people do I usually run short?", next: 'followup-short' },
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'Absorbed â€” No Coverage Needed',
          body: "Sal said 'we're fine' â€” a deliberate operational decision. The system records this as coverage type 'absorbed' rather than treating it as no action taken. This is critical: 'absorbed' is different from 'no response.'",
          tier: "Tier 1 confirmation + absorbed coverage. The decision to NOT seek coverage is just as valuable as the decision to seek it.",
          coverage: "Over time, 'absorbed' patterns reveal which positions can run short without production impact â€” informing future staffing models and whether coverage outreach is even necessary for certain gaps.",
        },
      },

      // ---- MARIA EXCUSED (reclassification) ----
      'maria-excused': {
        messages: [
          {
            from: 'agent',
            text: "Got it â€” Maria reclassified to excused absence, no points. She called you directly so it wasn't in the system.\n\nHer spot on Line A still needs someone. How do you want to handle it â€” moving someone over, or should I text the list?\n\nThat leaves Kevin â€” any word on him?",
            time: '6:06 AM',
            delay: 2200,
          },
        ],
        replies: [
          { label: "I'll shift Rodriguez over for Maria. Kevin texted me, he's just late â€” don't count it.", next: 'excused-resolve' },
          { label: "Text the list for Maria's spot. Kevin is NCNS â€” never heard from him.", next: 'excused-outreach' },
        ],
        context: {
          title: 'Reclassification â€” Consequence Override',
          body: "Sal said 'she called me directly â€” excused.' The system detected NCNS (no punch, no call-off in the system), but Sal has information the system doesn't: Maria called her directly. Sal's reclassification OVERRIDES the system's detection and changes the consequence from 'NCNS + 3 points' to 'excused + no points.'",
          tier: "This creates a Tier 1 (actively corrected) record â€” the highest quality. The correction rate (how often supervisors override the agent) is a key learning metric: it tells us how accurate the agent's initial categorization is.",
          coverage: "Even with an excused absence, the position still needs coverage. The three coverage paths apply regardless of classification â€” because the operational problem (someone is missing) is the same.",
        },
      },

      'excused-resolve': {
        messages: [
          {
            from: 'agent',
            text: "Done.\n\nâ€¢ Maria â€” excused absence, Rodriguez covering on Line A (on-site rebalance)\nâ€¢ Kevin â€” late arrival, excused, no points\n\nEveryone accounted for. Have a good shift, Sal.",
            time: '6:07 AM',
            delay: 1800,
          },
        ],
        replies: [
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'Two Classifications in One Reply',
          body: "Sal handled both Maria and Kevin in a single natural language reply. The agent parsed: (1) Maria coverage with Rodriguez, (2) Kevin late arrival excused. Two classification decisions, two coverage decisions, one message.",
          tier: "Both are Tier 1. The agent understood 'shift Rodriguez over' as on-site rebalancing and 'don't count it' as excused/no points. Natural language makes multi-exception handling effortless.",
          coverage: "Two coverage outcomes in one reply: Maria coverage via on-site-rebalance (Rodriguez), Kevin no coverage needed (he's coming in). All logged as structured data.",
        },
      },

      'excused-outreach': {
        messages: [
          {
            from: 'agent',
            text: "Got it.\n\nâ€¢ Maria â€” excused absence, texting the available list for Line A coverage now.\nâ€¢ Kevin â€” NCNS confirmed. No call, points will apply (3 pts, now at 5 total).\n\nI'll let you know who responds for Maria's spot.",
            time: '6:06 AM',
            delay: 2000,
          },
          {
            from: 'agent',
            text: "Lisa Chen can cover Line A â€” she responded right away. Confirm her?",
            time: '6:11 AM',
            delay: 3000,
          },
        ],
        replies: [
          { label: "Yes, put Lisa on it.", next: 'excused-lisa-done' },
        ],
        context: {
          title: 'Mixed Classifications + External Outreach',
          body: "Two different classifications in one reply: Maria (excused) and Kevin (NCNS). Two different consequences: no points for Maria, 3 points for Kevin. External outreach initiated for Maria's coverage.",
          tier: "Both Tier 1. Maria corrected from suspected NCNS to excused. Kevin confirmed as NCNS. Coverage: external-outreach for Maria's position.",
          coverage: "Even though Maria is excused (not NCNS), her position still needs coverage. The coverage trigger fires on the gap, not the classification.",
        },
      },

      'excused-lisa-done': {
        messages: [
          {
            from: 'agent',
            text: "Lisa confirmed for Line A. Everyone's accounted for.\n\nKevin's NCNS â€” that's his 2nd this quarter. I'll include the pattern in your shift digest.\n\nHave a good shift, Sal.",
            time: '6:12 AM',
            delay: 1500,
          },
        ],
        replies: [
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'Coverage Complete + Pattern Note',
          body: "The agent adds context: Kevin's NCNS is his 2nd this quarter. This isn't an alert that demands action now â€” it's a note that will be expanded in the digest when Sal has bandwidth to think about it.",
          tier: "All Tier 1. Lisa confirmed via external outreach. Kevin's pattern flagged for digest.",
          coverage: "Coverage: Maria via external-outreach (Lisa). Kevin no coverage needed (NCNS, position empty). Both logged in TEDS with full chain of events.",
        },
      },

      // ---- DEFER ----
      'defer': {
        messages: [
          {
            from: 'agent',
            text: "Will do â€” I'll check back on Maria and Kevin at 6:20. If either of them punches in before then, I'll let you know right away.",
            time: '6:06 AM',
            delay: 1500,
          },
          {
            from: 'agent',
            text: "Update: Kevin just badged in at 6:18. He's on the floor.\n\nStill nothing from Maria â€” no punch, no call-off. Want to call it NCNS, or give her more time?",
            time: '6:20 AM',
            delay: 4000,
          },
        ],
        replies: [
          { label: "Kevin's fine. Maria is NCNS at this point.", next: 'deferred-ncns' },
          { label: "Kevin's fine. Let me try calling Maria real quick.", next: 'deferred-wait' },
        ],
        context: {
          title: 'Deferred Confirmation',
          body: "Sal asked for 15 more minutes. The agent set a timer and proactively checked back. Meanwhile, Kevin's badge data resolved automatically â€” no supervisor action needed. This is the agent working for Sal, not the other way around.",
          tier: "Kevin auto-resolves to agent-confirmed (Tier 2) when badge data arrives. Maria is still unresolved, waiting for Sal's classification. If Sal never responds, Maria stays at agent-confirmed tier after the 30-minute window.",
          coverage: "No coverage triggered yet â€” Maria's classification is still pending. Coverage prompt will follow once Sal makes the call.",
        },
      },

      'deferred-ncns': {
        messages: [
          {
            from: 'agent',
            text: "Done.\n\nâ€¢ Kevin â€” present, on time. No points.\nâ€¢ Maria â€” NCNS confirmed. 3 points applied (now at 4 total).\n\nMaria's spot on Line A â€” how do you want to handle it?",
            time: '6:21 AM',
            delay: 1800,
          },
        ],
        replies: [
          { label: "I already moved Chen over there. We're covered.", next: 'deferred-covered' },
          { label: "Text the list, see who's available.", next: 'external-outreach' },
          { label: "We'll run one short, it's fine.", next: 'absorbed' },
        ],
        context: {
          title: 'Deferred then Confirmed NCNS',
          body: "15 minutes later, Sal made the call: Maria is NCNS. Notice that Sal may have ALREADY moved someone to cover Maria's position during the wait â€” the 'I already moved Chen' option captures coverage decisions that happened outside the conversation.",
          tier: "Kevin: Tier 2 (agent-confirmed via badge). Maria: Tier 1 (supervisor-confirmed NCNS). The different tiers reflect the different confirmation methods.",
          coverage: "Three coverage options. The first option â€” 'I already moved Chen' â€” is important: supervisors often handle coverage physically before texting. The agent needs to capture these retroactive decisions.",
        },
      },

      'deferred-covered': {
        messages: [
          {
            from: 'agent',
            text: "Got it â€” logging Chen covering for Maria on Line A. On-site rebalance recorded.\n\nAll set. Have a good shift, Sal.",
            time: '6:22 AM',
            delay: 1500,
          },
        ],
        replies: [
          { label: "(Wait for shift digest)", next: 'digest' },
        ],
        context: {
          title: 'Retroactive Coverage Capture',
          body: "Sal moved Chen BEFORE texting back. The agent captures the decision retroactively. In today's world, this kind of on-site rebalancing is completely invisible â€” no system records it. The MVP makes it visible.",
          tier: "Tier 1 + on-site-rebalance. Even though the physical coverage happened before the text, the structured record is created now.",
          coverage: "Critical insight: coverage decisions often happen physically (walking over, tapping someone on the shoulder) before they're communicated digitally. The agent must capture retroactive coverage decisions through natural conversation.",
        },
      },

      'deferred-wait': {
        messages: [
          {
            from: 'agent',
            text: "Take your time. I'll keep an eye out for Maria's badge data.",
            time: '6:21 AM',
            delay: 1200,
          },
        ],
        replies: [
          { label: "OK I called her â€” she's sick. Excused.", next: 'deferred-excused' },
          { label: "No answer. Mark her NCNS.", next: 'deferred-ncns' },
        ],
        context: {
          title: 'Supervisor Investigation',
          body: "Sal is calling Maria directly â€” investigating before making a classification. This is the human judgment the system can't replicate. The agent waits patiently.",
          tier: "No classification yet. Maria remains unresolved until Sal decides. The 30-minute window is still running.",
          coverage: "No coverage triggered until classification is confirmed. The agent doesn't assume â€” it waits for Sal.",
        },
      },

      'deferred-excused': {
        messages: [
          {
            from: 'agent',
            text: "Got it â€” Maria marked as excused absence (called you directly, sick). No points.\n\nHer spot on Line A still needs someone though. Moving someone over, or should I text the list?",
            time: '6:23 AM',
            delay: 1800,
          },
        ],
        replies: [
          { label: "Already moved Chen. We're good.", next: 'deferred-covered' },
          { label: "Text the list.", next: 'external-outreach' },
          { label: "We're fine short-handed.", next: 'absorbed' },
        ],
        context: {
          title: 'Investigation then Excused',
          body: "Sal called Maria, found out she's sick, and reclassified to excused. This is exactly the scenario the system can't handle alone â€” Maria didn't use the system to call off, she called Sal directly. Without Sal's input, this stays as suspected NCNS forever.",
          tier: "Tier 1 â€” supervisor actively corrected the classification based on information only she had.",
          coverage: "Same three coverage paths. The operational problem (empty position) is the same regardless of whether Maria is NCNS or excused.",
        },
      },

      // ---- FOLLOW-UP Q&A ----
      'followup-calloffs': {
        messages: [
          {
            from: 'agent',
            text: "This week on Line A: 4 call-offs total.\n\nMon â€” David Lee (PTO, pre-approved)\nTue â€” clean shift, everyone in\nWed â€” Aisha Brooks (late 45 min, car trouble)\nToday â€” Maria Garcia (NCNS)\n\nThat's a bit above your 30-day average of 2.1 per week. Anything else?",
            time: '6:08 AM',
            delay: 2000,
          },
        ],
        replies: [
          { label: "Is Maria usually reliable?", next: 'followup-maria' },
          { label: "That's all, thanks.", next: 'digest' },
        ],
        context: {
          title: 'Conversational Follow-Up (CR-6)',
          body: "Sal asked a natural follow-up question and got an answer from the same conversation. The Attendance agent already handles this query â€” the MVP connects it to the shift start context. No app switching, no dashboard lookup.",
          tier: "Follow-up Q&A doesn't change confirmation tiers â€” it's informational. But follow-up USAGE is a tracked learning metric: what do supervisors want to know?",
          coverage: "N/A â€” this is informational, not a coverage decision.",
        },
      },

      'followup-maria': {
        messages: [
          {
            from: 'agent',
            text: "Maria Garcia â€” generally reliable. Over the last 90 days:\n\nâ€¢ 1 late arrival (Feb 3, 20 min, excused)\nâ€¢ 0 NCNS before today\nâ€¢ 0 call-offs\nâ€¢ Current points: 4 (after today's NCNS)\n\nToday's NCNS is unusual for her. No prior pattern.",
            time: '6:09 AM',
            delay: 2000,
          },
        ],
        replies: [
          { label: "Good to know. That's all.", next: 'digest' },
        ],
        context: {
          title: 'Employee History Query',
          body: "Sal asked 'Is Maria usually reliable?' â€” the NCNS agent already answers this exact question. The agent provides factual history without making a recommendation. The supervisor draws their own conclusion.",
          tier: "Informational. The agent surfaces data; the supervisor interprets it.",
          coverage: "N/A â€” informational.",
        },
      },

      'followup-kevin': {
        messages: [
          {
            from: 'agent',
            text: "Yes â€” Kevin badged in at 6:22 AM. He's on the floor.\n\nHis late arrival was already marked as excused (car trouble, per your earlier confirmation). No points applied.",
            time: '6:25 AM',
            delay: 1800,
          },
        ],
        replies: [
          { label: "Great, thanks.", next: 'digest' },
        ],
        context: {
          title: 'Status Check Follow-Up',
          body: "Sal checked back on Kevin an hour later â€” the agent answered from the same conversation thread, with full context of what was already discussed and decided.",
          tier: "No tier change â€” informational. The agent remembered the earlier excused classification and confirmed Kevin's current status.",
          coverage: "N/A â€” Kevin is now present.",
        },
      },

      'followup-short': {
        messages: [
          {
            from: 'agent',
            text: "Over the last 30 days, Line A ran one short 6 times out of 22 shifts (27%). You absorbed the gap without external coverage each time.\n\nWhen you did bring someone in, average time-to-coverage was 8 minutes.",
            time: '6:08 AM',
            delay: 2000,
          },
        ],
        replies: [
          { label: "Got it, thanks.", next: 'digest' },
        ],
        context: {
          title: 'Operational Pattern Query',
          body: "This is the kind of question that NO system answers today. The agent can answer it because the MVP logs adaptation decisions â€” creating the dataset that makes this query possible.",
          tier: "Informational. But notice: this answer is only possible because prior shifts logged 'absorbed' coverage decisions. Without adaptation logging (CR-5), this data wouldn't exist.",
          coverage: "N/A â€” meta-analysis of past coverage patterns.",
        },
      },

      // ---- SHIFT DIGEST ----
      'digest': {
        messages: [
          {
            from: 'agent',
            text: "Line A shift wrap-up:\n\n14 of 16 on the floor\n3 exceptions resolved:\n  â€” Maria Garcia: NCNS (confirmed by you), covered\n  â€” Kevin Park: late, excused (car trouble)\n  â€” All coverage handled\n\nPoints digest:\n  â€” Maria Garcia: now at 4 pts (next threshold: verbal warning at 5 pts). May want to check in with her next shift.\n\nConfirmation quality: 100% supervisor-confirmed for today's exceptions.\n\nFull details: ts.link/sal/line-a/feb-16",
            time: '6:35 AM',
            delay: 3000,
          },
        ],
        replies: [
          { label: "Restart Demo", next: '__restart__' },
        ],
        context: {
          title: 'Supervisor Shift Digest (CR-7)',
          body: "The digest closes the loop. Key design decision: points threshold alerts ('Maria is at 4/5 pts') appear HERE â€” not during the shift-start triage flow. At shift start, Sal needs to run the line. Points conversations happen after the line is running.",
          tier: "The digest summarizes today's confirmation quality. 100% supervisor-confirmed means every exception was actively classified by Sal â€” the best possible data quality.",
          coverage: "The coverage summary shows what happened. The mobile web link (ts.link/...) provides richer detail: full roster, timeline, coverage chain. This is the bridge to detail that SMS can't efficiently carry.",
        },
      },
    };

    // ============================================================
    // COMPONENTS
    // ============================================================

    // Typing indicator
    const TypingDots = () => (
      <div className="animate-fade" style={{display:'flex',alignItems:'flex-end',gap:8,padding:'4px 16px'}}>
        <div style={{width:28,height:28,borderRadius:'50%',background:B.teal,flexShrink:0,display:'flex',alignItems:'center',justifyContent:'center'}}>
          <span style={{color:'white',fontSize:12,fontWeight:700}}>T</span>
        </div>
        <div style={{background:'#e8e8e8',borderRadius:'16px 16px 16px 4px',padding:'10px 16px',display:'flex',gap:4}}>
          <span className="dot-1" style={{width:6,height:6,borderRadius:'50%',background:'#999',display:'block'}}/>
          <span className="dot-2" style={{width:6,height:6,borderRadius:'50%',background:'#999',display:'block'}}/>
          <span className="dot-3" style={{width:6,height:6,borderRadius:'50%',background:'#999',display:'block'}}/>
        </div>
      </div>
    );

    // Chat message bubble
    const ChatBubble = ({ msg }) => {
      const isUser = msg.from === 'user';
      return (
        <div className="animate-fade" style={{display:'flex',flexDirection:'column',alignItems:isUser?'flex-end':'flex-start',padding:'4px 16px',gap:4}}>
          <div style={{display:'flex',alignItems:'flex-end',gap:8,maxWidth:'85%',flexDirection:isUser?'row-reverse':'row'}}>
            {!isUser && (
              <div style={{width:28,height:28,borderRadius:'50%',background:B.teal,flexShrink:0,display:'flex',alignItems:'center',justifyContent:'center'}}>
                <span style={{color:'white',fontSize:12,fontWeight:700}}>T</span>
              </div>
            )}
            <div style={{
              background:isUser?'#0B93F6':'#e8e8e8',
              color:isUser?'white':'#1a1a1a',
              borderRadius:isUser?'18px 18px 4px 18px':'18px 18px 18px 4px',
              padding:'10px 14px',
              fontSize:14,
              lineHeight:'1.45',
              whiteSpace:'pre-line',
            }}>
              {msg.text}
            </div>
          </div>
          <span style={{fontSize:11,color:'#999',padding:isUser?'0 4px 0 0':'0 0 0 36px'}}>{msg.time}</span>
        </div>
      );
    };

    // SMS channel indicator
    const SMSBadge = () => (
      <div style={{display:'flex',justifyContent:'center',padding:'8px 0'}}>
        <span style={{background:'#f0f0f0',color:'#888',fontSize:11,fontWeight:600,padding:'3px 10px',borderRadius:12}}>
          SMS Â· Text Message
        </span>
      </div>
    );

    // Reply suggestions
    const ReplySuggestions = ({ replies, onReply }) => (
      <div style={{padding:'8px 12px 12px',borderTop:'1px solid #eee',background:'white'}}>
        <div style={{fontSize:10,color:'#999',marginBottom:6,textAlign:'center',fontStyle:'italic'}}>
          In production, Sal types freely. Tap a suggested reply to continue:
        </div>
        <div style={{display:'flex',flexDirection:'column',gap:6}}>
          {replies.map((r, i) => (
            <button key={i} onClick={() => onReply(r)}
              style={{
                background:'white',border:'1.5px solid #d0d0d0',borderRadius:20,padding:'8px 14px',
                fontSize:13,color:'#333',cursor:'pointer',textAlign:'left',lineHeight:'1.3',
                transition:'all .15s',
              }}
              onMouseOver={e => {e.target.style.background='#f5f5f5';e.target.style.borderColor=B.tealLight}}
              onMouseOut={e => {e.target.style.background='white';e.target.style.borderColor='#d0d0d0'}}
            >
              {r.label}
            </button>
          ))}
        </div>
      </div>
    );

    // Context Panel
    const ContextPanel = ({ context }) => {
      if (!context) return (
        <div style={{flex:'1 1 380px',maxWidth:420,minWidth:320}}>
          <div style={{background:'white',borderRadius:16,border:'1px solid #e0e0e0',padding:24}}>
            <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:16}}>
              <div style={{width:32,height:32,borderRadius:8,background:B.offWhite,display:'flex',alignItems:'center',justifyContent:'center'}}>
                <span style={{fontSize:16}}>ðŸ“‹</span>
              </div>
              <div>
                <h3 style={{fontWeight:700,fontSize:14,color:B.teal}}>Design Context</h3>
                <p style={{fontSize:11,color:'#999'}}>For engineering & design review</p>
              </div>
            </div>
            <p style={{fontSize:13,color:'#666',lineHeight:'1.5'}}>
              Tap a reply in the conversation to see design rationale for each interaction step.
            </p>
            <div style={{marginTop:16,padding:12,background:'#f8f9fa',borderRadius:8}}>
              <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:8}}>Key MVP Principles</div>
              <div style={{fontSize:12,color:'#555',lineHeight:'1.6'}}>
                <p style={{marginBottom:8}}><strong>SMS-only.</strong> No RCS, no rich cards, no structured inputs. Natural language via SMS â€” like texting a knowledgeable colleague.</p>
                <p style={{marginBottom:8}}><strong>Consequence validation.</strong> Supervisors confirm classifications and consequences â€” not attendance facts the system already knows.</p>
                <p style={{marginBottom:8}}><strong>Dual-path coverage.</strong> On-site rebalancing (primary, 12/16 companies) + external outreach (secondary) + absorbed.</p>
                <p style={{marginBottom:8}}><strong>Points in digest.</strong> Threshold alerts appear after the line is running â€” not during triage.</p>
                <p><strong>3-tier quality model.</strong> Supervisor-confirmed / Agent-confirmed / Unconfirmed. (Expands to 6 tiers in later stages.)</p>
              </div>
            </div>
          </div>
        </div>
      );

      return (
        <div className="animate-fade" style={{flex:'1 1 380px',maxWidth:420,minWidth:320}} key={context.title}>
          <div style={{background:'white',borderRadius:16,border:'1px solid #e0e0e0',padding:24}}>
            <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:16}}>
              <div style={{width:32,height:32,borderRadius:8,background:B.offWhite,display:'flex',alignItems:'center',justifyContent:'center'}}>
                <span style={{fontSize:16}}>ðŸ“‹</span>
              </div>
              <div>
                <h3 style={{fontWeight:700,fontSize:14,color:B.teal}}>Design Context</h3>
                <p style={{fontSize:11,color:'#999'}}>For engineering & design review</p>
              </div>
            </div>

            <div style={{marginBottom:16}}>
              <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:4}}>Current Step</div>
              <div style={{fontWeight:700,color:B.teal,fontSize:15}}>{context.title}</div>
            </div>

            <div style={{marginBottom:16}}>
              <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:6}}>What's Happening</div>
              <p style={{fontSize:12,color:'#555',lineHeight:'1.6',background:'#f8f9fa',padding:12,borderRadius:8}}>
                {context.body}
              </p>
            </div>

            <div style={{marginBottom:16}}>
              <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:6}}>Confirmation Quality</div>
              <p style={{fontSize:12,color:'#555',lineHeight:'1.6',background:'#f0f5f4',padding:12,borderRadius:8,borderLeft:'3px solid '+B.tealLight}}>
                {context.tier}
              </p>
            </div>

            <div>
              <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:6}}>Coverage & Data</div>
              <p style={{fontSize:12,color:'#555',lineHeight:'1.6',background:'#fff8f0',padding:12,borderRadius:8,borderLeft:'3px solid '+B.orange}}>
                {context.coverage}
              </p>
            </div>
          </div>
        </div>
      );
    };

    // Phone frame
    const PhoneFrame = ({ children }) => (
      <div style={{width:375,flexShrink:0}}>
        <div style={{border:'8px solid #1a1a1a',borderRadius:36,background:'white',boxShadow:'0 20px 60px rgba(0,0,0,0.15)',overflow:'hidden'}}>
          <div style={{background:'#1a1a1a',color:'white',display:'flex',justifyContent:'space-between',alignItems:'center',padding:'8px 20px',fontSize:12,fontWeight:600}}>
            <span>9:41</span>
            <span style={{display:'flex',gap:4,alignItems:'center'}}>
              <span style={{fontSize:10}}>5G</span>
              <span style={{letterSpacing:1}}>||||</span>
            </span>
          </div>
          <div style={{background:'white',borderBottom:'1px solid #eee',padding:'10px 16px',display:'flex',alignItems:'center',gap:10}}>
            <div style={{width:34,height:34,borderRadius:'50%',background:B.teal,display:'flex',alignItems:'center',justifyContent:'center'}}>
              <span style={{color:'white',fontSize:14,fontWeight:800}}>T</span>
            </div>
            <div>
              <div style={{fontWeight:700,fontSize:14,color:'#1a1a1a'}}>TeamSense</div>
              <div style={{fontSize:11,color:'#999'}}>SMS Â· Shift Start Agent</div>
            </div>
          </div>
          <div style={{height:560}}>
            {children}
          </div>
        </div>
      </div>
    );

    // Welcome overlay
    const WelcomeOverlay = ({ onStart }) => (
      <div style={{position:'fixed',inset:0,zIndex:50,display:'flex',alignItems:'center',justifyContent:'center',background:'rgba(0,0,0,0.6)',backdropFilter:'blur(4px)'}}>
        <div className="animate-fade" style={{background:'white',borderRadius:20,maxWidth:640,width:'100%',margin:16,overflow:'hidden',boxShadow:'0 20px 60px rgba(0,0,0,0.3)'}}>
          <div style={{padding:'32px 32px 16px'}}>
            <div style={{display:'flex',alignItems:'center',gap:12,marginBottom:8}}>
              <div style={{width:40,height:40,borderRadius:12,background:B.teal,display:'flex',alignItems:'center',justifyContent:'center'}}>
                <span style={{color:'white',fontSize:20,fontWeight:800}}>T</span>
              </div>
              <div>
                <h1 style={{fontWeight:800,fontSize:20,color:B.teal}}>Shift Start Confirmation & Coverage</h1>
                <p style={{fontSize:13,color:'#999'}}>MVP Prototype â€” SMS Natural Language</p>
              </div>
            </div>
          </div>

          <div style={{padding:'0 32px 16px'}}>
            <p style={{fontSize:14,color:'#444',lineHeight:'1.6'}}>
              This prototype demonstrates the <strong>MVP experience for Supervisor Sal</strong> â€” an AI-composed SMS conversation at shift start. Sal confirms attendance <strong>classifications and consequences</strong> through natural language, then handles coverage through <strong>on-site rebalancing</strong>, <strong>external outreach</strong>, or <strong>absorb</strong>. Points alerts appear in the <strong>end-of-shift digest</strong>, not during triage.
            </p>
          </div>

          <div style={{padding:'0 32px 16px'}}>
            <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:12}}>What This Demonstrates (8 Core Capabilities)</div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}>
              {[
                { num:'CR-1', label:'AI-composed shift summary with names and context' },
                { num:'CR-2', label:'Natural language SMS confirmation (consequence validation)' },
                { num:'CR-3', label:'Confirmation storage with 3-tier quality signal' },
                { num:'CR-4', label:'Coverage action trigger (dual-path: on-site + external)' },
                { num:'CR-5', label:'Adaptation logging (on-site-rebalance / external / absorbed)' },
                { num:'CR-6', label:'Conversational follow-up Q&A' },
                { num:'CR-7', label:'Supervisor shift digest with points alerts' },
                { num:'CR-8', label:'HR daily digest (described, not shown â€” email format)' },
              ].map((item, i) => (
                <div key={i} style={{display:'flex',gap:8,alignItems:'flex-start',fontSize:12}}>
                  <span style={{background:B.offWhite,color:B.teal,fontWeight:700,fontSize:10,padding:'2px 6px',borderRadius:4,flexShrink:0,marginTop:1}}>{item.num}</span>
                  <span style={{color:'#555',lineHeight:'1.4'}}>{item.label}</span>
                </div>
              ))}
            </div>
          </div>

          <div style={{padding:'0 32px 16px'}}>
            <div style={{fontSize:11,fontWeight:600,color:'#999',textTransform:'uppercase',letterSpacing:'.5px',marginBottom:8}}>How to Interact</div>
            <p style={{fontSize:12,color:'#666',lineHeight:'1.5'}}>
              In production, Sal types freely â€” the agent uses LLM-powered natural language understanding. In this prototype, <strong>tap suggested replies</strong> to navigate branching conversation paths. The <strong>context panel</strong> (right side) explains the design rationale at each step.
            </p>
          </div>

          <div style={{padding:'0 32px'}}>
            <div style={{display:'flex',gap:12,alignItems:'center',padding:'12px 16px',background:'#f8f9fa',borderRadius:12,marginBottom:16}}>
              <span style={{background:'#f0f0f0',color:'#888',fontSize:11,fontWeight:700,padding:'3px 10px',borderRadius:12}}>SMS</span>
              <span style={{fontSize:12,color:'#666'}}>Entire MVP is SMS-only. RCS rich cards are Vision Layer 3 â€” <strong>not in this MVP</strong>.</span>
            </div>
          </div>

          <div style={{padding:'0 32px 32px'}}>
            <button onClick={onStart}
              style={{width:'100%',padding:'14px',borderRadius:12,background:B.teal,color:'white',fontWeight:700,fontSize:14,border:'none',cursor:'pointer'}}
              onMouseOver={e => e.target.style.opacity='.9'}
              onMouseOut={e => e.target.style.opacity='1'}>
              Start the Demo
            </button>
          </div>
        </div>
      </div>
    );

    // ============================================================
    // MAIN APP
    // ============================================================
    function App() {
      const [messages, setMessages] = useState([]);
      const [replies, setReplies] = useState([]);
      const [typing, setTyping] = useState(false);
      const [context, setContext] = useState(null);
      const [showWelcome, setShowWelcome] = useState(true);
      const [started, setStarted] = useState(false);
      const chatRef = useRef(null);
      const timeoutsRef = useRef([]);

      const sched = (fn, ms) => {
        const id = setTimeout(fn, ms);
        timeoutsRef.current.push(id);
      };

      useEffect(() => {
        if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight;
      }, [messages, typing]);

      useEffect(() => {
        return () => timeoutsRef.current.forEach(id => clearTimeout(id));
      }, []);

      const playScene = (sceneId, userMsg) => {
        if (sceneId === '__restart__') {
          timeoutsRef.current.forEach(id => clearTimeout(id));
          timeoutsRef.current = [];
          setMessages([]);
          setReplies([]);
          setTyping(false);
          setContext(null);
          setStarted(false);
          sched(() => {
            setStarted(true);
            runScene('start', null);
          }, 300);
          return;
        }
        runScene(sceneId, userMsg);
      };

      const runScene = (sceneId, userMsg) => {
        setReplies([]);
        const sc = SCENES[sceneId];
        if (!sc) return;

        let delay = 0;

        if (userMsg) {
          setMessages(prev => [...prev, { from:'user', text:userMsg, time:new Date().toLocaleTimeString([],{hour:'numeric',minute:'2-digit'}), id:'u-'+Date.now() }]);
          delay = 800;
        }

        sc.messages.forEach((msg, i) => {
          sched(() => setTyping(true), delay);
          delay += (msg.delay || 1500);
          const m = {...msg, id: sceneId+'-'+i+'-'+Date.now()};
          sched(() => {
            setTyping(false);
            setMessages(prev => [...prev, m]);
          }, delay);
          delay += 400;
        });

        if (sc.replies) {
          sched(() => setReplies(sc.replies), delay + 300);
        }

        if (sc.context) {
          sched(() => setContext(sc.context), delay);
        }
      };

      const handleStart = () => {
        setShowWelcome(false);
        setStarted(true);
        sched(() => runScene('start', null), 500);
      };

      const handleReply = (reply) => {
        playScene(reply.next, reply.label);
      };

      return (
        <div style={{minHeight:'100vh',background:'#f0f2f5'}}>
          {/* Header */}
          <div style={{borderBottom:'1px solid #e0e0e0',background:'white'}}>
            <div style={{maxWidth:1200,margin:'0 auto',padding:'12px 24px',display:'flex',alignItems:'center',justifyContent:'space-between'}}>
              <div style={{display:'flex',alignItems:'center',gap:12}}>
                <div style={{width:32,height:32,borderRadius:8,background:B.teal,display:'flex',alignItems:'center',justifyContent:'center'}}>
                  <span style={{color:'white',fontSize:16,fontWeight:800}}>T</span>
                </div>
                <div>
                  <h1 style={{fontWeight:800,fontSize:15,color:B.teal}}>Shift Start Confirmation & Coverage â€” MVP</h1>
                  <p style={{fontSize:11,color:'#999'}}>SMS Natural Language Â· Consequence Validation Â· Dual-Path Coverage</p>
                </div>
              </div>
              <div style={{display:'flex',alignItems:'center',gap:12}}>
                <span style={{background:'#f0f0f0',color:'#888',fontSize:11,fontWeight:700,padding:'4px 12px',borderRadius:12}}>SMS Only</span>
                <button onClick={() => setShowWelcome(true)}
                  style={{width:28,height:28,borderRadius:'50%',border:'2px solid #ccc',background:'white',cursor:'pointer',fontWeight:700,color:'#999',fontSize:12,display:'flex',alignItems:'center',justifyContent:'center'}}
                  title="Show instructions">?</button>
              </div>
            </div>
          </div>

          {/* Main content */}
          <div style={{maxWidth:1200,margin:'0 auto',padding:24,display:'flex',gap:24,alignItems:'flex-start',justifyContent:'center'}}>
            <PhoneFrame>
              <div style={{display:'flex',flexDirection:'column',height:'100%'}}>
                <SMSBadge/>
                <div ref={chatRef} className="chat-scroll" style={{flex:1,overflowY:'auto',paddingBottom:8,background:'#fafafa'}}>
                  {!started && !showWelcome && (
                    <div style={{display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',height:'100%',textAlign:'center',padding:'0 32px'}}>
                      <p style={{fontSize:14,color:'#999'}}>Starting conversation...</p>
                    </div>
                  )}
                  {messages.length > 0 && (
                    <div style={{display:'flex',justifyContent:'center',padding:'8px 0'}}>
                      <span style={{background:'#e8f5e9',color:'#2e7d32',fontSize:11,fontWeight:600,padding:'3px 10px',borderRadius:12}}>
                        14 employees auto-confirmed via badge data
                      </span>
                    </div>
                  )}
                  {messages.map(msg => <ChatBubble key={msg.id} msg={msg}/>)}
                  {typing && <TypingDots/>}
                </div>
                {replies.length > 0 && <ReplySuggestions replies={replies} onReply={handleReply}/>}
              </div>
            </PhoneFrame>

            <ContextPanel context={context}/>
          </div>

          {showWelcome && <WelcomeOverlay onStart={handleStart}/>}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
