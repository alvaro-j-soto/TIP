<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TIP Research Prototypes ‚Äî TeamSense</title>
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- React 18.2 from cdnjs (verified available) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <!-- react-is: required peer dep for Recharts UMD -->
  <script src="https://cdn.jsdelivr.net/npm/react-is@18.2.0/umd/react-is.production.min.js"></script>
  <!-- Recharts 3.2.1 from cdnjs (confirmed available on cdnjs.com/libraries/recharts) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/3.2.1/Recharts.min.js"></script>
  <!-- Babel standalone for JSX transpilation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Urbanist', system-ui, sans-serif; background: #F5FAF8; }
    #proto-nav {
      position: sticky; top: 0; z-index: 100;
      background: #1a2b28; padding: 0 32px;
      display: flex; align-items: center; gap: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    #proto-nav .nav-brand {
      font-size: 13px; font-weight: 700; color: #6DAEA2;
      letter-spacing: 1px; margin-right: 32px; padding: 14px 0;
    }
    #proto-nav button {
      background: none; border: none; color: rgba(255,255,255,0.6);
      font-family: 'Urbanist', system-ui, sans-serif;
      font-size: 14px; font-weight: 600; padding: 14px 20px;
      cursor: pointer; border-bottom: 3px solid transparent;
      transition: all 0.15s;
    }
    #proto-nav button:hover { color: white; }
    #proto-nav button.active { color: white; border-bottom-color: #F6B725; }
    #proto-nav .label {
      font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 4px;
      margin-left: 6px; vertical-align: middle;
    }
    .label-v1 { background: #6DAEA2; color: white; }
    .label-v15 { background: #F6B725; color: #263D39; }
    .label-prd { background: #263D39; color: #F6B725; }
  </style>
</head>
<body>
  <div id="root"><div style="padding:40px;font-family:system-ui;color:#666">Loading prototypes...</div></div>

  <script>
    // Pre-flight check: verify all CDN libraries loaded
    window.addEventListener('DOMContentLoaded', function() {
      var checks = [
        { name: 'React (cdnjs)', ok: typeof React !== 'undefined' },
        { name: 'ReactDOM (cdnjs)', ok: typeof ReactDOM !== 'undefined' },
        { name: 'react-is (jsdelivr)', ok: typeof ReactIs !== 'undefined' },
        { name: 'Recharts (jsdelivr)', ok: typeof Recharts !== 'undefined' },
      ];
      var missing = checks.filter(function(c) { return !c.ok; }).map(function(c) { return c.name; });
      if (missing.length > 0) {
        document.getElementById('root').innerHTML =
          '<div style="padding:40px;font-family:system-ui;color:red">' +
          '<h2>CDN Load Error</h2>' +
          '<p>Failed to load: <strong>' + missing.join(', ') + '</strong></p>' +
          '<p>Loaded OK: ' + checks.filter(function(c){return c.ok;}).map(function(c){return c.name;}).join(', ') + '</p>' +
          '<p style="margin-top:12px;color:#666">Try refreshing, or check browser console (F12) for blocked network requests.</p></div>';
      }
    });
  </script>

  <script type="text/babel">
    const { useState } = React;
    const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
            LineChart, Line, Legend, Cell, Area, AreaChart, ReferenceLine, PieChart, Pie } = Recharts;

    /* ============================================================
       PROTOTYPE 1: CONTENT INSIGHTS DASHBOARD
       ============================================================ */
    const topicData = [
      { topic: "PTO / Time Off Policy", questions: 847, trend: "+28%", quality: 62, gap: true, priority: 1 },
      { topic: "Shift Schedule & Hours", questions: 623, trend: "+12%", quality: 78, gap: false, priority: null },
      { topic: "Benefits & Insurance", questions: 541, trend: "+5%", quality: 45, gap: true, priority: 2 },
      { topic: "Pay & Direct Deposit", questions: 498, trend: "-3%", quality: 88, gap: false, priority: null },
      { topic: "Safety Protocols", questions: 412, trend: "+41%", quality: 34, gap: true, priority: 3 },
      { topic: "Meal Kit Assembly Process", questions: 387, trend: "+8%", quality: 71, gap: false, priority: null },
      { topic: "Attendance Points", questions: 356, trend: "+15%", quality: 52, gap: true, priority: 4 },
      { topic: "Holiday Schedule", questions: 298, trend: "-12%", quality: 91, gap: false, priority: null },
      { topic: "Parking & Transportation", questions: 187, trend: "+2%", quality: 83, gap: false, priority: null },
      { topic: "Uniform & Dress Code", questions: 134, trend: "-5%", quality: 89, gap: false, priority: null },
    ];

    const trendDataP1 = [
      { month: "Sep", total: 2890, resolved: 2340 },
      { month: "Oct", total: 3120, resolved: 2510 },
      { month: "Nov", total: 3450, resolved: 2680 },
      { month: "Dec", total: 2980, resolved: 2390 },
      { month: "Jan", total: 3680, resolved: 2870 },
      { month: "Feb", total: 4283, resolved: 3210 },
    ];

    const barChartData = topicData.map(d => ({
      name: d.topic.length > 20 ? d.topic.substring(0, 18) + "..." : d.topic,
      fullName: d.topic, questions: d.questions, quality: d.quality, gap: d.gap,
    }));

    const QualityBadge = ({ score }) => {
      const color = score >= 80 ? "#16a34a" : score >= 60 ? "#F6B725" : "#BF4B08";
      const bg = score >= 80 ? "#f0fdf4" : score >= 60 ? "#fefce8" : "#fff7ed";
      const label = score >= 80 ? "Strong" : score >= 60 ? "Fair" : "Needs Work";
      return (
        <span style={{ display:"inline-flex", alignItems:"center", gap:6, padding:"2px 10px", borderRadius:12, backgroundColor:bg, color, fontSize:13, fontWeight:600 }}>
          <span style={{ width:8, height:8, borderRadius:"50%", backgroundColor:color }} />
          {score}% ‚Äî {label}
        </span>
      );
    };

    const TrendBadge = ({ trend }) => {
      const isUp = trend.startsWith("+");
      const val = parseInt(trend);
      const color = Math.abs(val) > 20 ? "#BF4B08" : isUp ? "#263D39" : "#16a34a";
      return <span style={{ color, fontSize:13, fontWeight:600 }}>{isUp ? "‚Üë" : "‚Üì"} {trend}</span>;
    };

    const gapDetails = {
      "PTO / Time Off Policy": "Employees frequently ask about PTO accrual rates, rollover policies, and blackout dates. Many questions go unresolved or get routed to HR. Content exists but doesn't cover site-specific rules.",
      "Benefits & Insurance": "Open enrollment questions spike seasonally. Current EA content covers basic plan info but can't answer questions about eligibility changes, life events, or HSA details.",
      "Safety Protocols": "Sharp increase tied to new OSHA requirements. EA has outdated safety content that doesn't reflect January 2026 policy updates. High volume of repeat questions about PPE requirements.",
      "Attendance Points": "Employees ask about their current balance, how points are calculated, and when points expire. EA cannot pull live points data ‚Äî routes all questions to HR.",
    };

    const recDetails = {
      "PTO / Time Off Policy": { text: "Update EA knowledge base with site-specific PTO rules for Aurora, Newark, and Irving. Current content is generic ‚Äî employees at each site have different accrual rates and blackout periods.", impact: "Could resolve ~320 questions/month that currently go to HR." },
      "Benefits & Insurance": { text: "Add life event and eligibility change content. Most unresolved questions are about mid-year changes (marriage, new child, address change) ‚Äî not basic plan info.", impact: "Could resolve ~298 questions/month during non-enrollment periods." },
      "Safety Protocols": { text: "Replace outdated safety content with January 2026 OSHA updates. Specific gap: PPE requirements for cold storage areas and new chemical handling procedures.", impact: "Could resolve ~272 questions/month. Also a compliance risk ‚Äî employees may be following outdated procedures." },
      "Attendance Points": { text: "Add FAQ content explaining points calculation, expiration timelines, and threshold consequences. Note: Live balance lookup requires integration work (future roadmap).", impact: "Could resolve ~171 questions/month. Remaining gap (live balance) requires product work." },
    };

    function ContentInsights() {
      const [activeView, setActiveView] = useState("topics");
      const gaps = topicData.filter(d => d.gap).sort((a, b) => a.priority - b.priority);

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>Content Insights</div>
            </div>
            <div style={{ display:"flex", gap:8 }}>
              {["All Sites","Aurora, CO","Newark, NJ","Irving, TX"].map(s => (
                <button key={s} style={{ padding:"6px 14px", borderRadius:6, border:"1px solid rgba(255,255,255,0.3)", backgroundColor: s==="All Sites"?"rgba(255,255,255,0.2)":"transparent", color:"white", cursor:"pointer", fontSize:13, fontWeight:500 }}>{s}</button>
              ))}
            </div>
          </div>

          <div style={{ backgroundColor:"white", padding:"12px 32px", borderBottom:"1px solid #e5e7eb", display:"flex", gap:12, alignItems:"center", flexWrap:"wrap" }}>
            <span style={{ fontSize:13, color:"#6b7280", fontWeight:500 }}>Filters:</span>
            {["Last 30 Days","All Shifts","All Departments","All Languages"].map(f => (
              <button key={f} style={{ padding:"5px 12px", borderRadius:6, border:"1px solid #d1d5db", backgroundColor:"white", fontSize:13, cursor:"pointer", color:"#374151" }}>{f} ‚ñæ</button>
            ))}
            <div style={{ flex:1 }} />
            <button style={{ padding:"6px 16px", borderRadius:6, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:13, fontWeight:600, cursor:"pointer" }}>Export Report</button>
          </div>

          <div style={{ padding:"24px 32px 0", display:"grid", gridTemplateColumns:"repeat(4, 1fr)", gap:16 }}>
            {[
              { label:"Total Questions", value:"4,283", sub:"Last 30 days", accent:false },
              { label:"Avg Resolution Quality", value:"69%", sub:"‚Üë 3% from last month", accent:false },
              { label:"Content Gaps Found", value:"4", sub:"Topics needing attention", accent:true },
              { label:"Top Trending Topic", value:"Safety Protocols", sub:"‚Üë 41% this month", accent:true },
            ].map((c,i) => (
              <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:20, border: c.accent?"2px solid #F6B725":"1px solid #e5e7eb" }}>
                <div style={{ fontSize:13, color:"#6b7280", marginBottom:4, fontWeight:500 }}>{c.label}</div>
                <div style={{ fontSize:28, fontWeight:700, color:"#263D39" }}>{c.value}</div>
                <div style={{ fontSize:12, color:"#6DAEA2", marginTop:4, fontWeight:500 }}>{c.sub}</div>
              </div>
            ))}
          </div>

          <div style={{ padding:"24px 32px 0", display:"flex", gap:4 }}>
            {[{id:"topics",label:"Topic Demand"},{id:"gaps",label:"Content Gaps"},{id:"recommendations",label:"What to Fix Next"}].map(tab => (
              <button key={tab.id} onClick={() => setActiveView(tab.id)} style={{ padding:"10px 20px", borderRadius:"8px 8px 0 0", border:"none", cursor:"pointer", fontSize:14, fontWeight:600, backgroundColor: activeView===tab.id?"white":"transparent", color: activeView===tab.id?"#263D39":"#6b7280", borderBottom: activeView===tab.id?"2px solid #F6B725":"2px solid transparent" }}>
                {tab.label}
                {tab.id==="gaps" && <span style={{ marginLeft:8, backgroundColor:"#BF4B08", color:"white", borderRadius:10, padding:"1px 8px", fontSize:11, fontWeight:700 }}>4</span>}
              </button>
            ))}
          </div>

          <div style={{ padding:"0 32px 32px" }}>
            <div style={{ backgroundColor:"white", borderRadius:"0 12px 12px 12px", padding:24, minHeight:400 }}>
              {activeView === "topics" && (
                <div>
                  <div style={{ marginBottom:20 }}>
                    <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>What Employees Are Asking About</div>
                    <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>Ranked by question volume ‚Äî last 30 days</div>
                  </div>
                  <div style={{ height:280, marginBottom:24 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={barChartData} layout="vertical" margin={{ left:140, right:20 }}>
                        <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                        <XAxis type="number" tick={{ fontSize:12 }} />
                        <YAxis type="category" dataKey="name" tick={{ fontSize:12 }} width={140} />
                        <Tooltip formatter={(val) => [val, "Questions"]} />
                        <Bar dataKey="questions" radius={[0,4,4,0]}>
                          {barChartData.map((entry, index) => <Cell key={index} fill={entry.gap ? "#BF4B08" : "#6DAEA2"} />)}
                        </Bar>
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                  <div style={{ display:"flex", gap:16, marginBottom:20, fontSize:13 }}>
                    <span style={{ display:"flex", alignItems:"center", gap:6 }}><span style={{ width:12, height:12, borderRadius:2, backgroundColor:"#BF4B08" }} /> Content gap</span>
                    <span style={{ display:"flex", alignItems:"center", gap:6 }}><span style={{ width:12, height:12, borderRadius:2, backgroundColor:"#6DAEA2" }} /> Healthy</span>
                  </div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead>
                      <tr style={{ borderBottom:"2px solid #e5e7eb" }}>
                        {["TOPIC","QUESTIONS","TREND","RESOLUTION QUALITY"].map((h,i) => (
                          <th key={h} style={{ textAlign: i===1?"right":i>1?"center":"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:12 }}>{h}</th>
                        ))}
                      </tr>
                    </thead>
                    <tbody>
                      {topicData.map((row, i) => (
                        <tr key={i} style={{ borderBottom:"1px solid #f3f4f6", backgroundColor: row.gap?"#fff7ed":"transparent" }}>
                          <td style={{ padding:"12px", fontWeight:500, color:"#263D39" }}>{row.gap && <span style={{ color:"#BF4B08", marginRight:6 }}>‚ö†</span>}{row.topic}</td>
                          <td style={{ textAlign:"right", padding:"12px", fontWeight:600, color:"#263D39" }}>{row.questions.toLocaleString()}</td>
                          <td style={{ textAlign:"center", padding:"12px" }}><TrendBadge trend={row.trend} /></td>
                          <td style={{ textAlign:"center", padding:"12px" }}><QualityBadge score={row.quality} /></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              )}

              {activeView === "gaps" && (
                <div>
                  <div style={{ marginBottom:20 }}>
                    <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>Content Gaps</div>
                    <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>Topics where employees ask frequently but the EA can't answer well</div>
                  </div>
                  {gaps.map((gap, i) => (
                    <div key={i} style={{ border:"1px solid #fed7aa", borderRadius:12, padding:20, marginBottom:16, backgroundColor: i===0?"#fff7ed":"white" }}>
                      <div style={{ display:"flex", alignItems:"center", gap:8, marginBottom:8 }}>
                        <span style={{ backgroundColor:"#BF4B08", color:"white", borderRadius:12, padding:"2px 10px", fontSize:11, fontWeight:700 }}>Priority #{gap.priority}</span>
                        <span style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>{gap.topic}</span>
                      </div>
                      <div style={{ fontSize:13, color:"#6b7280", marginBottom:12 }}>{gap.questions.toLocaleString()} questions this month ({gap.trend} vs. last month) ¬∑ Resolution quality: {gap.quality}%</div>
                      <div style={{ fontSize:13, color:"#263D39", backgroundColor:"#F5FAF8", padding:12, borderRadius:8, lineHeight:1.5 }}>{gapDetails[gap.topic]}</div>
                      <div style={{ marginTop:12, backgroundColor:"#fef3c7", borderRadius:8, padding:10, fontSize:12, color:"#92400e", fontWeight:500 }}>
                        <strong>Employee Impact:</strong> ~{Math.round(gap.questions * (1 - gap.quality / 100))} employees/month not getting answers
                      </div>
                    </div>
                  ))}
                </div>
              )}

              {activeView === "recommendations" && (
                <div>
                  <div style={{ marginBottom:20 }}>
                    <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>What to Fix Next</div>
                    <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>Prioritized by employee impact (volume √ó low resolution quality)</div>
                  </div>
                  {gaps.map((gap, i) => (
                    <div key={i} style={{ border:"1px solid #e5e7eb", borderRadius:12, padding:20, marginBottom:16, borderLeft:`4px solid ${i===0?"#BF4B08":i===1?"#F6B725":"#6DAEA2"}` }}>
                      <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:12 }}>
                        <div style={{ display:"flex", alignItems:"center", gap:10 }}>
                          <span style={{ width:28, height:28, borderRadius:"50%", backgroundColor: i===0?"#BF4B08":i===1?"#F6B725":"#6DAEA2", color:"white", display:"flex", alignItems:"center", justifyContent:"center", fontSize:14, fontWeight:700 }}>{i+1}</span>
                          <span style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>{gap.topic}</span>
                        </div>
                        <QualityBadge score={gap.quality} />
                      </div>
                      <div style={{ backgroundColor:"#F5FAF8", borderRadius:8, padding:16, fontSize:13, lineHeight:1.6 }}>
                        <div style={{ fontWeight:700, marginBottom:8, color:"#6DAEA2" }}>üí° Recommended Action</div>
                        <p style={{ margin:"0 0 8px" }}>{recDetails[gap.topic]?.text}</p>
                        <p style={{ margin:0, fontWeight:600 }}>Expected impact: {recDetails[gap.topic]?.impact}</p>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div style={{ padding:"0 32px 32px" }}>
            <div style={{ backgroundColor:"white", borderRadius:12, padding:24 }}>
              <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Question Volume Trend</div>
              <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>Total questions vs. resolved ‚Äî last 6 months</div>
              <div style={{ height:220 }}>
                <ResponsiveContainer width="100%" height="100%">
                  <LineChart data={trendDataP1}>
                    <CartesianGrid strokeDasharray="3 3" />
                    <XAxis dataKey="month" tick={{ fontSize:12 }} />
                    <YAxis tick={{ fontSize:12 }} />
                    <Tooltip />
                    <Line type="monotone" dataKey="total" stroke="#263D39" strokeWidth={2} name="Total Questions" dot={{ r:4 }} />
                    <Line type="monotone" dataKey="resolved" stroke="#6DAEA2" strokeWidth={2} name="Resolved" dot={{ r:4 }} />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            </div>
          </div>
          <div style={{ textAlign:"center", padding:"16px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1 ‚Äî Content Insights Dashboard ¬∑ TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       PROTOTYPE 2: CONTENT IMPROVEMENT IMPACT
       ============================================================ */
    const contentUpdates = [
      { id:1, topic:"PTO / Time Off Policy", updatedBy:"Stacy M.", updatedDate:"Jan 15, 2026", before:{questions:847,quality:42,fallbackRate:58}, after:{questions:518,quality:89,fallbackRate:11}, status:"improved", details:"Added site-specific accrual rules for Aurora, Newark, and Irving. Added blackout date calendar. Added rollover policy FAQ.",
        trendData:[{week:"Dec 23",questions:210,quality:41},{week:"Dec 30",questions:225,quality:40},{week:"Jan 6",questions:198,quality:43},{week:"Jan 13",questions:215,quality:42},{week:"Jan 20",questions:156,quality:72},{week:"Jan 27",questions:138,quality:84},{week:"Feb 3",questions:125,quality:88},{week:"Feb 10",questions:130,quality:89},{week:"Feb 17",questions:127,quality:89}], refLine:"Jan 13" },
      { id:2, topic:"Safety Protocols", updatedBy:"Marcus J.", updatedDate:"Feb 3, 2026", before:{questions:412,quality:34,fallbackRate:66}, after:{questions:380,quality:61,fallbackRate:39}, status:"improving", details:"Updated PPE requirements for cold storage. Added new chemical handling procedures. Still missing: forklift certification renewal process.",
        trendData:[{week:"Jan 6",questions:95,quality:33},{week:"Jan 13",questions:108,quality:35},{week:"Jan 20",questions:112,quality:34},{week:"Jan 27",questions:98,quality:33},{week:"Feb 3",questions:102,quality:35},{week:"Feb 10",questions:94,quality:55},{week:"Feb 17",questions:88,quality:61}], refLine:"Feb 3" },
      { id:3, topic:"Benefits & Insurance", updatedBy:null, updatedDate:null, before:{questions:541,quality:45,fallbackRate:55}, after:null, status:"no_update", details:"No content update made. Gap identified 45 days ago. Life event and eligibility change content still missing.",
        trendData:[{week:"Jan 6",questions:130,quality:46},{week:"Jan 13",questions:138,quality:44},{week:"Jan 20",questions:142,quality:45},{week:"Jan 27",questions:135,quality:44},{week:"Feb 3",questions:148,quality:43},{week:"Feb 10",questions:140,quality:45},{week:"Feb 17",questions:145,quality:45}], refLine:null },
    ];

    const statusColors = {
      improved: { bg:"#f0fdf4", border:"#bbf7d0", text:"#16a34a", label:"‚úì Significant Improvement" },
      improving: { bg:"#fefce8", border:"#fde68a", text:"#92400e", label:"‚Üó Improving ‚Äî Monitor" },
      no_update: { bg:"#fef2f2", border:"#fecaca", text:"#991b1b", label:"‚ö† No Action Taken" },
    };

    const ImpactCard = ({ label, before, after, unit, inverse }) => {
      if (after === null) return (
        <div style={{ flex:1, backgroundColor:"#f9fafb", borderRadius:8, padding:16, textAlign:"center" }}>
          <div style={{ fontSize:12, color:"#9ca3af", marginBottom:4, fontWeight:500 }}>{label}</div>
          <div style={{ fontSize:24, fontWeight:700, color:"#9ca3af" }}>‚Äî</div>
          <div style={{ fontSize:11, color:"#9ca3af" }}>No update yet</div>
        </div>
      );
      const improved = inverse ? after < before : after > before;
      const changePercent = Math.round(Math.abs(after - before) / before * 100);
      return (
        <div style={{ flex:1, backgroundColor: improved?"#f0fdf4":"#fff7ed", borderRadius:8, padding:16, textAlign:"center" }}>
          <div style={{ fontSize:12, color:"#6b7280", marginBottom:4, fontWeight:500 }}>{label}</div>
          <div style={{ display:"flex", justifyContent:"center", alignItems:"center", gap:12, marginBottom:4 }}>
            <span style={{ fontSize:18, color:"#9ca3af", textDecoration:"line-through" }}>{before}{unit}</span>
            <span style={{ fontSize:14, color:"#6b7280" }}>‚Üí</span>
            <span style={{ fontSize:24, fontWeight:700, color: improved?"#16a34a":"#BF4B08" }}>{after}{unit}</span>
          </div>
          <div style={{ fontSize:12, fontWeight:600, color: improved?"#16a34a":"#BF4B08" }}>{improved?"‚Üì":"‚Üë"} {changePercent}% {improved?"improvement":"regression"}</div>
        </div>
      );
    };

    function ContentImpact() {
      const [sel, setSel] = useState(0);
      const cur = contentUpdates[sel];
      const st = statusColors[cur.status];

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>Content Improvement Impact</div>
            </div>
            <div style={{ backgroundColor:"rgba(255,255,255,0.15)", borderRadius:8, padding:"8px 16px", fontSize:13, fontWeight:500 }}>All Sites ¬∑ Last 90 Days</div>
          </div>

          <div style={{ margin:"24px 32px 0", backgroundColor:"white", borderRadius:12, padding:20, display:"flex", gap:24, alignItems:"center", border:"1px solid #e5e7eb" }}>
            <div style={{ flex:1 }}>
              <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:2 }}>Content Updates This Quarter</div>
              <div style={{ fontSize:32, fontWeight:700, color:"#263D39" }}>2 <span style={{ fontSize:16, fontWeight:400, color:"#6b7280" }}>of 4 gaps addressed</span></div>
            </div>
            <div style={{ width:1, height:48, backgroundColor:"#e5e7eb" }} />
            <div style={{ flex:1 }}>
              <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:2 }}>Questions Reduced</div>
              <div style={{ fontSize:32, fontWeight:700, color:"#16a34a" }}>-361 <span style={{ fontSize:16, fontWeight:400, color:"#6b7280" }}>/month</span></div>
            </div>
            <div style={{ width:1, height:48, backgroundColor:"#e5e7eb" }} />
            <div style={{ flex:1 }}>
              <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:2 }}>HR Time Saved (est.)</div>
              <div style={{ fontSize:32, fontWeight:700, color:"#6DAEA2" }}>~18 hrs <span style={{ fontSize:16, fontWeight:400, color:"#6b7280" }}>/month</span></div>
            </div>
          </div>

          <div style={{ padding:"24px 32px 0", display:"flex", gap:12 }}>
            {contentUpdates.map((u, i) => (
              <button key={u.id} onClick={() => setSel(i)} style={{ flex:1, padding:16, borderRadius:12, cursor:"pointer", border: sel===i?"2px solid #263D39":"1px solid #e5e7eb", backgroundColor: sel===i?"white":"#f9fafb", textAlign:"left" }}>
                <div style={{ fontSize:14, fontWeight:700, color:"#263D39", marginBottom:4 }}>{u.topic}</div>
                <div style={{ fontSize:11, fontWeight:600, padding:"2px 8px", borderRadius:10, display:"inline-block", backgroundColor:statusColors[u.status].bg, color:statusColors[u.status].text, border:`1px solid ${statusColors[u.status].border}` }}>{statusColors[u.status].label}</div>
                {u.updatedDate && <div style={{ fontSize:11, color:"#9ca3af", marginTop:6 }}>Updated {u.updatedDate} by {u.updatedBy}</div>}
              </button>
            ))}
          </div>

          <div style={{ padding:"24px 32px" }}>
            <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
              <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20, padding:16, borderRadius:8, backgroundColor:st.bg, border:`1px solid ${st.border}` }}>
                <div>
                  <div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>{cur.topic}</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginTop:4 }}>{cur.details}</div>
                </div>
                <div style={{ fontSize:14, fontWeight:700, color:st.text, backgroundColor:"white", padding:"6px 14px", borderRadius:8, border:`1px solid ${st.border}`, whiteSpace:"nowrap" }}>{st.label}</div>
              </div>

              <div style={{ display:"flex", gap:16, marginBottom:24 }}>
                <ImpactCard label="Questions / Month" before={cur.before.questions} after={cur.after?.questions ?? null} unit="" inverse={true} />
                <ImpactCard label="Resolution Quality" before={cur.before.quality} after={cur.after?.quality ?? null} unit="%" inverse={false} />
                <ImpactCard label="Fallback-to-HR Rate" before={cur.before.fallbackRate} after={cur.after?.fallbackRate ?? null} unit="%" inverse={true} />
              </div>

              <div>
                <div style={{ fontSize:14, fontWeight:700, color:"#263D39", marginBottom:4 }}>Weekly Trend</div>
                <div style={{ fontSize:12, color:"#6b7280", marginBottom:16 }}>{cur.updatedDate ? `Content updated on ${cur.updatedDate} (dashed line)` : "No content update ‚Äî flat trend"}</div>
                <div style={{ height:220 }}>
                  <ResponsiveContainer width="100%" height="100%">
                    <AreaChart data={cur.trendData}>
                      <defs><linearGradient id="qg" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#6DAEA2" stopOpacity={0.3} /><stop offset="95%" stopColor="#6DAEA2" stopOpacity={0} /></linearGradient></defs>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="week" tick={{ fontSize:11 }} />
                      <YAxis tick={{ fontSize:11 }} domain={[0, 100]} />
                      <Tooltip />
                      {cur.refLine && <ReferenceLine x={cur.refLine} stroke="#F6B725" strokeWidth={2} strokeDasharray="5 5" label={{ value:"Content Updated", position:"top", fontSize:11, fill:"#92400e" }} />}
                      <Area type="monotone" dataKey="quality" stroke="#6DAEA2" strokeWidth={2} fill="url(#qg)" name="Resolution Quality %" dot={{ r:3 }} />
                    </AreaChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {cur.status === "no_update" && (
                <div style={{ backgroundColor:"#fef2f2", border:"1px solid #fecaca", borderRadius:8, padding:16, marginTop:16 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#991b1b", marginBottom:4 }}>‚ö† This gap was identified 45 days ago</div>
                  <div style={{ fontSize:13, color:"#7f1d1d", lineHeight:1.5 }}>~298 employees per month are not getting the answers they need about Benefits & Insurance.</div>
                </div>
              )}
            </div>
          </div>
          <div style={{ textAlign:"center", padding:"8px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1.5 ‚Äî Content Improvement Impact ¬∑ TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       PROTOTYPE 3: UNIFIED DASHBOARD
       ============================================================ */
    const attendanceTrend = [
      { week:"Jan 6", calloffs:42, pto:28, ncns:8, tardy:15, eaQuestions:890 },
      { week:"Jan 13", calloffs:38, pto:31, ncns:6, tardy:12, eaQuestions:920 },
      { week:"Jan 20", calloffs:51, pto:45, ncns:11, tardy:18, eaQuestions:1150 },
      { week:"Jan 27", calloffs:44, pto:35, ncns:7, tardy:14, eaQuestions:980 },
      { week:"Feb 3", calloffs:39, pto:32, ncns:5, tardy:11, eaQuestions:940 },
      { week:"Feb 10", calloffs:47, pto:52, ncns:9, tardy:16, eaQuestions:1180 },
      { week:"Feb 17", calloffs:43, pto:38, ncns:7, tardy:13, eaQuestions:1020 },
    ];

    const dayOfWeek = [
      { day:"Mon", absences:68 },{ day:"Tue", absences:42 },{ day:"Wed", absences:35 },
      { day:"Thu", absences:38 },{ day:"Fri", absences:52 },{ day:"Sat", absences:24 },{ day:"Sun", absences:18 },
    ];

    const shiftBreakdown = [
      { shift:"1st Shift (6a-2p)", absences:89, absenceRate:"4.2%", eaUsage:1840, topTopic:"PTO Policy", pct:"28%" },
      { shift:"2nd Shift (2p-10p)", absences:112, absenceRate:"5.8%", eaUsage:1620, topTopic:"Shift Schedule", pct:"34%" },
      { shift:"3rd Shift (10p-6a)", absences:63, absenceRate:"6.1%", eaUsage:823, topTopic:"Safety Protocols", pct:"41%" },
    ];

    const correlationInsights = [
      { icon:"üîó", title:"PTO questions and PTO absences moving together", detail:"Week of Feb 10: PTO questions spiked 42% and PTO call-offs increased 49%. Employees may be researching policy before requesting time off.", action:"Review PTO content ‚Äî are employees finding what they need, or calling off because they can't figure out the process?", confidence:"Strong correlation (r=0.84 over 8 weeks)" },
      { icon:"üìä", title:"Monday EA usage predicts Monday absences", detail:"Monday morning EA questions (6am-8am) correlate with same-day call-off volume. When pre-shift EA questions exceed 60, call-offs that day are 35% higher than average.", action:"Potential leading indicator ‚Äî could enable proactive staffing adjustments.", confidence:"Moderate correlation (r=0.71 over 12 weeks)" },
      { icon:"‚ö†Ô∏è", title:"3rd shift safety questions ‚Üí no matching content", detail:"3rd shift employees ask about safety protocols 3.2x more than other shifts, but resolution quality for safety is only 34%. 3rd shift also has the highest absence rate (6.1%).", action:"Update safety content with 3rd-shift-specific procedures. Possible connection between content frustration and absenteeism.", confidence:"Exploratory ‚Äî needs more data" },
    ];

    const roiMetrics = [
      { metric:"Absenteeism Rate", before:"5.8%", current:"4.9%", change:"-15.5%", dir:"improved" },
      { metric:"NCNS Rate", before:"1.4%", current:"0.8%", change:"-43%", dir:"improved" },
      { metric:"Avg Time to Notification", before:"47 min", current:"8 min", change:"-83%", dir:"improved" },
      { metric:"HR Questions via EA (self-served)", before:"0", current:"4,283/mo", change:"New", dir:"new" },
    ];

    function UnifiedDashboard() {
      const [sec, setSec] = useState("overview");

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>HelloFresh ‚Äî Workforce Analytics</div>
            </div>
            <div style={{ display:"flex", gap:8 }}>
              {["All Sites","Aurora, CO","Newark, NJ","Irving, TX"].map(s => (
                <button key={s} style={{ padding:"6px 14px", borderRadius:6, border:"1px solid rgba(255,255,255,0.3)", backgroundColor: s==="All Sites"?"rgba(255,255,255,0.2)":"transparent", color:"white", cursor:"pointer", fontSize:13, fontWeight:500 }}>{s}</button>
              ))}
            </div>
          </div>

          <div style={{ backgroundColor:"white", padding:"12px 32px", borderBottom:"1px solid #e5e7eb", display:"flex", gap:12, alignItems:"center", flexWrap:"wrap" }}>
            <span style={{ fontSize:13, color:"#6b7280", fontWeight:500 }}>Filters:</span>
            {["Last 30 Days","All Shifts","All Managers","All Departments"].map(f => (
              <button key={f} style={{ padding:"5px 12px", borderRadius:6, border:"1px solid #d1d5db", backgroundColor:"white", fontSize:13, cursor:"pointer", color:"#374151" }}>{f} ‚ñæ</button>
            ))}
            <div style={{ flex:1 }} />
            <button style={{ padding:"6px 16px", borderRadius:6, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:13, fontWeight:600, cursor:"pointer" }}>Export Report</button>
          </div>

          <div style={{ padding:"16px 32px 0", display:"flex", gap:4, borderBottom:"1px solid #e5e7eb" }}>
            {[{id:"overview",label:"Overview"},{id:"attendance",label:"Attendance"},{id:"connections",label:"Connected Insights"},{id:"roi",label:"ROI"}].map(tab => (
              <button key={tab.id} onClick={() => setSec(tab.id)} style={{ padding:"10px 20px", border:"none", cursor:"pointer", fontSize:14, fontWeight:600, backgroundColor:"transparent", color: sec===tab.id?"#263D39":"#6b7280", borderBottom: sec===tab.id?"3px solid #F6B725":"3px solid transparent", marginBottom:-1 }}>
                {tab.label}
                {tab.id==="connections" && <span style={{ marginLeft:6, backgroundColor:"#F6B725", color:"#263D39", borderRadius:10, padding:"1px 7px", fontSize:10, fontWeight:700 }}>NEW</span>}
              </button>
            ))}
          </div>

          <div style={{ padding:"24px 32px" }}>
            {sec === "overview" && (
              <div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(4, 1fr)", gap:16, marginBottom:24 }}>
                  {[
                    { label:"Total Absences", value:"264", sub:"Last 30 days", color:"#263D39" },
                    { label:"Absence Rate", value:"4.9%", sub:"‚Üì 0.3% from last month", color:"#16a34a" },
                    { label:"EA Questions", value:"4,283", sub:"‚Üë 12% from last month", color:"#263D39" },
                    { label:"Content Gaps", value:"4", sub:"Topics need attention", color:"#BF4B08" },
                  ].map((m,i) => (
                    <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:20, border:"1px solid #e5e7eb" }}>
                      <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:4 }}>{m.label}</div>
                      <div style={{ fontSize:28, fontWeight:700, color:m.color }}>{m.value}</div>
                      <div style={{ fontSize:12, color:"#6DAEA2", marginTop:4, fontWeight:500 }}>{m.sub}</div>
                    </div>
                  ))}
                </div>

                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Attendance & EA Activity ‚Äî Weekly</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>See how employee questions and absences move together</div>
                  <div style={{ height:280 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <LineChart data={attendanceTrend}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="week" tick={{ fontSize:11 }} />
                        <YAxis yAxisId="left" tick={{ fontSize:11 }} />
                        <YAxis yAxisId="right" orientation="right" tick={{ fontSize:11 }} />
                        <Tooltip />
                        <Legend />
                        <Line yAxisId="left" type="monotone" dataKey="calloffs" stroke="#BF4B08" strokeWidth={2} name="Call-offs" dot={{ r:3 }} />
                        <Line yAxisId="left" type="monotone" dataKey="pto" stroke="#F6B725" strokeWidth={2} name="PTO" dot={{ r:3 }} />
                        <Line yAxisId="left" type="monotone" dataKey="ncns" stroke="#991b1b" strokeWidth={2} name="NCNS" dot={{ r:3 }} />
                        <Line yAxisId="right" type="monotone" dataKey="eaQuestions" stroke="#6DAEA2" strokeWidth={2} strokeDasharray="5 5" name="EA Questions" dot={{ r:3 }} />
                      </LineChart>
                    </ResponsiveContainer>
                  </div>
                </div>

                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>By Shift</div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>
                      {["SHIFT","ABSENCES","ABSENCE RATE","EA QUESTIONS","TOP EA TOPIC"].map(h => <th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:12 }}>{h}</th>)}
                    </tr></thead>
                    <tbody>
                      {shiftBreakdown.map((r,i) => (
                        <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                          <td style={{ padding:12, fontWeight:600, color:"#263D39" }}>{r.shift}</td>
                          <td style={{ padding:12 }}>{r.absences}</td>
                          <td style={{ padding:12 }}><span style={{ color: parseFloat(r.absenceRate)>5.5?"#BF4B08":"#263D39", fontWeight:600 }}>{r.absenceRate}</span></td>
                          <td style={{ padding:12 }}>{r.eaUsage.toLocaleString()}</td>
                          <td style={{ padding:12 }}><span style={{ color:"#6DAEA2", fontWeight:500 }}>{r.topTopic}</span> <span style={{ color:"#9ca3af", fontSize:12 }}>({r.pct})</span></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {sec === "attendance" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Absence Breakdown ‚Äî Last 30 Days</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>By type, weekly</div>
                  <div style={{ height:280 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={attendanceTrend}>
                        <CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="week" tick={{ fontSize:11 }} /><YAxis tick={{ fontSize:11 }} /><Tooltip /><Legend />
                        <Bar dataKey="calloffs" stackId="a" fill="#BF4B08" name="Call-offs" />
                        <Bar dataKey="pto" stackId="a" fill="#F6B725" name="PTO" />
                        <Bar dataKey="ncns" stackId="a" fill="#991b1b" name="NCNS" />
                        <Bar dataKey="tardy" stackId="a" fill="#6DAEA2" name="Tardy" radius={[4,4,0,0]} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Day-of-Week Pattern</div>
                  <div style={{ height:220 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={dayOfWeek}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="day" tick={{ fontSize:12 }} /><YAxis tick={{ fontSize:12 }} /><Tooltip /><Bar dataKey="absences" fill="#263D39" radius={[4,4,0,0]} name="Absences" /></BarChart>
                    </ResponsiveContainer>
                  </div>
                  <div style={{ marginTop:12, padding:12, backgroundColor:"#fefce8", borderRadius:8, fontSize:13, color:"#92400e" }}>üí° <strong>Monday absences are 63% higher than mid-week average.</strong> Could indicate scheduling satisfaction issues.</div>
                </div>
              </div>
            )}

            {sec === "connections" && (
              <div>
                <div style={{ backgroundColor:"#fefce8", border:"1px solid #fde68a", borderRadius:12, padding:16, marginBottom:24, display:"flex", alignItems:"center", gap:12 }}>
                  <span style={{ fontSize:20 }}>‚ú®</span>
                  <div>
                    <div style={{ fontSize:14, fontWeight:700, color:"#92400e" }}>Connected Insights</div>
                    <div style={{ fontSize:13, color:"#92400e" }}>Patterns found by looking at EA and Attendance data together ‚Äî things neither dataset shows alone.</div>
                  </div>
                </div>
                {correlationInsights.map((ins,i) => (
                  <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:16, borderLeft:`4px solid ${i===0?"#F6B725":i===1?"#6DAEA2":"#BF4B08"}` }}>
                    <div style={{ display:"flex", alignItems:"center", gap:8, marginBottom:8 }}>
                      <span style={{ fontSize:18 }}>{ins.icon}</span>
                      <span style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>{ins.title}</span>
                    </div>
                    <div style={{ fontSize:14, color:"#374151", lineHeight:1.6, marginBottom:12 }}>{ins.detail}</div>
                    <div style={{ backgroundColor:"#F5FAF8", borderRadius:8, padding:12, fontSize:13, lineHeight:1.5, marginBottom:8 }}>
                      <span style={{ fontWeight:700, color:"#6DAEA2" }}>üí° What this means: </span>
                      <span style={{ color:"#263D39" }}>{ins.action}</span>
                    </div>
                    <div style={{ fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>{ins.confidence}</div>
                  </div>
                ))}
              </div>
            )}

            {sec === "roi" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:18, fontWeight:700, color:"#263D39", marginBottom:4 }}>TeamSense ROI ‚Äî HelloFresh</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:20 }}>Before TeamSense (baseline) vs. current</div>
                  <div style={{ display:"grid", gridTemplateColumns:"repeat(2, 1fr)", gap:16 }}>
                    {roiMetrics.map((m,i) => (
                      <div key={i} style={{ border:"1px solid #e5e7eb", borderRadius:12, padding:20, backgroundColor: m.dir==="new"?"#F5FAF8":"white" }}>
                        <div style={{ fontSize:13, color:"#6b7280", fontWeight:500, marginBottom:8 }}>{m.metric}</div>
                        <div style={{ display:"flex", alignItems:"center", gap:12, marginBottom:4 }}>
                          {m.dir!=="new" && <><span style={{ fontSize:20, color:"#9ca3af", textDecoration:"line-through" }}>{m.before}</span><span style={{ color:"#6b7280" }}>‚Üí</span></>}
                          <span style={{ fontSize:28, fontWeight:700, color: m.dir==="new"?"#6DAEA2":"#16a34a" }}>{m.current}</span>
                        </div>
                        <div style={{ fontSize:13, fontWeight:600, color: m.dir==="new"?"#6DAEA2":"#16a34a" }}>{m.dir==="new"?"New capability":`${m.change} improvement`}</div>
                      </div>
                    ))}
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"2px solid #F6B725" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:8 }}>üìã Ready for Your Next QBR</div>
                  <div style={{ fontSize:14, color:"#374151", lineHeight:1.6, marginBottom:16 }}>Export a formatted report with these metrics alongside attendance trends and content insights. No CSM needed.</div>
                  <button style={{ padding:"10px 24px", borderRadius:8, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:14, fontWeight:700, cursor:"pointer" }}>Export QBR Report</button>
                </div>
              </div>
            )}
          </div>
          <div style={{ textAlign:"center", padding:"8px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1 ‚Äî Unified Workforce Analytics ¬∑ TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       PROTOTYPE 4: PRD-FAITHFUL ATTENDANCE ANALYTICS
       Capabilities #1, #3, #4, #5, #6, #7
       ============================================================ */
    const weeklyTrendP4 = [
      { week:"Dec 1", calloffs:38, pto:24, ncns:7, tardy:11 },
      { week:"Dec 8", calloffs:41, pto:22, ncns:5, tardy:13 },
      { week:"Dec 15", calloffs:35, pto:42, ncns:6, tardy:10 },
      { week:"Dec 22", calloffs:28, pto:58, ncns:4, tardy:8 },
      { week:"Dec 29", calloffs:32, pto:51, ncns:9, tardy:12 },
      { week:"Jan 5", calloffs:48, pto:26, ncns:11, tardy:16 },
      { week:"Jan 12", calloffs:42, pto:28, ncns:8, tardy:15 },
      { week:"Jan 19", calloffs:51, pto:45, ncns:11, tardy:18 },
      { week:"Jan 26", calloffs:44, pto:35, ncns:7, tardy:14 },
      { week:"Feb 2", calloffs:39, pto:32, ncns:5, tardy:11 },
      { week:"Feb 9", calloffs:47, pto:52, ncns:9, tardy:16 },
      { week:"Feb 16", calloffs:43, pto:38, ncns:7, tardy:13 },
    ];
    const dayOfWeekP4 = [
      { day:"Mon", absences:68 },{ day:"Tue", absences:42 },{ day:"Wed", absences:35 },
      { day:"Thu", absences:38 },{ day:"Fri", absences:52 },{ day:"Sat", absences:24 },{ day:"Sun", absences:18 },
    ];
    const shiftDataP4 = [
      { shift:"1st Shift (6a‚Äì2p)", headcount:2120, absences:89, rate:"4.2%", ncns:12, calloffs:48, pto:29, trend:"‚Üì 0.3%", color:"#6DAEA2" },
      { shift:"2nd Shift (2p‚Äì10p)", headcount:1930, absences:112, rate:"5.8%", ncns:18, calloffs:61, pto:33, trend:"‚Üë 0.4%", color:"#F6B725" },
      { shift:"3rd Shift (10p‚Äì6a)", headcount:1032, absences:63, rate:"6.1%", ncns:14, calloffs:35, pto:14, trend:"‚Üë 0.8%", color:"#BF4B08" },
    ];
    const managerDataP4 = [
      { name:"Maria Gonzalez", division:"Aurora, CO", shift:"1st", headcount:42, absences:6, rate:"3.1%", ncns:0, trend:"‚Üì", flag:null },
      { name:"James Mitchell", division:"Aurora, CO", shift:"2nd", headcount:38, absences:12, rate:"6.8%", ncns:3, trend:"‚Üë", flag:"high_ncns" },
      { name:"Rosa Hernandez", division:"Newark, NJ", shift:"1st", headcount:45, absences:5, rate:"2.4%", ncns:0, trend:"‚Üì", flag:null },
      { name:"DeShawn Williams", division:"Newark, NJ", shift:"3rd", headcount:31, absences:9, rate:"6.2%", ncns:4, trend:"‚Üë", flag:"high_ncns" },
      { name:"Tran Nguyen", division:"Irving, TX", shift:"2nd", headcount:40, absences:14, rate:"7.5%", ncns:5, trend:"‚Üë", flag:"high_rate" },
      { name:"Sarah Chen", division:"Aurora, CO", shift:"1st", headcount:44, absences:4, rate:"2.0%", ncns:0, trend:"‚Üì", flag:null },
      { name:"Marcus Johnson", division:"Irving, TX", shift:"3rd", headcount:28, absences:8, rate:"6.1%", ncns:3, trend:"‚Üí", flag:"high_ncns" },
      { name:"Angela Davis", division:"Newark, NJ", shift:"2nd", headcount:36, absences:10, rate:"6.0%", ncns:2, trend:"‚Üë", flag:null },
    ];
    const divCompP4 = [
      { division:"Aurora, CO", headcount:1820, rate:"4.5%", ncnsRate:"0.6%", avgNotify:"7 min", topDay:"Monday", change:"‚Üì 0.4%" },
      { division:"Newark, NJ", headcount:1680, rate:"5.2%", ncnsRate:"1.1%", avgNotify:"9 min", topDay:"Monday", change:"‚Üë 0.2%" },
      { division:"Irving, TX", headcount:1582, rate:"5.6%", ncnsRate:"1.4%", avgNotify:"11 min", topDay:"Friday", change:"‚Üë 0.5%" },
    ];
    const absTypePie = [
      { name:"Call-offs", value:488, color:"#BF4B08" },
      { name:"PTO", value:453, color:"#F6B725" },
      { name:"NCNS", value:89, color:"#991b1b" },
      { name:"Tardy", value:157, color:"#6DAEA2" },
    ];
    const roiBaseP4 = [
      { metric:"Absenteeism Rate", before:"5.8%", current:"4.9%", change:"-15.5%", method:"First 30 days vs. most recent 30 days" },
      { metric:"NCNS Rate", before:"1.4%", current:"0.8%", change:"-42.9%", method:"First 30 days vs. most recent 30 days" },
      { metric:"Avg Time to Notification", before:"47 min", current:"8 min", change:"-83.0%", method:"Pre-TeamSense baseline vs. current" },
      { metric:"Monthly Trend", before:"Flat", current:"Declining", change:"Improving", method:"12-week linear trend" },
    ];
    const monthlyTrendP4 = [
      { month:"Sep", rate:5.8 },{ month:"Oct", rate:5.5 },{ month:"Nov", rate:5.3 },
      { month:"Dec", rate:5.1 },{ month:"Jan", rate:5.0 },{ month:"Feb", rate:4.9 },
    ];

    function AttendanceAnalytics() {
      const [tab4, setTab4] = useState("overview");
      const [selDiv, setSelDiv] = useState("All Sites");
      const [selShift, setSelShift] = useState("All Shifts");
      const [selMgr, setSelMgr] = useState("All Managers");
      const [dateRng, setDateRng] = useState("Last 30 Days");
      const [showExport, setShowExport] = useState(false);

      const divs = ["All Sites","Aurora, CO","Newark, NJ","Irving, TX"];
      const shfts = ["All Shifts","1st Shift","2nd Shift","3rd Shift"];
      const mgrs = ["All Managers",...managerDataP4.map(m=>m.name)];
      const dates = ["Last 7 Days","Last 30 Days","Last 90 Days","Custom Range"];

      const filtMgrs = managerDataP4.filter(m => {
        if (selDiv !== "All Sites" && m.division !== selDiv) return false;
        if (selShift !== "All Shifts" && !m.shift.startsWith(selShift.charAt(0))) return false;
        return true;
      });

      const selStyle = (active) => ({
        padding:"5px 12px", borderRadius:6, fontSize:13, cursor:"pointer", color:"#374151",
        fontFamily:"'Urbanist', system-ui, sans-serif",
        border: active ? "2px solid #6DAEA2" : "1px solid #d1d5db",
        backgroundColor: active ? "#f0fdf4" : "white",
      });

      const p4tabs = [{id:"overview",label:"Overview"},{id:"patterns",label:"Patterns & Breakdown"},{id:"managers",label:"Manager View"},{id:"divisions",label:"Division Comparison"},{id:"roi",label:"ROI Baseline"}];

      return (
        <div style={{ backgroundColor:"#F5FAF8", minHeight:"100vh" }}>
          {/* Header */}
          <div style={{ backgroundColor:"#263D39", color:"white", padding:"20px 32px", display:"flex", alignItems:"center", justifyContent:"space-between" }}>
            <div>
              <div style={{ fontSize:13, opacity:0.7, marginBottom:4, letterSpacing:0.5 }}>TEAMSENSE INSIGHTS</div>
              <div style={{ fontSize:24, fontWeight:700 }}>Attendance Analytics</div>
            </div>
            <div style={{ display:"flex", alignItems:"center", gap:12 }}>
              <div style={{ backgroundColor:"rgba(255,255,255,0.1)", borderRadius:8, padding:"6px 12px", fontSize:12 }}>
                <span style={{ color:"#6DAEA2", fontWeight:700 }}>‚óè</span> Last updated: 12 min ago
              </div>
              <div style={{ backgroundColor:"rgba(109,174,162,0.2)", border:"1px solid rgba(109,174,162,0.4)", borderRadius:8, padding:"6px 12px", fontSize:12, color:"#6DAEA2", fontWeight:600 }}>Near Real-Time</div>
            </div>
          </div>

          {/* TEDS Filter Bar */}
          <div style={{ backgroundColor:"white", padding:"12px 32px", borderBottom:"1px solid #e5e7eb", display:"flex", gap:10, alignItems:"center", flexWrap:"wrap" }}>
            <span style={{ fontSize:13, color:"#6b7280", fontWeight:600 }}>TEDS Filters:</span>
            <select value={selDiv} onChange={e=>setSelDiv(e.target.value)} style={selStyle(selDiv!=="All Sites")}>{divs.map(d=><option key={d}>{d}</option>)}</select>
            <select value={selShift} onChange={e=>setSelShift(e.target.value)} style={selStyle(selShift!=="All Shifts")}>{shfts.map(s=><option key={s}>{s}</option>)}</select>
            <select value={selMgr} onChange={e=>setSelMgr(e.target.value)} style={selStyle(selMgr!=="All Managers")}>{mgrs.map(m=><option key={m}>{m}</option>)}</select>
            <select value={dateRng} onChange={e=>setDateRng(e.target.value)} style={selStyle(false)}>{dates.map(d=><option key={d}>{d}</option>)}</select>
            <button style={{ padding:"5px 12px", borderRadius:6, border:"1px solid #d1d5db", backgroundColor:"white", fontSize:13, cursor:"pointer", color:"#374151" }}>Status Type ‚ñæ</button>
            <div style={{ flex:1 }} />
            {(selDiv!=="All Sites"||selShift!=="All Shifts"||selMgr!=="All Managers") && (
              <button onClick={()=>{setSelDiv("All Sites");setSelShift("All Shifts");setSelMgr("All Managers");}} style={{ padding:"5px 12px", borderRadius:6, border:"none", backgroundColor:"#fef2f2", color:"#991b1b", fontSize:12, cursor:"pointer", fontWeight:600 }}>‚úï Clear Filters</button>
            )}
            <button onClick={()=>setShowExport(true)} style={{ padding:"6px 16px", borderRadius:6, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:13, fontWeight:600, cursor:"pointer" }}>Export Report</button>
          </div>

          {/* Tabs */}
          <div style={{ padding:"16px 32px 0", display:"flex", gap:4, borderBottom:"1px solid #e5e7eb" }}>
            {p4tabs.map(t=>(
              <button key={t.id} onClick={()=>setTab4(t.id)} style={{ padding:"10px 20px", border:"none", cursor:"pointer", fontSize:14, fontWeight:600, backgroundColor:"transparent", color:tab4===t.id?"#263D39":"#6b7280", borderBottom:tab4===t.id?"3px solid #F6B725":"3px solid transparent", marginBottom:-1 }}>{t.label}</button>
            ))}
          </div>

          <div style={{ padding:"24px 32px" }}>
            {/* OVERVIEW */}
            {tab4==="overview" && (
              <div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(5, 1fr)", gap:16, marginBottom:24 }}>
                  {[
                    {label:"Total Absences",value:"1,187",sub:"Last 30 days",color:"#263D39"},
                    {label:"Absence Rate",value:"4.9%",sub:"‚Üì 0.3% from last month",color:"#16a34a"},
                    {label:"NCNS Rate",value:"0.8%",sub:"‚Üì 0.2% from last month",color:"#16a34a"},
                    {label:"Avg Notification",value:"8 min",sub:"Target: <15 min",color:"#263D39"},
                    {label:"Peak Day",value:"Monday",sub:"63% above avg",color:"#BF4B08"},
                  ].map((c,i)=>(
                    <div key={i} style={{ backgroundColor:"white", borderRadius:12, padding:16, border:"1px solid #e5e7eb" }}>
                      <div style={{ fontSize:12, color:"#6b7280", marginBottom:4, fontWeight:500 }}>{c.label}</div>
                      <div style={{ fontSize:26, fontWeight:700, color:c.color }}>{c.value}</div>
                      <div style={{ fontSize:11, color:"#6DAEA2", marginTop:4, fontWeight:500 }}>{c.sub}</div>
                    </div>
                  ))}
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:16 }}>
                    <div><div style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>Absence Trend ‚Äî Weekly</div><div style={{ fontSize:13, color:"#6b7280" }}>By type ¬∑ last 12 weeks</div></div>
                    <div style={{ fontSize:12, color:"#9ca3af" }}>Data refreshes every ~1 hour</div>
                  </div>
                  <div style={{ height:300 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <BarChart data={weeklyTrendP4}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="week" tick={{fontSize:11}} /><YAxis tick={{fontSize:11}} /><Tooltip /><Legend />
                        <Bar dataKey="calloffs" stackId="a" fill="#BF4B08" name="Call-offs" /><Bar dataKey="pto" stackId="a" fill="#F6B725" name="PTO" /><Bar dataKey="ncns" stackId="a" fill="#991b1b" name="NCNS" /><Bar dataKey="tardy" stackId="a" fill="#6DAEA2" name="Tardy" radius={[4,4,0,0]} />
                      </BarChart>
                    </ResponsiveContainer>
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Absence Rate ‚Äî Monthly Trend</div>
                  <div style={{ fontSize:13, color:"#6b7280", marginBottom:16 }}>6-month view ¬∑ used for ROI baseline</div>
                  <div style={{ height:200 }}>
                    <ResponsiveContainer width="100%" height="100%">
                      <LineChart data={monthlyTrendP4}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="month" tick={{fontSize:12}} /><YAxis tick={{fontSize:12}} domain={[4,6.5]} tickFormatter={v=>`${v}%`} /><Tooltip formatter={v=>[`${v}%`,"Absence Rate"]} /><Line type="monotone" dataKey="rate" stroke="#263D39" strokeWidth={2} dot={{r:4,fill:"#263D39"}} /></LineChart>
                    </ResponsiveContainer>
                  </div>
                  <div style={{ marginTop:12, padding:12, backgroundColor:"#f0fdf4", borderRadius:8, fontSize:13, color:"#16a34a", fontWeight:500 }}>Trending down: -0.9 percentage points over 6 months (5.8% ‚Üí 4.9%)</div>
                </div>
              </div>
            )}

            {/* PATTERNS */}
            {tab4==="patterns" && (
              <div>
                <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:24, marginBottom:24 }}>
                  <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                    <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Day-of-Week Pattern</div>
                    <div style={{ height:240 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <BarChart data={dayOfWeekP4}><CartesianGrid strokeDasharray="3 3" /><XAxis dataKey="day" tick={{fontSize:12}} /><YAxis tick={{fontSize:12}} /><Tooltip /><Bar dataKey="absences" name="Absences" radius={[4,4,0,0]}>{dayOfWeekP4.map((e,i)=><Cell key={i} fill={e.day==="Mon"?"#BF4B08":e.day==="Fri"?"#F6B725":"#263D39"} />)}</Bar></BarChart>
                      </ResponsiveContainer>
                    </div>
                    <div style={{ marginTop:12, padding:12, backgroundColor:"#fefce8", borderRadius:8, fontSize:13, color:"#92400e" }}><strong>Monday absences are 63% above mid-week average.</strong> Friday is 28% above.</div>
                  </div>
                  <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                    <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Absence Type Distribution</div>
                    <div style={{ height:240 }}>
                      <ResponsiveContainer width="100%" height="100%">
                        <PieChart><Pie data={absTypePie} cx="50%" cy="50%" outerRadius={90} dataKey="value" label={({name,percent})=>`${name} ${(percent*100).toFixed(0)}%`} labelLine={{stroke:"#9ca3af"}}>{absTypePie.map((e,i)=><Cell key={i} fill={e.color} />)}</Pie><Tooltip /></PieChart>
                      </ResponsiveContainer>
                    </div>
                    <div style={{ display:"flex", gap:16, justifyContent:"center", marginTop:8 }}>{absTypePie.map(t=>(<span key={t.name} style={{ display:"flex", alignItems:"center", gap:4, fontSize:12 }}><span style={{ width:10, height:10, borderRadius:2, backgroundColor:t.color }} />{t.name}: {t.value}</span>))}</div>
                  </div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>Shift Breakdown</div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>{["SHIFT","HEADCOUNT","ABSENCES","RATE","NCNS","CALL-OFFS","PTO","vs LAST MONTH"].map(h=><th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:12 }}>{h}</th>)}</tr></thead>
                    <tbody>{shiftDataP4.map((r,i)=>(
                      <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                        <td style={{ padding:12, fontWeight:600, color:"#263D39" }}><span style={{ display:"inline-block", width:8, height:8, borderRadius:"50%", backgroundColor:r.color, marginRight:8 }} />{r.shift}</td>
                        <td style={{ padding:12 }}>{r.headcount.toLocaleString()}</td>
                        <td style={{ padding:12, fontWeight:600 }}>{r.absences}</td>
                        <td style={{ padding:12 }}><span style={{ color:parseFloat(r.rate)>5.5?"#BF4B08":parseFloat(r.rate)>4.5?"#92400e":"#16a34a", fontWeight:700 }}>{r.rate}</span></td>
                        <td style={{ padding:12, color:r.ncns>15?"#991b1b":"#374151", fontWeight:r.ncns>15?700:400 }}>{r.ncns}</td>
                        <td style={{ padding:12 }}>{r.calloffs}</td><td style={{ padding:12 }}>{r.pto}</td>
                        <td style={{ padding:12, fontWeight:600, color:r.trend.includes("‚Üë")?"#BF4B08":r.trend.includes("‚Üì")?"#16a34a":"#6b7280" }}>{r.trend}</td>
                      </tr>
                    ))}</tbody>
                  </table>
                  <div style={{ marginTop:16, padding:12, backgroundColor:"#fff7ed", borderRadius:8, fontSize:13, color:"#92400e" }}><strong>3rd shift has the highest absence rate (6.1%)</strong> and the steepest increase (+0.8% vs last month).</div>
                </div>
              </div>
            )}

            {/* MANAGERS */}
            {tab4==="managers" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20 }}>
                    <div><div style={{ fontSize:16, fontWeight:700, color:"#263D39" }}>Manager-Level Attendance</div><div style={{ fontSize:13, color:"#6b7280" }}>TEDS-powered drill-down ¬∑ {filtMgrs.length} managers shown</div></div>
                    <div style={{ fontSize:12, color:"#6b7280", backgroundColor:"#F5FAF8", padding:"6px 12px", borderRadius:6 }}>Sorted by absence rate (highest first)</div>
                  </div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>{["MANAGER","DIVISION","SHIFT","HEADCOUNT","ABSENCES","RATE","NCNS","TREND","FLAGS"].map(h=><th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:11 }}>{h}</th>)}</tr></thead>
                    <tbody>
                      {[...filtMgrs].sort((a,b)=>parseFloat(b.rate)-parseFloat(a.rate)).map((m,i)=>(
                        <tr key={i} style={{ borderBottom:"1px solid #f3f4f6", backgroundColor:m.flag?"#fff7ed":"transparent" }}>
                          <td style={{ padding:12, fontWeight:600, color:"#263D39" }}>{m.name}</td>
                          <td style={{ padding:12, color:"#6b7280", fontSize:13 }}>{m.division}</td>
                          <td style={{ padding:12, fontSize:13 }}>{m.shift}</td>
                          <td style={{ padding:12 }}>{m.headcount}</td>
                          <td style={{ padding:12, fontWeight:600 }}>{m.absences}</td>
                          <td style={{ padding:12 }}><span style={{ display:"inline-block", padding:"2px 10px", borderRadius:12, fontWeight:700, fontSize:13, backgroundColor:parseFloat(m.rate)>6?"#fef2f2":parseFloat(m.rate)>4.5?"#fefce8":"#f0fdf4", color:parseFloat(m.rate)>6?"#991b1b":parseFloat(m.rate)>4.5?"#92400e":"#16a34a" }}>{m.rate}</span></td>
                          <td style={{ padding:12, color:m.ncns>2?"#991b1b":"#374151", fontWeight:m.ncns>2?700:400 }}>{m.ncns}</td>
                          <td style={{ padding:12, fontSize:16, color:m.trend==="‚Üë"?"#BF4B08":m.trend==="‚Üì"?"#16a34a":"#6b7280" }}>{m.trend}</td>
                          <td style={{ padding:12 }}>
                            {m.flag==="high_ncns" && <span style={{ backgroundColor:"#fef2f2", color:"#991b1b", padding:"2px 8px", borderRadius:4, fontSize:11, fontWeight:600 }}>High NCNS</span>}
                            {m.flag==="high_rate" && <span style={{ backgroundColor:"#fff7ed", color:"#BF4B08", padding:"2px 8px", borderRadius:4, fontSize:11, fontWeight:600 }}>High Rate</span>}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                  {filtMgrs.filter(m=>m.flag).length > 0 && (
                    <div style={{ marginTop:20, padding:16, backgroundColor:"#fefce8", border:"1px solid #fde68a", borderRadius:8 }}>
                      <div style={{ fontSize:14, fontWeight:700, color:"#92400e", marginBottom:4 }}>Flagged Managers</div>
                      <div style={{ fontSize:13, color:"#92400e", lineHeight:1.6 }}>
                        {filtMgrs.filter(m=>m.flag==="high_ncns").length > 0 && <div>{filtMgrs.filter(m=>m.flag==="high_ncns").length} manager(s) have elevated NCNS rates ‚Äî may indicate notification issues or engagement concerns.</div>}
                        {filtMgrs.filter(m=>m.flag==="high_rate").length > 0 && <div>{filtMgrs.filter(m=>m.flag==="high_rate").length} manager(s) have absence rates above 7% ‚Äî significantly above 4.9% average.</div>}
                      </div>
                    </div>
                  )}
                </div>
                <div style={{ marginTop:16, padding:12, backgroundColor:"#f9fafb", border:"1px solid #e5e7eb", borderRadius:8, fontSize:12, color:"#6b7280", display:"flex", alignItems:"center", gap:8 }}>
                  <span style={{ fontSize:14 }}>‚ÑπÔ∏è</span>
                  <span><strong>TEDS coverage:</strong> Manager data available for 87% of employees. 13% mapped to division only.</span>
                </div>
              </div>
            )}

            {/* DIVISIONS */}
            {tab4==="divisions" && (
              <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb" }}>
                <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:4 }}>Division Comparison</div>
                <div style={{ fontSize:13, color:"#6b7280", marginBottom:20 }}>Cross-site performance ¬∑ last 30 days</div>
                <div style={{ display:"grid", gridTemplateColumns:"repeat(3, 1fr)", gap:20 }}>
                  {divCompP4.map((d,i)=>(
                    <div key={i} style={{ border:"1px solid #e5e7eb", borderRadius:12, padding:20, borderTop:`4px solid ${i===0?"#6DAEA2":i===1?"#F6B725":"#BF4B08"}` }}>
                      <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:16 }}>{d.division}</div>
                      <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:12 }}>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>Headcount</div><div style={{ fontSize:20, fontWeight:700, color:"#263D39" }}>{d.headcount.toLocaleString()}</div></div>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>Absence Rate</div><div style={{ fontSize:20, fontWeight:700, color:parseFloat(d.rate)>5.3?"#BF4B08":"#263D39" }}>{d.rate}</div><div style={{ fontSize:11, fontWeight:600, color:d.change.includes("‚Üì")?"#16a34a":"#BF4B08" }}>{d.change} vs last month</div></div>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>NCNS Rate</div><div style={{ fontSize:20, fontWeight:700, color:parseFloat(d.ncnsRate)>1?"#991b1b":"#263D39" }}>{d.ncnsRate}</div></div>
                        <div><div style={{ fontSize:11, color:"#6b7280", fontWeight:500 }}>Avg Notification</div><div style={{ fontSize:20, fontWeight:700, color:"#263D39" }}>{d.avgNotify}</div></div>
                      </div>
                      <div style={{ marginTop:12, padding:8, backgroundColor:"#F5FAF8", borderRadius:6, fontSize:12, color:"#6b7280" }}>Peak day: <strong>{d.topDay}</strong></div>
                    </div>
                  ))}
                </div>
                <div style={{ marginTop:20, padding:16, backgroundColor:"#fefce8", border:"1px solid #fde68a", borderRadius:8 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#92400e", marginBottom:4 }}>Cross-Division Insights</div>
                  <div style={{ fontSize:13, color:"#92400e", lineHeight:1.6 }}><strong>Irving, TX</strong> has the highest absence and NCNS rates, both trending up. Aurora is trending down. All sites peak on Monday.</div>
                </div>
              </div>
            )}

            {/* ROI */}
            {tab4==="roi" && (
              <div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center", marginBottom:20 }}>
                    <div><div style={{ fontSize:18, fontWeight:700, color:"#263D39" }}>ROI Baseline ‚Äî HelloFresh</div><div style={{ fontSize:13, color:"#6b7280" }}>Auto-calculated ¬∑ 287 days of data</div></div>
                    <div style={{ backgroundColor:"#f0fdf4", border:"1px solid #bbf7d0", borderRadius:8, padding:"6px 12px", fontSize:12, color:"#16a34a", fontWeight:600 }}>‚úì 90+ days ‚Äî ROI active</div>
                  </div>
                  <table style={{ width:"100%", borderCollapse:"collapse", fontSize:14 }}>
                    <thead><tr style={{ borderBottom:"2px solid #e5e7eb" }}>{["METRIC","BASELINE (FIRST 30 DAYS)","CURRENT (LAST 30 DAYS)","CHANGE","METHODOLOGY"].map(h=><th key={h} style={{ textAlign:"left", padding:"10px 12px", color:"#6b7280", fontWeight:600, fontSize:11 }}>{h}</th>)}</tr></thead>
                    <tbody>{roiBaseP4.map((r,i)=>(
                      <tr key={i} style={{ borderBottom:"1px solid #f3f4f6" }}>
                        <td style={{ padding:12, fontWeight:600, color:"#263D39" }}>{r.metric}</td>
                        <td style={{ padding:12, color:"#9ca3af" }}>{r.before}</td>
                        <td style={{ padding:12, fontWeight:700, color:"#263D39" }}>{r.current}</td>
                        <td style={{ padding:12 }}><span style={{ display:"inline-block", padding:"2px 10px", borderRadius:12, fontWeight:700, fontSize:13, backgroundColor:"#f0fdf4", color:"#16a34a" }}>{r.change}</span></td>
                        <td style={{ padding:12, fontSize:12, color:"#9ca3af" }}>{r.method}</td>
                      </tr>
                    ))}</tbody>
                  </table>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:20, border:"1px solid #e5e7eb", marginBottom:24 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:"#263D39", marginBottom:8 }}>Methodology</div>
                  <div style={{ fontSize:13, color:"#6b7280", lineHeight:1.6 }}>ROI baseline compares your <strong>first 30 days</strong> on TeamSense to your <strong>most recent 30 days</strong>. We show the data and trend ‚Äî you draw the conclusions. These are descriptive, not predictive.</div>
                </div>
                <div style={{ backgroundColor:"white", borderRadius:12, padding:24, border:"2px solid #F6B725" }}>
                  <div style={{ fontSize:16, fontWeight:700, color:"#263D39", marginBottom:8 }}>Ready for Your QBR</div>
                  <div style={{ fontSize:14, color:"#374151", lineHeight:1.6, marginBottom:16 }}>Export a formatted report with ROI metrics, attendance trends, and content insights. Includes TeamSense branding and all active filters. No CSM needed.</div>
                  <div style={{ display:"flex", gap:12 }}>
                    <button style={{ padding:"10px 24px", borderRadius:8, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:14, fontWeight:700, cursor:"pointer" }}>Export Formatted Report (PDF)</button>
                    <button style={{ padding:"10px 24px", borderRadius:8, border:"1px solid #d1d5db", backgroundColor:"white", color:"#263D39", fontSize:14, fontWeight:600, cursor:"pointer" }}>Export Raw Data (CSV)</button>
                  </div>
                </div>
              </div>
            )}
          </div>

          {/* Export Modal */}
          {showExport && (
            <div style={{ position:"fixed", inset:0, backgroundColor:"rgba(0,0,0,0.5)", display:"flex", alignItems:"center", justifyContent:"center", zIndex:1000 }} onClick={()=>setShowExport(false)}>
              <div style={{ backgroundColor:"white", borderRadius:16, padding:32, maxWidth:520, width:"90%" }} onClick={e=>e.stopPropagation()}>
                <div style={{ fontSize:18, fontWeight:700, color:"#263D39", marginBottom:16 }}>Export Report</div>
                <div style={{ fontSize:13, color:"#6b7280", marginBottom:20, lineHeight:1.5 }}>Includes all visible metrics, respecting your active TEDS filters.</div>
                <div style={{ backgroundColor:"#F5FAF8", borderRadius:8, padding:16, marginBottom:20 }}>
                  <div style={{ fontSize:12, fontWeight:600, color:"#6b7280", marginBottom:8 }}>EXPORT INCLUDES:</div>
                  <div style={{ fontSize:13, color:"#263D39", lineHeight:1.8 }}>‚úì Attendance trends (weekly, by type)<br/>‚úì Day-of-week and shift patterns<br/>‚úì Manager-level breakdown<br/>‚úì Division comparison<br/>‚úì ROI baseline metrics<br/>‚úì Filters: {selDiv}, {selShift}, {dateRng}</div>
                </div>
                <div style={{ display:"flex", gap:12 }}>
                  <button style={{ flex:1, padding:"12px 20px", borderRadius:8, border:"none", backgroundColor:"#F6B725", color:"#263D39", fontSize:14, fontWeight:700, cursor:"pointer" }}>Download PDF</button>
                  <button style={{ flex:1, padding:"12px 20px", borderRadius:8, border:"1px solid #d1d5db", backgroundColor:"white", color:"#263D39", fontSize:14, fontWeight:600, cursor:"pointer" }}>Download CSV</button>
                </div>
                <button onClick={()=>setShowExport(false)} style={{ width:"100%", marginTop:12, padding:8, border:"none", backgroundColor:"transparent", color:"#6b7280", fontSize:13, cursor:"pointer" }}>Cancel</button>
              </div>
            </div>
          )}

          {/* Legacy Notice ‚Äî Capability #7 */}
          <div style={{ margin:"0 32px 16px", padding:12, backgroundColor:"#f9fafb", border:"1px solid #e5e7eb", borderRadius:8, fontSize:12, color:"#6b7280", display:"flex", alignItems:"center", gap:8 }}>
            <span style={{ fontSize:14 }}>‚ÑπÔ∏è</span>
            <span>Your existing Attendance Insights (7 cards) is still available under <strong>Reports ‚Üí Attendance Insights</strong>. This new view adds TEDS filtering, content insights, and ROI metrics.</span>
          </div>
          <div style={{ textAlign:"center", padding:"8px 32px 32px", fontSize:12, color:"#9ca3af", fontStyle:"italic" }}>TIP v1 ‚Äî Attendance Analytics (PRD-Faithful) ¬∑ TeamSense Research Prototype</div>
        </div>
      );
    }

    /* ============================================================
       APP SHELL ‚Äî Tab Switcher
       ============================================================ */
    function App() {
      const [active, setActive] = useState("content-insights");
      const protos = [
        { id:"content-insights", label:"Content Insights", version:"v1" },
        { id:"content-impact", label:"Content Impact", version:"v1.5" },
        { id:"unified", label:"Unified Dashboard", version:"v1" },
        { id:"attendance", label:"Attendance Analytics", version:"PRD" },
      ];

      return (
        <div>
          <div id="proto-nav">
            <div className="nav-brand">TIP PROTOTYPES</div>
            {protos.map(p => (
              <button key={p.id} className={active===p.id?"active":""} onClick={() => setActive(p.id)}>
                {p.label}
                <span className={`label ${p.version==="v1"?"label-v1":p.version==="PRD"?"label-prd":"label-v15"}`}>{p.version}</span>
              </button>
            ))}
          </div>
          {active === "content-insights" && <ContentInsights />}
          {active === "content-impact" && <ContentImpact />}
          {active === "unified" && <UnifiedDashboard />}
          {active === "attendance" && <AttendanceAnalytics />}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
